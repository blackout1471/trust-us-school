<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1087px" preserveAspectRatio="none" style="width:1072px;height:1087px;background:#FFFFFF;" version="1.1" viewBox="0 0 1072 1087" width="1072px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="409" x="10" y="221.0156"/><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="409" x="10" y="374.7734"/><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="409" x="10" y="467.8281"/><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="409" x="10" y="634.5859"/><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="409" x="10" y="788.3438"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="37" x2="37" y1="82.6094" y2="1005.8047"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="198" x2="198" y1="82.6094" y2="1005.8047"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="359" x2="359" y1="82.6094" y2="1005.8047"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="660.5" x2="660.5" y1="82.6094" y2="1005.8047"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="773.5" x2="773.5" y1="82.6094" y2="1005.8047"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="914.5" x2="914.5" y1="82.6094" y2="1005.8047"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1033.5" x2="1033.5" y1="82.6094" y2="1005.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="20" y="79.5332">User</text><ellipse cx="37.5" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M37.5,21.5 L37.5,48.5 M24.5,29.5 L50.5,29.5 M37.5,48.5 L24.5,63.5 M37.5,48.5 L50.5,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="20" y="1019.3379">User</text><ellipse cx="37.5" cy="1030.9141" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M37.5,1038.9141 L37.5,1065.9141 M24.5,1046.9141 L50.5,1046.9141 M37.5,1065.9141 L24.5,1080.9141 M37.5,1065.9141 L50.5,1080.9141 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105" x="146" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="153" y="71.5332">UserController</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105" x="146" y="1004.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="153" y="1026.3379">UserController</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99" x="310" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="317" y="71.5332">UserManager</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99" x="310" y="1004.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="317" y="1026.3379">UserManager</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96" x="612.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="619.5" y="71.5332">UserProvider</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96" x="612.5" y="1004.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="619.5" y="1026.3379">UserProvider</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110" x="718.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="725.5" y="71.5332">TokenManager</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110" x="718.5" y="1004.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="725.5" y="1026.3379">TokenManager</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153" x="838.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="845.5" y="71.5332">UserLocationManager</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153" x="838.5" y="1004.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="845.5" y="1026.3379">UserLocationManager</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65" x="1001.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="1008.5" y="71.5332">Security</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65" x="1001.5" y="1004.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="1008.5" y="1026.3379">Security</text><polygon fill="#181818" points="186.5,110.9609,196.5,114.9609,186.5,118.9609,190.5,114.9609" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="37.5" x2="192.5" y1="114.9609" y2="114.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="44.5" y="110.1045">Login (email, password)</text><polygon fill="#181818" points="347.5,141.3125,357.5,145.3125,347.5,149.3125,351.5,145.3125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="198.5" x2="353.5" y1="145.3125" y2="145.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="205.5" y="140.4561">Login (email, password)</text><polygon fill="#181818" points="903,171.6641,913,175.6641,903,179.6641,907,175.6641" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="359.5" x2="909" y1="175.6641" y2="175.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="366.5" y="170.8076">Check if ip is blocked (ipadress)</text><polygon fill="#181818" points="370.5,202.0156,360.5,206.0156,370.5,210.0156,366.5,206.0156" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="364.5" x2="914" y1="206.0156" y2="206.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="376.5" y="201.1592">Returns whether ip is block</text><path d="M10,221.0156 L71,221.0156 L71,229.3672 L61,239.3672 L10,239.3672 L10,221.0156 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="409" x="10" y="221.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="235.5107">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="65" x="86" y="234.4346">[Ip blocked]</text><polygon fill="#181818" points="209.5,257.7188,199.5,261.7188,209.5,265.7188,205.5,261.7188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="203.5" x2="358.5" y1="261.7188" y2="261.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="215.5" y="256.8623">Forbidden</text><polygon fill="#181818" points="48.5,288.0703,38.5,292.0703,48.5,296.0703,44.5,292.0703" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="42.5" x2="197.5" y1="292.0703" y2="292.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="54.5" y="287.2139">Forbidden</text><polygon fill="#181818" points="648.5,325.4219,658.5,329.4219,648.5,333.4219,652.5,329.4219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="359.5" x2="654.5" y1="329.4219" y2="329.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="366.5" y="324.5654">Get user by email(email)</text><polygon fill="#181818" points="370.5,355.7734,360.5,359.7734,370.5,363.7734,366.5,359.7734" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="364.5" x2="659.5" y1="359.7734" y2="359.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="69" x="376.5" y="354.917">Return User</text><path d="M10,374.7734 L71,374.7734 L71,383.125 L61,393.125 L10,393.125 L10,374.7734 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="409" x="10" y="374.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="389.2686">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="90" x="86" y="388.1924">[User not found]</text><polygon fill="#181818" points="209.5,411.4766,199.5,415.4766,209.5,419.4766,205.5,415.4766" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="203.5" x2="358.5" y1="415.4766" y2="415.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="215.5" y="410.6201">Login failed</text><polygon fill="#181818" points="48.5,441.8281,38.5,445.8281,48.5,449.8281,44.5,445.8281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="42.5" x2="197.5" y1="445.8281" y2="445.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="54.5" y="440.9717">Login failed</text><path d="M10,467.8281 L71,467.8281 L71,476.1797 L61,486.1797 L10,486.1797 L10,467.8281 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="409" x="10" y="467.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="482.3232">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="87" x="86" y="481.2471">[User is locked]</text><polygon fill="#181818" points="209.5,504.5313,199.5,508.5313,209.5,512.5313,205.5,508.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="203.5" x2="358.5" y1="508.5313" y2="508.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="215.5" y="503.6748">Account locked</text><polygon fill="#181818" points="48.5,534.8828,38.5,538.8828,48.5,542.8828,44.5,538.8828" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="42.5" x2="197.5" y1="538.8828" y2="538.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="54.5" y="534.0264">Account locked</text><polygon fill="#181818" points="1022,572.2344,1032,576.2344,1022,580.2344,1026,576.2344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="359.5" x2="1028" y1="576.2344" y2="576.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="366.5" y="571.3779">Hash password (password, salt)</text><line style="stroke:#181818;stroke-width:1.0;" x1="359.5" x2="401.5" y1="606.5859" y2="606.5859"/><line style="stroke:#181818;stroke-width:1.0;" x1="401.5" x2="401.5" y1="606.5859" y2="619.5859"/><line style="stroke:#181818;stroke-width:1.0;" x1="360.5" x2="401.5" y1="619.5859" y2="619.5859"/><polygon fill="#181818" points="370.5,615.5859,360.5,619.5859,370.5,623.5859,366.5,619.5859" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287" x="366.5" y="601.7295">Check if salted password matches user password</text><path d="M10,634.5859 L71,634.5859 L71,642.9375 L61,652.9375 L10,652.9375 L10,634.5859 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="409" x="10" y="634.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="649.0811">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="153" x="86" y="648.0049">[Password does not match]</text><polygon fill="#181818" points="209.5,671.2891,199.5,675.2891,209.5,679.2891,205.5,675.2891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="203.5" x2="358.5" y1="675.2891" y2="675.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="215.5" y="670.4326">Login failed</text><polygon fill="#181818" points="48.5,701.6406,38.5,705.6406,48.5,709.6406,44.5,705.6406" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="42.5" x2="197.5" y1="705.6406" y2="705.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="54.5" y="700.7842">Login failed</text><polygon fill="#181818" points="903,738.9922,913,742.9922,903,746.9922,907,742.9922" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="359.5" x2="909" y1="742.9922" y2="742.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="297" x="366.5" y="738.1357">Check if user has been logged in from ip (ip, userid)</text><polygon fill="#181818" points="370.5,769.3438,360.5,773.3438,370.5,777.3438,366.5,773.3438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="364.5" x2="914" y1="773.3438" y2="773.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="376.5" y="768.4873">Returns whether user has been logged in from ip</text><path d="M10,788.3438 L71,788.3438 L71,796.6953 L61,806.6953 L10,806.6953 L10,788.3438 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="409" x="10" y="788.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="802.8389">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="134" x="86" y="801.7627">[Has not been logged in]</text><polygon fill="#181818" points="209.5,825.0469,199.5,829.0469,209.5,833.0469,205.5,829.0469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="203.5" x2="358.5" y1="829.0469" y2="829.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="215.5" y="824.1904">Forbidden</text><polygon fill="#181818" points="48.5,855.3984,38.5,859.3984,48.5,863.3984,44.5,859.3984" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="42.5" x2="197.5" y1="859.3984" y2="859.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="54.5" y="854.542">Forbidden</text><polygon fill="#181818" points="209.5,892.75,199.5,896.75,209.5,900.75,205.5,896.75" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="203.5" x2="358.5" y1="896.75" y2="896.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="215.5" y="891.8936">Returns User</text><polygon fill="#181818" points="761.5,923.1016,771.5,927.1016,761.5,931.1016,765.5,927.1016" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="198.5" x2="767.5" y1="927.1016" y2="927.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="205.5" y="922.2451">Get token for user (User)</text><polygon fill="#181818" points="209.5,953.4531,199.5,957.4531,209.5,961.4531,205.5,957.4531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="203.5" x2="772.5" y1="957.4531" y2="957.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="215.5" y="952.5967">Returns Token</text><polygon fill="#181818" points="48.5,983.8047,38.5,987.8047,48.5,991.8047,44.5,987.8047" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="42.5" x2="197.5" y1="987.8047" y2="987.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="54.5" y="982.9482">Return token</text><!--MD5=[2000e7ab30a08e70394bb6f3ea04fa2a]
@startuml Login SD

actor User
participant UserController
participant UserManager
participant UserProvider
participant TokenManager
participant UserLocationManager
participant Security

User->UserController: Login (email, password)
UserController->UserManager: Login (email, password)
UserManager->UserLocationManager: Check if ip is blocked (ipadress)
UserLocationManager->UserManager: Returns whether ip is block

alt Ip blocked
UserManager->UserController: Forbidden
UserController->User: Forbidden
end

UserManager->UserProvider: Get user by email(email)
UserProvider->UserManager: Return User


alt User not found

UserManager->UserController: Login failed
UserController->User: Login failed

end

alt User is locked

UserManager->UserController: Account locked
UserController->User: Account locked

end

UserManager->Security: Hash password (password, salt)
UserManager->UserManager: Check if salted password matches user password

alt Password does not match

UserManager->UserController: Login failed
UserController->User: Login failed

end


UserManager->UserLocationManager: Check if user has been logged in from ip (ip, userid)
UserLocationManager->UserManager: Returns whether user has been logged in from ip

alt Has not been logged in

UserManager->UserController: Forbidden
UserController->User: Forbidden

end

UserManager->UserController: Returns User
UserController->TokenManager: Get token for user (User)
TokenManager->UserController: Returns Token

UserController->User: Return token

@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>
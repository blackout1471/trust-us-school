<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1436px" preserveAspectRatio="none" style="width:1179px;height:1436px;background:#FFFFFF;" version="1.1" viewBox="0 0 1179 1436" width="1179px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="506" x="20" y="221.0156"/><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="506" x="20" y="374.7734"/><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="506" x="20" y="467.8281"/><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="506" x="20" y="634.5859"/><rect fill="none" height="427.9219" style="stroke:#000000;stroke-width:1.5;" width="935.5" x="10" y="788.3438"/><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="506" x="20" y="1008.8047"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="47" x2="47" y1="82.6094" y2="1354.6719"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="208" x2="208" y1="82.6094" y2="1354.6719"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="466" x2="466" y1="82.6094" y2="1354.6719"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="767.5" x2="767.5" y1="82.6094" y2="1354.6719"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="880.5" x2="880.5" y1="82.6094" y2="1354.6719"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1021.5" x2="1021.5" y1="82.6094" y2="1354.6719"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1140.5" x2="1140.5" y1="82.6094" y2="1354.6719"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="30" y="79.5332">User</text><ellipse cx="47.5" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M47.5,21.5 L47.5,48.5 M34.5,29.5 L60.5,29.5 M47.5,48.5 L34.5,63.5 M47.5,48.5 L60.5,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="30" y="1368.2051">User</text><ellipse cx="47.5" cy="1379.7813" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M47.5,1387.7813 L47.5,1414.7813 M34.5,1395.7813 L60.5,1395.7813 M47.5,1414.7813 L34.5,1429.7813 M47.5,1414.7813 L60.5,1429.7813 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105" x="156" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="163" y="71.5332">UserController</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105" x="156" y="1353.6719"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="163" y="1375.2051">UserController</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99" x="417" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="424" y="71.5332">UserManager</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99" x="417" y="1353.6719"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="424" y="1375.2051">UserManager</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96" x="719.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="726.5" y="71.5332">UserProvider</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96" x="719.5" y="1353.6719"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="726.5" y="1375.2051">UserProvider</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110" x="825.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="832.5" y="71.5332">TokenManager</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110" x="825.5" y="1353.6719"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="832.5" y="1375.2051">TokenManager</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153" x="945.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="952.5" y="71.5332">UserLocationManager</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153" x="945.5" y="1353.6719"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="952.5" y="1375.2051">UserLocationManager</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65" x="1108.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="1115.5" y="71.5332">Security</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65" x="1108.5" y="1353.6719"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="1115.5" y="1375.2051">Security</text><polygon fill="#181818" points="196.5,110.9609,206.5,114.9609,196.5,118.9609,200.5,114.9609" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="47.5" x2="202.5" y1="114.9609" y2="114.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="54.5" y="110.1045">Login (email, password)</text><polygon fill="#181818" points="454.5,141.3125,464.5,145.3125,454.5,149.3125,458.5,145.3125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="208.5" x2="460.5" y1="145.3125" y2="145.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="215.5" y="140.4561">Login (email, password)</text><polygon fill="#181818" points="1010,171.6641,1020,175.6641,1010,179.6641,1014,175.6641" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="466.5" x2="1016" y1="175.6641" y2="175.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="473.5" y="170.8076">Check if ip is blocked (ipadress)</text><polygon fill="#181818" points="477.5,202.0156,467.5,206.0156,477.5,210.0156,473.5,206.0156" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="471.5" x2="1021" y1="206.0156" y2="206.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="483.5" y="201.1592">Returns whether ip is block</text><path d="M20,221.0156 L81,221.0156 L81,229.3672 L71,239.3672 L20,239.3672 L20,221.0156 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="506" x="20" y="221.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="235.5107">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="65" x="96" y="234.4346">[Ip blocked]</text><polygon fill="#181818" points="219.5,257.7188,209.5,261.7188,219.5,265.7188,215.5,261.7188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="213.5" x2="465.5" y1="261.7188" y2="261.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="225.5" y="256.8623">Throw IpBlocked exception</text><polygon fill="#181818" points="58.5,288.0703,48.5,292.0703,58.5,296.0703,54.5,292.0703" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="52.5" x2="207.5" y1="292.0703" y2="292.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="64.5" y="287.2139">Return status forbidden</text><polygon fill="#181818" points="755.5,325.4219,765.5,329.4219,755.5,333.4219,759.5,329.4219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="466.5" x2="761.5" y1="329.4219" y2="329.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="473.5" y="324.5654">Get user by email(email)</text><polygon fill="#181818" points="477.5,355.7734,467.5,359.7734,477.5,363.7734,473.5,359.7734" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="471.5" x2="766.5" y1="359.7734" y2="359.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="69" x="483.5" y="354.917">Return User</text><path d="M20,374.7734 L81,374.7734 L81,383.125 L71,393.125 L20,393.125 L20,374.7734 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="506" x="20" y="374.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="389.2686">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="90" x="96" y="388.1924">[User not found]</text><polygon fill="#181818" points="219.5,411.4766,209.5,415.4766,219.5,419.4766,215.5,415.4766" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="213.5" x2="465.5" y1="415.4766" y2="415.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="225.5" y="410.6201">Login failed</text><polygon fill="#181818" points="58.5,441.8281,48.5,445.8281,58.5,449.8281,54.5,445.8281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="52.5" x2="207.5" y1="445.8281" y2="445.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="64.5" y="440.9717">Login failed</text><path d="M20,467.8281 L81,467.8281 L81,476.1797 L71,486.1797 L20,486.1797 L20,467.8281 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="506" x="20" y="467.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="482.3232">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="87" x="96" y="481.2471">[User is locked]</text><polygon fill="#181818" points="219.5,504.5313,209.5,508.5313,219.5,512.5313,215.5,508.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="213.5" x2="465.5" y1="508.5313" y2="508.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="225.5" y="503.6748">Throw account locked exception</text><polygon fill="#181818" points="58.5,534.8828,48.5,538.8828,58.5,542.8828,54.5,538.8828" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="52.5" x2="207.5" y1="538.8828" y2="538.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="64.5" y="534.0264">Return status forbidden</text><polygon fill="#181818" points="1129,572.2344,1139,576.2344,1129,580.2344,1133,576.2344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="466.5" x2="1135" y1="576.2344" y2="576.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="473.5" y="571.3779">Hash password (password, salt)</text><line style="stroke:#181818;stroke-width:1.0;" x1="466.5" x2="508.5" y1="606.5859" y2="606.5859"/><line style="stroke:#181818;stroke-width:1.0;" x1="508.5" x2="508.5" y1="606.5859" y2="619.5859"/><line style="stroke:#181818;stroke-width:1.0;" x1="467.5" x2="508.5" y1="619.5859" y2="619.5859"/><polygon fill="#181818" points="477.5,615.5859,467.5,619.5859,477.5,623.5859,473.5,619.5859" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287" x="473.5" y="601.7295">Check if salted password matches user password</text><path d="M20,634.5859 L81,634.5859 L81,642.9375 L71,652.9375 L20,652.9375 L20,634.5859 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="506" x="20" y="634.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="649.0811">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="153" x="96" y="648.0049">[Password does not match]</text><polygon fill="#181818" points="219.5,671.2891,209.5,675.2891,219.5,679.2891,215.5,675.2891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="213.5" x2="465.5" y1="675.2891" y2="675.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="225.5" y="670.4326">Login failed</text><polygon fill="#181818" points="58.5,701.6406,48.5,705.6406,58.5,709.6406,54.5,705.6406" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="52.5" x2="207.5" y1="705.6406" y2="705.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="64.5" y="700.7842">Login failed</text><polygon fill="#181818" points="1010,738.9922,1020,742.9922,1010,746.9922,1014,742.9922" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="466.5" x2="1016" y1="742.9922" y2="742.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="297" x="473.5" y="738.1357">Check if user has been logged in from ip (ip, userid)</text><polygon fill="#181818" points="477.5,769.3438,467.5,773.3438,477.5,777.3438,473.5,773.3438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="471.5" x2="1021" y1="773.3438" y2="773.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="483.5" y="768.4873">Returns whether user has been logged in from ip</text><path d="M10,788.3438 L71,788.3438 L71,796.6953 L61,806.6953 L10,806.6953 L10,788.3438 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="427.9219" style="stroke:#000000;stroke-width:1.5;" width="935.5" x="10" y="788.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="802.8389">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="250" x="86" y="801.7627">[Has not been logged in from location before]</text><polygon fill="#181818" points="219.5,825.0469,209.5,829.0469,219.5,833.0469,215.5,829.0469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="213.5" x2="465.5" y1="829.0469" y2="829.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="225.5" y="824.1904">Throw Required 2FA exception</text><polygon fill="#181818" points="58.5,855.3984,48.5,859.3984,58.5,863.3984,54.5,859.3984" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="52.5" x2="207.5" y1="859.3984" y2="859.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="64.5" y="854.542">Return status forbidden</text><polygon fill="#181818" points="58.5,885.75,48.5,889.75,58.5,893.75,54.5,889.75" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="52.5" x2="465.5" y1="889.75" y2="889.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="64.5" y="884.8936">Sends verification code</text><polygon fill="#181818" points="196.5,916.1016,206.5,920.1016,196.5,924.1016,200.5,920.1016" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="47.5" x2="202.5" y1="920.1016" y2="920.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="54.5" y="915.2451">Enters verification code</text><polygon fill="#181818" points="454.5,946.4531,464.5,950.4531,454.5,954.4531,458.5,950.4531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="208.5" x2="460.5" y1="950.4531" y2="950.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234" x="215.5" y="945.5967">VerificationLogin(email, verification code)</text><line style="stroke:#181818;stroke-width:1.0;" x1="466.5" x2="508.5" y1="980.8047" y2="980.8047"/><line style="stroke:#181818;stroke-width:1.0;" x1="508.5" x2="508.5" y1="980.8047" y2="993.8047"/><line style="stroke:#181818;stroke-width:1.0;" x1="467.5" x2="508.5" y1="993.8047" y2="993.8047"/><polygon fill="#181818" points="477.5,989.8047,467.5,993.8047,477.5,997.8047,473.5,993.8047" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="473.5" y="975.9482">Check if verification matches</text><path d="M20,1008.8047 L81,1008.8047 L81,1017.1563 L71,1027.1563 L20,1027.1563 L20,1008.8047 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="506" x="20" y="1008.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="1023.2998">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="160" x="96" y="1022.2236">[Verification does not match]</text><polygon fill="#181818" points="219.5,1045.5078,209.5,1049.5078,219.5,1053.5078,215.5,1049.5078" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="213.5" x2="465.5" y1="1049.5078" y2="1049.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="225.5" y="1044.6514">Login failed</text><polygon fill="#181818" points="58.5,1075.8594,48.5,1079.8594,58.5,1083.8594,54.5,1079.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="52.5" x2="207.5" y1="1079.8594" y2="1079.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="64.5" y="1075.0029">Login failed</text><polygon fill="#181818" points="219.5,1113.2109,209.5,1117.2109,219.5,1121.2109,215.5,1117.2109" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="213.5" x2="465.5" y1="1117.2109" y2="1117.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="225.5" y="1112.3545">Returns User</text><polygon fill="#181818" points="868.5,1143.5625,878.5,1147.5625,868.5,1151.5625,872.5,1147.5625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="208.5" x2="874.5" y1="1147.5625" y2="1147.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="215.5" y="1142.7061">Get token for user (User)</text><polygon fill="#181818" points="219.5,1173.9141,209.5,1177.9141,219.5,1181.9141,215.5,1177.9141" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="213.5" x2="879.5" y1="1177.9141" y2="1177.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="225.5" y="1173.0576">Returns Token</text><polygon fill="#181818" points="58.5,1204.2656,48.5,1208.2656,58.5,1212.2656,54.5,1208.2656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="52.5" x2="207.5" y1="1208.2656" y2="1208.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="64.5" y="1203.4092">Return token</text><polygon fill="#181818" points="219.5,1241.6172,209.5,1245.6172,219.5,1249.6172,215.5,1245.6172" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="213.5" x2="465.5" y1="1245.6172" y2="1245.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="225.5" y="1240.7607">Returns User</text><polygon fill="#181818" points="868.5,1271.9688,878.5,1275.9688,868.5,1279.9688,872.5,1275.9688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="208.5" x2="874.5" y1="1275.9688" y2="1275.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="215.5" y="1271.1123">Get token for user (User)</text><polygon fill="#181818" points="219.5,1302.3203,209.5,1306.3203,219.5,1310.3203,215.5,1306.3203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="213.5" x2="879.5" y1="1306.3203" y2="1306.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="225.5" y="1301.4639">Returns Token</text><polygon fill="#181818" points="58.5,1332.6719,48.5,1336.6719,58.5,1340.6719,54.5,1336.6719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="52.5" x2="207.5" y1="1336.6719" y2="1336.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="64.5" y="1331.8154">Return token</text><!--MD5=[165f22eebcea9f2ceae65f6ac75be1b3]
@startuml Login SD

actor User
participant UserController
participant UserManager
participant UserProvider
participant TokenManager
participant UserLocationManager
participant Security

User->UserController: Login (email, password)
UserController->UserManager: Login (email, password)
UserManager->UserLocationManager: Check if ip is blocked (ipadress)
UserLocationManager- ->UserManager: Returns whether ip is block

alt Ip blocked
UserManager- ->UserController: Throw IpBlocked exception
UserController- ->User: Return status forbidden
end

UserManager->UserProvider: Get user by email(email)
UserProvider->UserManager: Return User


alt User not found

UserManager->UserController: Login failed
UserController->User: Login failed

end

alt User is locked

UserManager- ->UserController: Throw account locked exception
UserController- ->User: Return status forbidden

end

UserManager->Security: Hash password (password, salt)
UserManager->UserManager: Check if salted password matches user password

alt Password does not match

UserManager->UserController: Login failed
UserController->User: Login failed

end


UserManager->UserLocationManager: Check if user has been logged in from ip (ip, userid)
UserLocationManager- ->UserManager: Returns whether user has been logged in from ip

alt Has not been logged in from location before

UserManager- ->UserController: Throw Required 2FA exception
UserController- ->User: Return status forbidden
UserManager- ->User: Sends verification code
User->UserController: Enters verification code
UserController->UserManager: VerificationLogin(email, verification code)
UserManager->UserManager: Check if verification matches
alt Verification does not match

UserManager->UserController: Login failed
UserController->User: Login failed

end
UserManager->UserController: Returns User
UserController->TokenManager: Get token for user (User)
TokenManager->UserController: Returns Token
UserController->User: Return token
end

UserManager->UserController: Returns User
UserController->TokenManager: Get token for user (User)
TokenManager->UserController: Returns Token

UserController->User: Return token

@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: Cp1252
Language: da
Country: DK
--></g></svg>
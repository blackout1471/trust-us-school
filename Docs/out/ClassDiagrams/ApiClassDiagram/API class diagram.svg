<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1022px" preserveAspectRatio="none" style="width:4686px;height:1022px;background:#FFFFFF;" version="1.1" viewBox="0 0 4686 1022" width="4686px" zoomAndPan="magnify"><defs/><g><!--MD5=[29f97d496cbdc4ec81664c6d94dc9bf6]
class UserController--><g id="elem_UserController"><rect codeLine="6" fill="#F1F1F1" height="188.875" id="UserController" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="521" x="575" y="15.5"/><ellipse cx="785.75" cy="31.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M788.5156,27.375 Q788.6719,27.1563 788.8594,27.0469 Q789.0469,26.9375 789.2656,26.9375 Q789.6406,26.9375 789.875,27.1953 Q790.1094,27.4531 790.1094,28.0625 L790.1094,29.5156 Q790.1094,30.125 789.875,30.3906 Q789.6406,30.6563 789.2656,30.6563 Q788.9219,30.6563 788.7188,30.4531 Q788.5156,30.2656 788.4063,29.75 Q788.3594,29.3906 788.1719,29.2031 Q787.8438,28.8281 787.2344,28.6094 Q786.625,28.3906 786,28.3906 Q785.2344,28.3906 784.6016,28.7188 Q783.9688,29.0469 783.4766,29.7969 Q782.9844,30.5469 782.9844,31.5781 L782.9844,32.6719 Q782.9844,33.9063 783.875,34.7266 Q784.7656,35.5469 786.3594,35.5469 Q787.2969,35.5469 787.9531,35.2969 Q788.3438,35.1406 788.7656,34.7031 Q789.0313,34.4375 789.1797,34.3594 Q789.3281,34.2813 789.5313,34.2813 Q789.8594,34.2813 790.1172,34.5391 Q790.375,34.7969 790.375,35.1406 Q790.375,35.4844 790.0313,35.8906 Q789.5313,36.4688 788.7344,36.7969 Q787.6563,37.25 786.3594,37.25 Q784.8438,37.25 783.6406,36.625 Q782.6563,36.125 781.9688,35.0547 Q781.2813,33.9844 781.2813,32.7031 L781.2813,31.5469 Q781.2813,30.2188 781.8984,29.0703 Q782.5156,27.9219 783.6094,27.3047 Q784.7031,26.6875 785.9375,26.6875 Q786.6719,26.6875 787.3203,26.8516 Q787.9688,27.0156 788.5156,27.375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="806.25" y="37.2285">UserController</text><line style="stroke:#181818;stroke-width:0.5;" x1="576" x2="1095" y1="47.5" y2="47.5"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="583" y="58.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="257" x="595" y="66.0332">_userManager{readonly} : IUserManager</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="583" y="76.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="210" x="595" y="83.6426">_tokenManager : ITokenManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="576" x2="1095" y1="90.7188" y2="90.7188"/><ellipse cx="586" cy="105.0234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="495" x="595" y="109.252">UserController(userManager : IUserManager, tokenManager : ITokenManager)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="595" y="126.8613"> </text><ellipse cx="586" cy="140.2422" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="431" x="595" y="144.4707">Create(userCreate : UserCreate) : Task&lt;ActionResult&lt;UserToken&gt;&gt;</text><ellipse cx="586" cy="157.8516" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="407" x="595" y="162.0801">Login(userLogin : UserLogin) : Task&lt;ActionResult&lt;UserToken&gt;&gt;</text><ellipse cx="586" cy="175.4609" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="318" x="595" y="179.6895">GetUserFromToken() : Task&lt;ActionResult&lt;User&gt;&gt;</text><ellipse cx="586" cy="193.0703" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="477" x="595" y="197.2988">VerificationLogin(userLogin : UserLogin) : Task&lt;ActionResult&lt;UserToken&gt;&gt;</text></g><!--MD5=[56ab46cd423624563d94b9f2eeeea516]
class IUserManager--><g id="elem_IUserManager"><rect codeLine="24" fill="#F1F1F1" height="118.4375" id="IUserManager" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="653" x="509" y="291"/><ellipse cx="785.75" cy="307" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M786.7031,303.6406 L786.7031,310.2969 L788.4219,310.2969 Q789.0313,310.2969 789.2969,310.5313 Q789.5625,310.7656 789.5625,311.1563 Q789.5625,311.5313 789.2969,311.7656 Q789.0313,312 788.4219,312 L783.2813,312 Q782.6719,312 782.4063,311.7656 Q782.1406,311.5313 782.1406,311.1406 Q782.1406,310.7656 782.4063,310.5313 Q782.6719,310.2969 783.2813,310.2969 L785,310.2969 L785,303.6406 L783.2813,303.6406 Q782.6719,303.6406 782.4063,303.4063 Q782.1406,303.1719 782.1406,302.7813 Q782.1406,302.4063 782.4063,302.1719 Q782.6719,301.9375 783.2813,301.9375 L788.4219,301.9375 Q789.0313,301.9375 789.2969,302.1719 Q789.5625,302.4063 789.5625,302.7813 Q789.5625,303.1719 789.2969,303.4063 Q789.0313,303.6406 788.4219,303.6406 L786.7031,303.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="91" x="806.25" y="312.7285">IUserManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="510" x2="1161" y1="323" y2="323"/><line style="stroke:#181818;stroke-width:0.5;" x1="510" x2="1161" y1="331" y2="331"/><ellipse cx="520" cy="345.3047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="363" x="529" y="349.5332">CreateUserAsync(userCreate : UserCreate) : Task&lt;User&gt;</text><ellipse cx="520" cy="362.9141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="495" x="529" y="367.1426">LoginAsync(userLogin : UserLogin, userLocation : UserLocation) : Task&lt;User&gt;</text><ellipse cx="520" cy="380.5234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="255" x="529" y="384.752">GetUserByIDAsync(id : int) : Task&lt;User&gt;</text><ellipse cx="520" cy="398.1328" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="627" x="529" y="402.3613">LoginWithVerificationCodeAsync(userLogin : UserLogin, userLocation : UserLocation) : Task&lt;User&gt;</text></g><!--MD5=[1258d900524f45f247dd7f1e09584eb4]
class ITokenManager--><g id="elem_ITokenManager"><rect codeLine="31" fill="#F1F1F1" height="100.8281" id="ITokenManager" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="364" x="100.5" y="299.5"/><ellipse cx="227.25" cy="315.5" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M228.2031,312.1406 L228.2031,318.7969 L229.9219,318.7969 Q230.5313,318.7969 230.7969,319.0313 Q231.0625,319.2656 231.0625,319.6563 Q231.0625,320.0313 230.7969,320.2656 Q230.5313,320.5 229.9219,320.5 L224.7813,320.5 Q224.1719,320.5 223.9063,320.2656 Q223.6406,320.0313 223.6406,319.6406 Q223.6406,319.2656 223.9063,319.0313 Q224.1719,318.7969 224.7813,318.7969 L226.5,318.7969 L226.5,312.1406 L224.7813,312.1406 Q224.1719,312.1406 223.9063,311.9063 Q223.6406,311.6719 223.6406,311.2813 Q223.6406,310.9063 223.9063,310.6719 Q224.1719,310.4375 224.7813,310.4375 L229.9219,310.4375 Q230.5313,310.4375 230.7969,310.6719 Q231.0625,310.9063 231.0625,311.2813 Q231.0625,311.6719 230.7969,311.9063 Q230.5313,312.1406 229.9219,312.1406 L228.2031,312.1406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="102" x="247.75" y="321.2285">ITokenManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="101.5" x2="463.5" y1="331.5" y2="331.5"/><line style="stroke:#181818;stroke-width:0.5;" x1="101.5" x2="463.5" y1="339.5" y2="339.5"/><ellipse cx="111.5" cy="353.8047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="289" x="120.5" y="358.0332">GenerateUserToken(user : User) : UserToken</text><ellipse cx="111.5" cy="371.4141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="222" x="120.5" y="375.6426">ValidateToken(token : string) : bool</text><ellipse cx="111.5" cy="389.0234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="338" x="120.5" y="393.252">GetUserTokenFromToken(token : string) : UserToken</text></g><!--MD5=[d00c2197046b95564bb4dabcd5edfb06]
class IUserLocationManager--><g id="elem_IUserLocationManager"><rect codeLine="38" fill="#F1F1F1" height="100.8281" id="IUserLocationManager" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="540" x="1772.5" y="299.5"/><ellipse cx="1965.75" cy="315.5" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1966.7031,312.1406 L1966.7031,318.7969 L1968.4219,318.7969 Q1969.0313,318.7969 1969.2969,319.0313 Q1969.5625,319.2656 1969.5625,319.6563 Q1969.5625,320.0313 1969.2969,320.2656 Q1969.0313,320.5 1968.4219,320.5 L1963.2813,320.5 Q1962.6719,320.5 1962.4063,320.2656 Q1962.1406,320.0313 1962.1406,319.6406 Q1962.1406,319.2656 1962.4063,319.0313 Q1962.6719,318.7969 1963.2813,318.7969 L1965,318.7969 L1965,312.1406 L1963.2813,312.1406 Q1962.6719,312.1406 1962.4063,311.9063 Q1962.1406,311.6719 1962.1406,311.2813 Q1962.1406,310.9063 1962.4063,310.6719 Q1962.6719,310.4375 1963.2813,310.4375 L1968.4219,310.4375 Q1969.0313,310.4375 1969.2969,310.6719 Q1969.5625,310.9063 1969.5625,311.2813 Q1969.5625,311.6719 1969.2969,311.9063 Q1969.0313,312.1406 1968.4219,312.1406 L1966.7031,312.1406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="145" x="1986.25" y="321.2285">IUserLocationManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="1773.5" x2="2311.5" y1="331.5" y2="331.5"/><line style="stroke:#181818;stroke-width:0.5;" x1="1773.5" x2="2311.5" y1="339.5" y2="339.5"/><ellipse cx="1783.5" cy="353.8047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="260" x="1792.5" y="358.0332">IsIPLockedAsync(ip : string) : Task&lt;bool&gt;</text><ellipse cx="1783.5" cy="371.4141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="445" x="1792.5" y="375.6426">LogLocationAsync(userLocation : UserLocation) : Task&lt;UserLocation&gt;</text><ellipse cx="1783.5" cy="389.0234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="514" x="1792.5" y="393.252">UserWasLoggedInFromLocationAsync(userLocation : UserLocation) : Task&lt;bool&gt;</text></g><!--MD5=[6c06fb0cd17dfe24a13aaf4bb7e771c8]
class TokenManager--><g id="elem_TokenManager"><rect codeLine="44" fill="#F1F1F1" height="83.2188" id="TokenManager" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="533" x="7" y="68.5"/><ellipse cx="221.25" cy="84.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M224.0156,80.375 Q224.1719,80.1563 224.3594,80.0469 Q224.5469,79.9375 224.7656,79.9375 Q225.1406,79.9375 225.375,80.1953 Q225.6094,80.4531 225.6094,81.0625 L225.6094,82.5156 Q225.6094,83.125 225.375,83.3906 Q225.1406,83.6563 224.7656,83.6563 Q224.4219,83.6563 224.2188,83.4531 Q224.0156,83.2656 223.9063,82.75 Q223.8594,82.3906 223.6719,82.2031 Q223.3438,81.8281 222.7344,81.6094 Q222.125,81.3906 221.5,81.3906 Q220.7344,81.3906 220.1016,81.7188 Q219.4688,82.0469 218.9766,82.7969 Q218.4844,83.5469 218.4844,84.5781 L218.4844,85.6719 Q218.4844,86.9063 219.375,87.7266 Q220.2656,88.5469 221.8594,88.5469 Q222.7969,88.5469 223.4531,88.2969 Q223.8438,88.1406 224.2656,87.7031 Q224.5313,87.4375 224.6797,87.3594 Q224.8281,87.2813 225.0313,87.2813 Q225.3594,87.2813 225.6172,87.5391 Q225.875,87.7969 225.875,88.1406 Q225.875,88.4844 225.5313,88.8906 Q225.0313,89.4688 224.2344,89.7969 Q223.1563,90.25 221.8594,90.25 Q220.3438,90.25 219.1406,89.625 Q218.1563,89.125 217.4688,88.0547 Q216.7813,86.9844 216.7813,85.7031 L216.7813,84.5469 Q216.7813,83.2188 217.3984,82.0703 Q218.0156,80.9219 219.1094,80.3047 Q220.2031,79.6875 221.4375,79.6875 Q222.1719,79.6875 222.8203,79.8516 Q223.4688,80.0156 224.0156,80.375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="241.75" y="90.2285">TokenManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="539" y1="100.5" y2="100.5"/><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="539" y1="108.5" y2="108.5"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="15" y="119.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="277" x="27" y="127.0332">GetPrincipal(token : string) : ClaimsPrincipal</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="15" y="137.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="507" x="27" y="144.6426">ClaimsIdentityToUserToken(identity : ClaimsPrincipal, token : string) : UserToken</text></g><!--MD5=[24add822970012a00cd97a40cd79feff]
class UserManager--><g id="elem_UserManager"><rect codeLine="49" fill="#F1F1F1" height="206.4844" id="UserManager" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="938" x="1924.5" y="7"/><ellipse cx="2346.75" cy="23" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M2349.5156,18.875 Q2349.6719,18.6563 2349.8594,18.5469 Q2350.0469,18.4375 2350.2656,18.4375 Q2350.6406,18.4375 2350.875,18.6953 Q2351.1094,18.9531 2351.1094,19.5625 L2351.1094,21.0156 Q2351.1094,21.625 2350.875,21.8906 Q2350.6406,22.1563 2350.2656,22.1563 Q2349.9219,22.1563 2349.7188,21.9531 Q2349.5156,21.7656 2349.4063,21.25 Q2349.3594,20.8906 2349.1719,20.7031 Q2348.8438,20.3281 2348.2344,20.1094 Q2347.625,19.8906 2347,19.8906 Q2346.2344,19.8906 2345.6016,20.2188 Q2344.9688,20.5469 2344.4766,21.2969 Q2343.9844,22.0469 2343.9844,23.0781 L2343.9844,24.1719 Q2343.9844,25.4063 2344.875,26.2266 Q2345.7656,27.0469 2347.3594,27.0469 Q2348.2969,27.0469 2348.9531,26.7969 Q2349.3438,26.6406 2349.7656,26.2031 Q2350.0313,25.9375 2350.1797,25.8594 Q2350.3281,25.7813 2350.5313,25.7813 Q2350.8594,25.7813 2351.1172,26.0391 Q2351.375,26.2969 2351.375,26.6406 Q2351.375,26.9844 2351.0313,27.3906 Q2350.5313,27.9688 2349.7344,28.2969 Q2348.6563,28.75 2347.3594,28.75 Q2345.8438,28.75 2344.6406,28.125 Q2343.6563,27.625 2342.9688,26.5547 Q2342.2813,25.4844 2342.2813,24.2031 L2342.2813,23.0469 Q2342.2813,21.7188 2342.8984,20.5703 Q2343.5156,19.4219 2344.6094,18.8047 Q2345.7031,18.1875 2346.9375,18.1875 Q2347.6719,18.1875 2348.3203,18.3516 Q2348.9688,18.5156 2349.5156,18.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="2367.25" y="28.7285">UserManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="1925.5" x2="2861.5" y1="39" y2="39"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1932.5" y="50.3047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="186" x="1944.5" y="57.5332">_userProvider : IUserProvider</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1932.5" y="67.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="344" x="1944.5" y="75.1426">_leakedPasswordProvider : ILeakedPasswordProvider;</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1932.5" y="85.5234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="300" x="1944.5" y="92.752">_userLocationManager : IUserLocationManager</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1932.5" y="103.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="231" x="1944.5" y="110.3613">_messageService : IMessageService</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1932.5" y="120.7422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="243" x="1944.5" y="127.9707">_messageProvider : IMessageProvider</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1932.5" y="138.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="209" x="1944.5" y="145.5801">_logger : ILogger&lt;UserManager&gt;</text><ellipse cx="1935.5" cy="158.9609" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="912" x="1944.5" y="163.1895">UserManager(userProvider : IUserProvider, leakedPasswordProvider : ILeakedPasswordProvider, userLocationManager : IUserLocationManager,</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="680" x="1944.5" y="180.7988">messageService : IMessageService, messageProvider : IMessageProvider, logger : ILogger&lt;UserManager&gt;)</text><line style="stroke:#181818;stroke-width:1.0;" x1="1925.5" x2="2861.5" y1="187.875" y2="187.875"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1932.5" y="199.1797"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="402" x="1944.5" y="206.4082">CheckPasswordLeakedForUser(password : string) : Task&lt;bool&gt;</text></g><!--MD5=[f73269fd56b24b10ecd9be8e99f9cb1e]
class UserLocationManager--><g id="elem_UserLocationManager"><rect codeLine="62" fill="#F1F1F1" height="83.2188" id="UserLocationManager" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="458" x="1259.5" y="68.5"/><ellipse cx="1414.75" cy="84.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1417.5156,80.375 Q1417.6719,80.1563 1417.8594,80.0469 Q1418.0469,79.9375 1418.2656,79.9375 Q1418.6406,79.9375 1418.875,80.1953 Q1419.1094,80.4531 1419.1094,81.0625 L1419.1094,82.5156 Q1419.1094,83.125 1418.875,83.3906 Q1418.6406,83.6563 1418.2656,83.6563 Q1417.9219,83.6563 1417.7188,83.4531 Q1417.5156,83.2656 1417.4063,82.75 Q1417.3594,82.3906 1417.1719,82.2031 Q1416.8438,81.8281 1416.2344,81.6094 Q1415.625,81.3906 1415,81.3906 Q1414.2344,81.3906 1413.6016,81.7188 Q1412.9688,82.0469 1412.4766,82.7969 Q1411.9844,83.5469 1411.9844,84.5781 L1411.9844,85.6719 Q1411.9844,86.9063 1412.875,87.7266 Q1413.7656,88.5469 1415.3594,88.5469 Q1416.2969,88.5469 1416.9531,88.2969 Q1417.3438,88.1406 1417.7656,87.7031 Q1418.0313,87.4375 1418.1797,87.3594 Q1418.3281,87.2813 1418.5313,87.2813 Q1418.8594,87.2813 1419.1172,87.5391 Q1419.375,87.7969 1419.375,88.1406 Q1419.375,88.4844 1419.0313,88.8906 Q1418.5313,89.4688 1417.7344,89.7969 Q1416.6563,90.25 1415.3594,90.25 Q1413.8438,90.25 1412.6406,89.625 Q1411.6563,89.125 1410.9688,88.0547 Q1410.2813,86.9844 1410.2813,85.7031 L1410.2813,84.5469 Q1410.2813,83.2188 1410.8984,82.0703 Q1411.5156,80.9219 1412.6094,80.3047 Q1413.7031,79.6875 1414.9375,79.6875 Q1415.6719,79.6875 1416.3203,79.8516 Q1416.9688,80.0156 1417.5156,80.375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="1435.25" y="90.2285">UserLocationManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="1260.5" x2="1716.5" y1="100.5" y2="100.5"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1267.5" y="111.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="294" x="1279.5" y="119.0332">_userLocationProvider : IUserLocationProvider</text><line style="stroke:#181818;stroke-width:0.5;" x1="1260.5" x2="1716.5" y1="126.1094" y2="126.1094"/><ellipse cx="1270.5" cy="140.4141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="432" x="1279.5" y="144.6426">UserLocationManager(userLocationProvider : UserLocationProvider)</text></g><!--MD5=[177726c6dccf199602c5c27bb05f2a1e]
class UserCreate--><g id="elem_UserCreate"><rect codeLine="181" fill="#F1F1F1" height="65.6094" id="UserCreate" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="1470.5" y="736"/><ellipse cx="1499" cy="752" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1501.7656,747.875 Q1501.9219,747.6563 1502.1094,747.5469 Q1502.2969,747.4375 1502.5156,747.4375 Q1502.8906,747.4375 1503.125,747.6953 Q1503.3594,747.9531 1503.3594,748.5625 L1503.3594,750.0156 Q1503.3594,750.625 1503.125,750.8906 Q1502.8906,751.1563 1502.5156,751.1563 Q1502.1719,751.1563 1501.9688,750.9531 Q1501.7656,750.7656 1501.6563,750.25 Q1501.6094,749.8906 1501.4219,749.7031 Q1501.0938,749.3281 1500.4844,749.1094 Q1499.875,748.8906 1499.25,748.8906 Q1498.4844,748.8906 1497.8516,749.2188 Q1497.2188,749.5469 1496.7266,750.2969 Q1496.2344,751.0469 1496.2344,752.0781 L1496.2344,753.1719 Q1496.2344,754.4063 1497.125,755.2266 Q1498.0156,756.0469 1499.6094,756.0469 Q1500.5469,756.0469 1501.2031,755.7969 Q1501.5938,755.6406 1502.0156,755.2031 Q1502.2813,754.9375 1502.4297,754.8594 Q1502.5781,754.7813 1502.7813,754.7813 Q1503.1094,754.7813 1503.3672,755.0391 Q1503.625,755.2969 1503.625,755.6406 Q1503.625,755.9844 1503.2813,756.3906 Q1502.7813,756.9688 1501.9844,757.2969 Q1500.9063,757.75 1499.6094,757.75 Q1498.0938,757.75 1496.8906,757.125 Q1495.9063,756.625 1495.2188,755.5547 Q1494.5313,754.4844 1494.5313,753.2031 L1494.5313,752.0469 Q1494.5313,750.7188 1495.1484,749.5703 Q1495.7656,748.4219 1496.8594,747.8047 Q1497.9531,747.1875 1499.1875,747.1875 Q1499.9219,747.1875 1500.5703,747.3516 Q1501.2188,747.5156 1501.7656,747.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72" x="1516" y="757.7285">UserCreate</text><line style="stroke:#181818;stroke-width:0.5;" x1="1471.5" x2="1603.5" y1="768" y2="768"/><ellipse cx="1481.5" cy="782.3047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="1490.5" y="786.5332">Password : string</text><line style="stroke:#181818;stroke-width:0.5;" x1="1471.5" x2="1603.5" y1="793.6094" y2="793.6094"/></g><!--MD5=[f8bd6c2ec23e906322bbeaf68b53bb4f]
class UserLogin--><g id="elem_UserLogin"><rect codeLine="193" fill="#F1F1F1" height="83.2188" id="UserLogin" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="768.5" y="522.5"/><ellipse cx="800.6" cy="538.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M803.3656,534.375 Q803.5219,534.1563 803.7094,534.0469 Q803.8969,533.9375 804.1156,533.9375 Q804.4906,533.9375 804.725,534.1953 Q804.9594,534.4531 804.9594,535.0625 L804.9594,536.5156 Q804.9594,537.125 804.725,537.3906 Q804.4906,537.6563 804.1156,537.6563 Q803.7719,537.6563 803.5688,537.4531 Q803.3656,537.2656 803.2563,536.75 Q803.2094,536.3906 803.0219,536.2031 Q802.6938,535.8281 802.0844,535.6094 Q801.475,535.3906 800.85,535.3906 Q800.0844,535.3906 799.4516,535.7188 Q798.8188,536.0469 798.3266,536.7969 Q797.8344,537.5469 797.8344,538.5781 L797.8344,539.6719 Q797.8344,540.9063 798.725,541.7266 Q799.6156,542.5469 801.2094,542.5469 Q802.1469,542.5469 802.8031,542.2969 Q803.1938,542.1406 803.6156,541.7031 Q803.8813,541.4375 804.0297,541.3594 Q804.1781,541.2813 804.3813,541.2813 Q804.7094,541.2813 804.9672,541.5391 Q805.225,541.7969 805.225,542.1406 Q805.225,542.4844 804.8813,542.8906 Q804.3813,543.4688 803.5844,543.7969 Q802.5063,544.25 801.2094,544.25 Q799.6938,544.25 798.4906,543.625 Q797.5063,543.125 796.8188,542.0547 Q796.1313,540.9844 796.1313,539.7031 L796.1313,538.5469 Q796.1313,537.2188 796.7484,536.0703 Q797.3656,534.9219 798.4594,534.3047 Q799.5531,533.6875 800.7875,533.6875 Q801.5219,533.6875 802.1703,533.8516 Q802.8188,534.0156 803.3656,534.375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="818.4" y="544.2285">UserLogin</text><line style="stroke:#181818;stroke-width:0.5;" x1="769.5" x2="901.5" y1="554.5" y2="554.5"/><ellipse cx="779.5" cy="568.8047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="788.5" y="573.0332">Email : string</text><ellipse cx="779.5" cy="586.4141" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="788.5" y="590.6426">Password : string</text><line style="stroke:#181818;stroke-width:0.5;" x1="769.5" x2="901.5" y1="597.7188" y2="597.7188"/></g><!--MD5=[6ac818b5870897fde505b1069c30005c]
class IUserProvider--><g id="elem_IUserProvider"><rect codeLine="86" fill="#F1F1F1" height="153.6563" id="IUserProvider" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="397" x="2348" y="273"/><ellipse cx="2499.25" cy="289" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M2500.2031,285.6406 L2500.2031,292.2969 L2501.9219,292.2969 Q2502.5313,292.2969 2502.7969,292.5313 Q2503.0625,292.7656 2503.0625,293.1563 Q2503.0625,293.5313 2502.7969,293.7656 Q2502.5313,294 2501.9219,294 L2496.7813,294 Q2496.1719,294 2495.9063,293.7656 Q2495.6406,293.5313 2495.6406,293.1406 Q2495.6406,292.7656 2495.9063,292.5313 Q2496.1719,292.2969 2496.7813,292.2969 L2498.5,292.2969 L2498.5,285.6406 L2496.7813,285.6406 Q2496.1719,285.6406 2495.9063,285.4063 Q2495.6406,285.1719 2495.6406,284.7813 Q2495.6406,284.4063 2495.9063,284.1719 Q2496.1719,283.9375 2496.7813,283.9375 L2501.9219,283.9375 Q2502.5313,283.9375 2502.7969,284.1719 Q2503.0625,284.4063 2503.0625,284.7813 Q2503.0625,285.1719 2502.7969,285.4063 Q2502.5313,285.6406 2501.9219,285.6406 L2500.2031,285.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="86" x="2519.75" y="294.7285">IUserProvider</text><line style="stroke:#181818;stroke-width:0.5;" x1="2349" x2="2744" y1="305" y2="305"/><line style="stroke:#181818;stroke-width:0.5;" x1="2349" x2="2744" y1="313" y2="313"/><ellipse cx="2359" cy="327.3047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="356" x="2368" y="331.5332">CreateUserAsync(userCreate : DbUser) : Task&lt;DbUser&gt;</text><ellipse cx="2359" cy="344.9141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="336" x="2368" y="349.1426">GetUserByEmailAsync(email : string) : Task&lt;DbUser&gt;</text><ellipse cx="2359" cy="362.5234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="271" x="2368" y="366.752">GetUserByIdAsync(id : int) : Task&lt;DbUser&gt;</text><ellipse cx="2359" cy="380.1328" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="327" x="2368" y="384.3613">UpdateUserFailedTries(userId : int) : Task&lt;DbUser&gt;</text><ellipse cx="2359" cy="397.7422" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="344" x="2368" y="401.9707">UpdateUserLoginSuccess(userId : int) : Task&lt;DbUser&gt;</text><ellipse cx="2359" cy="415.3516" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="371" x="2368" y="419.5801">UpdateUserLoginNewLocation(userId : int) : Task&lt;DbUser&gt;</text></g><!--MD5=[e3292821846300d7b478166358ada8cf]
class ILeakedPasswordProvider--><g id="elem_ILeakedPasswordProvider"><rect codeLine="95" fill="#F1F1F1" height="65.6094" id="ILeakedPasswordProvider" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="408" x="2780.5" y="317"/><ellipse cx="2897.75" cy="333" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M2898.7031,329.6406 L2898.7031,336.2969 L2900.4219,336.2969 Q2901.0313,336.2969 2901.2969,336.5313 Q2901.5625,336.7656 2901.5625,337.1563 Q2901.5625,337.5313 2901.2969,337.7656 Q2901.0313,338 2900.4219,338 L2895.2813,338 Q2894.6719,338 2894.4063,337.7656 Q2894.1406,337.5313 2894.1406,337.1406 Q2894.1406,336.7656 2894.4063,336.5313 Q2894.6719,336.2969 2895.2813,336.2969 L2897,336.2969 L2897,329.6406 L2895.2813,329.6406 Q2894.6719,329.6406 2894.4063,329.4063 Q2894.1406,329.1719 2894.1406,328.7813 Q2894.1406,328.4063 2894.4063,328.1719 Q2894.6719,327.9375 2895.2813,327.9375 L2900.4219,327.9375 Q2901.0313,327.9375 2901.2969,328.1719 Q2901.5625,328.4063 2901.5625,328.7813 Q2901.5625,329.1719 2901.2969,329.4063 Q2901.0313,329.6406 2900.4219,329.6406 L2898.7031,329.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="165" x="2918.25" y="338.7285">ILeakedPasswordProvider</text><line style="stroke:#181818;stroke-width:0.5;" x1="2781.5" x2="3187.5" y1="349" y2="349"/><line style="stroke:#181818;stroke-width:0.5;" x1="2781.5" x2="3187.5" y1="357" y2="357"/><ellipse cx="2791.5" cy="371.3047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="382" x="2800.5" y="375.5332">GetIsPasswordLeakedAsync(password : string) : Task&lt;bool&gt;</text></g><!--MD5=[88f66da615ead437be96f70edff3214c]
class UserToken--><g id="elem_UserToken"><rect codeLine="159" fill="#F1F1F1" height="100.8281" id="UserToken" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="113" x="226" y="513.5"/><ellipse cx="246.4" cy="529.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M249.1656,525.375 Q249.3219,525.1563 249.5094,525.0469 Q249.6969,524.9375 249.9156,524.9375 Q250.2906,524.9375 250.525,525.1953 Q250.7594,525.4531 250.7594,526.0625 L250.7594,527.5156 Q250.7594,528.125 250.525,528.3906 Q250.2906,528.6563 249.9156,528.6563 Q249.5719,528.6563 249.3688,528.4531 Q249.1656,528.2656 249.0563,527.75 Q249.0094,527.3906 248.8219,527.2031 Q248.4938,526.8281 247.8844,526.6094 Q247.275,526.3906 246.65,526.3906 Q245.8844,526.3906 245.2516,526.7188 Q244.6188,527.0469 244.1266,527.7969 Q243.6344,528.5469 243.6344,529.5781 L243.6344,530.6719 Q243.6344,531.9063 244.525,532.7266 Q245.4156,533.5469 247.0094,533.5469 Q247.9469,533.5469 248.6031,533.2969 Q248.9938,533.1406 249.4156,532.7031 Q249.6813,532.4375 249.8297,532.3594 Q249.9781,532.2813 250.1813,532.2813 Q250.5094,532.2813 250.7672,532.5391 Q251.025,532.7969 251.025,533.1406 Q251.025,533.4844 250.6813,533.8906 Q250.1813,534.4688 249.3844,534.7969 Q248.3063,535.25 247.0094,535.25 Q245.4938,535.25 244.2906,534.625 Q243.3063,534.125 242.6188,533.0547 Q241.9313,531.9844 241.9313,530.7031 L241.9313,529.5469 Q241.9313,528.2188 242.5484,527.0703 Q243.1656,525.9219 244.2594,525.3047 Q245.3531,524.6875 246.5875,524.6875 Q247.3219,524.6875 247.9703,524.8516 Q248.6188,525.0156 249.1656,525.375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="261.6" y="535.2285">UserToken</text><line style="stroke:#181818;stroke-width:0.5;" x1="227" x2="338" y1="545.5" y2="545.5"/><ellipse cx="237" cy="559.8047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="246" y="564.0332">UserID : int</text><ellipse cx="237" cy="577.4141" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="246" y="581.6426">Email : string</text><ellipse cx="237" cy="595.0234" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="246" y="599.252">Token : string</text><line style="stroke:#181818;stroke-width:0.5;" x1="227" x2="338" y1="606.3281" y2="606.3281"/></g><!--MD5=[3a13148eff96962085f13babcc0d4f9f]
class IUserLocationProvider--><g id="elem_IUserLocationProvider"><rect codeLine="111" fill="#F1F1F1" height="100.8281" id="IUserLocationProvider" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="540" x="1197.5" y="299.5"/><ellipse cx="1393.25" cy="315.5" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1394.2031,312.1406 L1394.2031,318.7969 L1395.9219,318.7969 Q1396.5313,318.7969 1396.7969,319.0313 Q1397.0625,319.2656 1397.0625,319.6563 Q1397.0625,320.0313 1396.7969,320.2656 Q1396.5313,320.5 1395.9219,320.5 L1390.7813,320.5 Q1390.1719,320.5 1389.9063,320.2656 Q1389.6406,320.0313 1389.6406,319.6406 Q1389.6406,319.2656 1389.9063,319.0313 Q1390.1719,318.7969 1390.7813,318.7969 L1392.5,318.7969 L1392.5,312.1406 L1390.7813,312.1406 Q1390.1719,312.1406 1389.9063,311.9063 Q1389.6406,311.6719 1389.6406,311.2813 Q1389.6406,310.9063 1389.9063,310.6719 Q1390.1719,310.4375 1390.7813,310.4375 L1395.9219,310.4375 Q1396.5313,310.4375 1396.7969,310.6719 Q1397.0625,310.9063 1397.0625,311.2813 Q1397.0625,311.6719 1396.7969,311.9063 Q1396.5313,312.1406 1395.9219,312.1406 L1394.2031,312.1406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="140" x="1413.75" y="321.2285">IUserLocationProvider</text><line style="stroke:#181818;stroke-width:0.5;" x1="1198.5" x2="1736.5" y1="331.5" y2="331.5"/><line style="stroke:#181818;stroke-width:0.5;" x1="1198.5" x2="1736.5" y1="339.5" y2="339.5"/><ellipse cx="1208.5" cy="353.8047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="260" x="1217.5" y="358.0332">IsIPLockedAsync(ip : string) : Task&lt;bool&gt;</text><ellipse cx="1208.5" cy="371.4141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="441" x="1217.5" y="375.6426">LogLocationAsync(userLocation: UserLocation) : Task&lt;UserLocation&gt;</text><ellipse cx="1208.5" cy="389.0234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="514" x="1217.5" y="393.252">UserWasLoggedInFromLocationAsync(userLocation : UserLocation) : Task&lt;bool&gt;</text></g><!--MD5=[3a675687b1cd1bb713529f5053553131]
class SqlProvider--><g id="elem_SqlProvider"><rect codeLine="99" fill="#F1F1F1" height="118.4375" id="SqlProvider" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="700" x="3223.5" y="291"/><ellipse cx="3532.75" cy="307" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M3535.5156,302.875 Q3535.6719,302.6563 3535.8594,302.5469 Q3536.0469,302.4375 3536.2656,302.4375 Q3536.6406,302.4375 3536.875,302.6953 Q3537.1094,302.9531 3537.1094,303.5625 L3537.1094,305.0156 Q3537.1094,305.625 3536.875,305.8906 Q3536.6406,306.1563 3536.2656,306.1563 Q3535.9219,306.1563 3535.7188,305.9531 Q3535.5156,305.7656 3535.4063,305.25 Q3535.3594,304.8906 3535.1719,304.7031 Q3534.8438,304.3281 3534.2344,304.1094 Q3533.625,303.8906 3533,303.8906 Q3532.2344,303.8906 3531.6016,304.2188 Q3530.9688,304.5469 3530.4766,305.2969 Q3529.9844,306.0469 3529.9844,307.0781 L3529.9844,308.1719 Q3529.9844,309.4063 3530.875,310.2266 Q3531.7656,311.0469 3533.3594,311.0469 Q3534.2969,311.0469 3534.9531,310.7969 Q3535.3438,310.6406 3535.7656,310.2031 Q3536.0313,309.9375 3536.1797,309.8594 Q3536.3281,309.7813 3536.5313,309.7813 Q3536.8594,309.7813 3537.1172,310.0391 Q3537.375,310.2969 3537.375,310.6406 Q3537.375,310.9844 3537.0313,311.3906 Q3536.5313,311.9688 3535.7344,312.2969 Q3534.6563,312.75 3533.3594,312.75 Q3531.8438,312.75 3530.6406,312.125 Q3529.6563,311.625 3528.9688,310.5547 Q3528.2813,309.4844 3528.2813,308.2031 L3528.2813,307.0469 Q3528.2813,305.7188 3528.8984,304.5703 Q3529.5156,303.4219 3530.6094,302.8047 Q3531.7031,302.1875 3532.9375,302.1875 Q3533.6719,302.1875 3534.3203,302.3516 Q3534.9688,302.5156 3535.5156,302.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="3553.25" y="312.7285">SqlProvider</text><line style="stroke:#181818;stroke-width:0.5;" x1="3224.5" x2="3922.5" y1="323" y2="323"/><line style="stroke:#181818;stroke-width:0.5;" x1="3224.5" x2="3922.5" y1="331" y2="331"/><ellipse cx="3234.5" cy="345.3047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="199" x="3243.5" y="349.5332">SqlProvider(connection : string)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="3243.5" y="367.1426"> </text><polygon fill="#FFFF44" points="3234.5,375.5234,3238.5,379.5234,3234.5,383.5234,3230.5,379.5234" style="stroke:#B38D22;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="674" x="3243.5" y="384.752">RunSpAsync(storedProcedureName : string, storedProcedureElements : SpElements[]) : Task&lt;DataTable&gt;</text><polygon fill="#FFFF44" points="3234.5,393.1328,3238.5,397.1328,3234.5,401.1328,3230.5,397.1328" style="stroke:#B38D22;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="322" x="3243.5" y="402.3613">RunQueryAsync(query : string) : Task&lt;DataTable&gt;</text></g><!--MD5=[54606654dd7012b88529a0f0305a5f2d]
class LeakedPasswordProvider--><g id="elem_LeakedPasswordProvider"><rect codeLine="106" fill="#F1F1F1" height="65.6094" id="LeakedPasswordProvider" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="379" x="3362" y="77"/><ellipse cx="3466.75" cy="93" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M3469.5156,88.875 Q3469.6719,88.6563 3469.8594,88.5469 Q3470.0469,88.4375 3470.2656,88.4375 Q3470.6406,88.4375 3470.875,88.6953 Q3471.1094,88.9531 3471.1094,89.5625 L3471.1094,91.0156 Q3471.1094,91.625 3470.875,91.8906 Q3470.6406,92.1563 3470.2656,92.1563 Q3469.9219,92.1563 3469.7188,91.9531 Q3469.5156,91.7656 3469.4063,91.25 Q3469.3594,90.8906 3469.1719,90.7031 Q3468.8438,90.3281 3468.2344,90.1094 Q3467.625,89.8906 3467,89.8906 Q3466.2344,89.8906 3465.6016,90.2188 Q3464.9688,90.5469 3464.4766,91.2969 Q3463.9844,92.0469 3463.9844,93.0781 L3463.9844,94.1719 Q3463.9844,95.4063 3464.875,96.2266 Q3465.7656,97.0469 3467.3594,97.0469 Q3468.2969,97.0469 3468.9531,96.7969 Q3469.3438,96.6406 3469.7656,96.2031 Q3470.0313,95.9375 3470.1797,95.8594 Q3470.3281,95.7813 3470.5313,95.7813 Q3470.8594,95.7813 3471.1172,96.0391 Q3471.375,96.2969 3471.375,96.6406 Q3471.375,96.9844 3471.0313,97.3906 Q3470.5313,97.9688 3469.7344,98.2969 Q3468.6563,98.75 3467.3594,98.75 Q3465.8438,98.75 3464.6406,98.125 Q3463.6563,97.625 3462.9688,96.5547 Q3462.2813,95.4844 3462.2813,94.2031 L3462.2813,93.0469 Q3462.2813,91.7188 3462.8984,90.5703 Q3463.5156,89.4219 3464.6094,88.8047 Q3465.7031,88.1875 3466.9375,88.1875 Q3467.6719,88.1875 3468.3203,88.3516 Q3468.9688,88.5156 3469.5156,88.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="161" x="3487.25" y="98.7285">LeakedPasswordProvider</text><line style="stroke:#181818;stroke-width:0.5;" x1="3363" x2="3740" y1="109" y2="109"/><ellipse cx="3373" cy="123.3047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="353" x="3382" y="127.5332">LeakedPasswordProvider(configuration : IConfiguration)</text><line style="stroke:#181818;stroke-width:1.0;" x1="3363" x2="3740" y1="134.6094" y2="134.6094"/></g><!--MD5=[615787437c5f23b61c90c6d240d4b67f]
class UserProvider--><g id="elem_UserProvider"><rect codeLine="117" fill="#F1F1F1" height="83.2188" id="UserProvider" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="300" x="2983.5" y="68.5"/><ellipse cx="3088.25" cy="84.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M3091.0156,80.375 Q3091.1719,80.1563 3091.3594,80.0469 Q3091.5469,79.9375 3091.7656,79.9375 Q3092.1406,79.9375 3092.375,80.1953 Q3092.6094,80.4531 3092.6094,81.0625 L3092.6094,82.5156 Q3092.6094,83.125 3092.375,83.3906 Q3092.1406,83.6563 3091.7656,83.6563 Q3091.4219,83.6563 3091.2188,83.4531 Q3091.0156,83.2656 3090.9063,82.75 Q3090.8594,82.3906 3090.6719,82.2031 Q3090.3438,81.8281 3089.7344,81.6094 Q3089.125,81.3906 3088.5,81.3906 Q3087.7344,81.3906 3087.1016,81.7188 Q3086.4688,82.0469 3085.9766,82.7969 Q3085.4844,83.5469 3085.4844,84.5781 L3085.4844,85.6719 Q3085.4844,86.9063 3086.375,87.7266 Q3087.2656,88.5469 3088.8594,88.5469 Q3089.7969,88.5469 3090.4531,88.2969 Q3090.8438,88.1406 3091.2656,87.7031 Q3091.5313,87.4375 3091.6797,87.3594 Q3091.8281,87.2813 3092.0313,87.2813 Q3092.3594,87.2813 3092.6172,87.5391 Q3092.875,87.7969 3092.875,88.1406 Q3092.875,88.4844 3092.5313,88.8906 Q3092.0313,89.4688 3091.2344,89.7969 Q3090.1563,90.25 3088.8594,90.25 Q3087.3438,90.25 3086.1406,89.625 Q3085.1563,89.125 3084.4688,88.0547 Q3083.7813,86.9844 3083.7813,85.7031 L3083.7813,84.5469 Q3083.7813,83.2188 3084.3984,82.0703 Q3085.0156,80.9219 3086.1094,80.3047 Q3087.2031,79.6875 3088.4375,79.6875 Q3089.1719,79.6875 3089.8203,79.8516 Q3090.4688,80.0156 3091.0156,80.375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="3108.75" y="90.2285">UserProvider</text><line style="stroke:#181818;stroke-width:0.5;" x1="2984.5" x2="3282.5" y1="100.5" y2="100.5"/><ellipse cx="2994.5" cy="114.8047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="274" x="3003.5" y="119.0332">UserProvider(configuration : IConfiguration)</text><line style="stroke:#181818;stroke-width:1.0;" x1="2984.5" x2="3282.5" y1="126.1094" y2="126.1094"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="2991.5" y="137.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="217" x="3003.5" y="144.6426">DRToUser(dr : DataRow) : DbUser</text></g><!--MD5=[a2d8207c5488f269b0816fb28beca551]
class DbUser--><g id="elem_DbUser"><rect codeLine="173" fill="#F1F1F1" height="136.0469" id="DbUser" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="210" x="2013.5" y="496"/><ellipse cx="2090.75" cy="512" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M2093.5156,507.875 Q2093.6719,507.6563 2093.8594,507.5469 Q2094.0469,507.4375 2094.2656,507.4375 Q2094.6406,507.4375 2094.875,507.6953 Q2095.1094,507.9531 2095.1094,508.5625 L2095.1094,510.0156 Q2095.1094,510.625 2094.875,510.8906 Q2094.6406,511.1563 2094.2656,511.1563 Q2093.9219,511.1563 2093.7188,510.9531 Q2093.5156,510.7656 2093.4063,510.25 Q2093.3594,509.8906 2093.1719,509.7031 Q2092.8438,509.3281 2092.2344,509.1094 Q2091.625,508.8906 2091,508.8906 Q2090.2344,508.8906 2089.6016,509.2188 Q2088.9688,509.5469 2088.4766,510.2969 Q2087.9844,511.0469 2087.9844,512.0781 L2087.9844,513.1719 Q2087.9844,514.4063 2088.875,515.2266 Q2089.7656,516.0469 2091.3594,516.0469 Q2092.2969,516.0469 2092.9531,515.7969 Q2093.3438,515.6406 2093.7656,515.2031 Q2094.0313,514.9375 2094.1797,514.8594 Q2094.3281,514.7813 2094.5313,514.7813 Q2094.8594,514.7813 2095.1172,515.0391 Q2095.375,515.2969 2095.375,515.6406 Q2095.375,515.9844 2095.0313,516.3906 Q2094.5313,516.9688 2093.7344,517.2969 Q2092.6563,517.75 2091.3594,517.75 Q2089.8438,517.75 2088.6406,517.125 Q2087.6563,516.625 2086.9688,515.5547 Q2086.2813,514.4844 2086.2813,513.2031 L2086.2813,512.0469 Q2086.2813,510.7188 2086.8984,509.5703 Q2087.5156,508.4219 2088.6094,507.8047 Q2089.7031,507.1875 2090.9375,507.1875 Q2091.6719,507.1875 2092.3203,507.3516 Q2092.9688,507.5156 2093.5156,507.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="2111.25" y="517.7285">DbUser</text><line style="stroke:#181818;stroke-width:0.5;" x1="2014.5" x2="2222.5" y1="528" y2="528"/><ellipse cx="2024.5" cy="542.3047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="156" x="2033.5" y="546.5332">HashedPassword : string</text><ellipse cx="2024.5" cy="559.9141" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="2033.5" y="564.1426">Salt : string</text><ellipse cx="2024.5" cy="577.5234" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="2033.5" y="581.752">SecretKey : string</text><ellipse cx="2024.5" cy="595.1328" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="2033.5" y="599.3613">Count : long</text><ellipse cx="2024.5" cy="612.7422" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="184" x="2033.5" y="616.9707">LastRequestDate : datetime?</text><line style="stroke:#181818;stroke-width:0.5;" x1="2014.5" x2="2222.5" y1="624.0469" y2="624.0469"/></g><!--MD5=[1a3d1e414f70b9a6597f64281cc6a626]
class UserLocation--><g id="elem_UserLocation"><rect codeLine="198" fill="#F1F1F1" height="153.6563" id="UserLocation" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="165" x="1385" y="487"/><ellipse cx="1422.5" cy="503" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1425.2656,498.875 Q1425.4219,498.6563 1425.6094,498.5469 Q1425.7969,498.4375 1426.0156,498.4375 Q1426.3906,498.4375 1426.625,498.6953 Q1426.8594,498.9531 1426.8594,499.5625 L1426.8594,501.0156 Q1426.8594,501.625 1426.625,501.8906 Q1426.3906,502.1563 1426.0156,502.1563 Q1425.6719,502.1563 1425.4688,501.9531 Q1425.2656,501.7656 1425.1563,501.25 Q1425.1094,500.8906 1424.9219,500.7031 Q1424.5938,500.3281 1423.9844,500.1094 Q1423.375,499.8906 1422.75,499.8906 Q1421.9844,499.8906 1421.3516,500.2188 Q1420.7188,500.5469 1420.2266,501.2969 Q1419.7344,502.0469 1419.7344,503.0781 L1419.7344,504.1719 Q1419.7344,505.4063 1420.625,506.2266 Q1421.5156,507.0469 1423.1094,507.0469 Q1424.0469,507.0469 1424.7031,506.7969 Q1425.0938,506.6406 1425.5156,506.2031 Q1425.7813,505.9375 1425.9297,505.8594 Q1426.0781,505.7813 1426.2813,505.7813 Q1426.6094,505.7813 1426.8672,506.0391 Q1427.125,506.2969 1427.125,506.6406 Q1427.125,506.9844 1426.7813,507.3906 Q1426.2813,507.9688 1425.4844,508.2969 Q1424.4063,508.75 1423.1094,508.75 Q1421.5938,508.75 1420.3906,508.125 Q1419.4063,507.625 1418.7188,506.5547 Q1418.0313,505.4844 1418.0313,504.2031 L1418.0313,503.0469 Q1418.0313,501.7188 1418.6484,500.5703 Q1419.2656,499.4219 1420.3594,498.8047 Q1421.4531,498.1875 1422.6875,498.1875 Q1423.4219,498.1875 1424.0703,498.3516 Q1424.7188,498.5156 1425.2656,498.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="1441.5" y="508.7285">UserLocation</text><line style="stroke:#181818;stroke-width:0.5;" x1="1386" x2="1549" y1="519" y2="519"/><ellipse cx="1396" cy="533.3047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="1405" y="537.5332">ID : int</text><ellipse cx="1396" cy="550.9141" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="1405" y="555.1426">UserID : int</text><ellipse cx="1396" cy="568.5234" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="1405" y="572.752">IP : string</text><ellipse cx="1396" cy="586.1328" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="1405" y="590.3613">UserAgent : string</text><ellipse cx="1396" cy="603.7422" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="1405" y="607.9707">Successful : bool</text><ellipse cx="1396" cy="621.3516" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="1405" y="625.5801">CreateDate : datetime</text><line style="stroke:#181818;stroke-width:0.5;" x1="1386" x2="1549" y1="632.6563" y2="632.6563"/></g><!--MD5=[c40368751ea5476301fbcdc8cb25eba8]
class Security--><g id="elem_Security"><rect codeLine="138" fill="#F1F1F1" height="136.0469" id="Security" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="480" x="3776.5" y="42"/><ellipse cx="3986.75" cy="58" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M3989.5156,53.875 Q3989.6719,53.6563 3989.8594,53.5469 Q3990.0469,53.4375 3990.2656,53.4375 Q3990.6406,53.4375 3990.875,53.6953 Q3991.1094,53.9531 3991.1094,54.5625 L3991.1094,56.0156 Q3991.1094,56.625 3990.875,56.8906 Q3990.6406,57.1563 3990.2656,57.1563 Q3989.9219,57.1563 3989.7188,56.9531 Q3989.5156,56.7656 3989.4063,56.25 Q3989.3594,55.8906 3989.1719,55.7031 Q3988.8438,55.3281 3988.2344,55.1094 Q3987.625,54.8906 3987,54.8906 Q3986.2344,54.8906 3985.6016,55.2188 Q3984.9688,55.5469 3984.4766,56.2969 Q3983.9844,57.0469 3983.9844,58.0781 L3983.9844,59.1719 Q3983.9844,60.4063 3984.875,61.2266 Q3985.7656,62.0469 3987.3594,62.0469 Q3988.2969,62.0469 3988.9531,61.7969 Q3989.3438,61.6406 3989.7656,61.2031 Q3990.0313,60.9375 3990.1797,60.8594 Q3990.3281,60.7813 3990.5313,60.7813 Q3990.8594,60.7813 3991.1172,61.0391 Q3991.375,61.2969 3991.375,61.6406 Q3991.375,61.9844 3991.0313,62.3906 Q3990.5313,62.9688 3989.7344,63.2969 Q3988.6563,63.75 3987.3594,63.75 Q3985.8438,63.75 3984.6406,63.125 Q3983.6563,62.625 3982.9688,61.5547 Q3982.2813,60.4844 3982.2813,59.2031 L3982.2813,58.0469 Q3982.2813,56.7188 3982.8984,55.5703 Q3983.5156,54.4219 3984.6094,53.8047 Q3985.7031,53.1875 3986.9375,53.1875 Q3987.6719,53.1875 3988.3203,53.3516 Q3988.9688,53.5156 3989.5156,53.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="4007.25" y="63.7285">Security</text><line style="stroke:#181818;stroke-width:0.5;" x1="3777.5" x2="4255.5" y1="74" y2="74"/><line style="stroke:#181818;stroke-width:0.5;" x1="3777.5" x2="4255.5" y1="82" y2="82"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="3784.5" y="93.3047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="312" x="3796.5" y="100.5332">GetEncryptedPassword(password : string) : string</text><ellipse cx="3787.5" cy="113.9141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="197" x="3796.5" y="118.1426">GetSalt(saltLength : int) : string</text><ellipse cx="3787.5" cy="131.5234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="454" x="3796.5" y="135.752">GetEncryptedAndSaltedPassword(password : string, salt : string) : string</text><ellipse cx="3787.5" cy="149.1328" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="273" x="3796.5" y="153.3613">GetHotp(key : string, counter : long) : string</text><ellipse cx="3787.5" cy="166.7422" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="139" x="3796.5" y="170.9707">GetHmacKey() : string</text></g><!--MD5=[530bdd8d88d30015127c6b1b07c38463]
class RegexHelper--><g id="elem_RegexHelper"><rect codeLine="146" fill="#F1F1F1" height="65.6094" id="RegexHelper" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="388" x="4291.5" y="77"/><ellipse cx="4440.75" cy="93" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M4443.5156,88.875 Q4443.6719,88.6563 4443.8594,88.5469 Q4444.0469,88.4375 4444.2656,88.4375 Q4444.6406,88.4375 4444.875,88.6953 Q4445.1094,88.9531 4445.1094,89.5625 L4445.1094,91.0156 Q4445.1094,91.625 4444.875,91.8906 Q4444.6406,92.1563 4444.2656,92.1563 Q4443.9219,92.1563 4443.7188,91.9531 Q4443.5156,91.7656 4443.4063,91.25 Q4443.3594,90.8906 4443.1719,90.7031 Q4442.8438,90.3281 4442.2344,90.1094 Q4441.625,89.8906 4441,89.8906 Q4440.2344,89.8906 4439.6016,90.2188 Q4438.9688,90.5469 4438.4766,91.2969 Q4437.9844,92.0469 4437.9844,93.0781 L4437.9844,94.1719 Q4437.9844,95.4063 4438.875,96.2266 Q4439.7656,97.0469 4441.3594,97.0469 Q4442.2969,97.0469 4442.9531,96.7969 Q4443.3438,96.6406 4443.7656,96.2031 Q4444.0313,95.9375 4444.1797,95.8594 Q4444.3281,95.7813 4444.5313,95.7813 Q4444.8594,95.7813 4445.1172,96.0391 Q4445.375,96.2969 4445.375,96.6406 Q4445.375,96.9844 4445.0313,97.3906 Q4444.5313,97.9688 4443.7344,98.2969 Q4442.6563,98.75 4441.3594,98.75 Q4439.8438,98.75 4438.6406,98.125 Q4437.6563,97.625 4436.9688,96.5547 Q4436.2813,95.4844 4436.2813,94.2031 L4436.2813,93.0469 Q4436.2813,91.7188 4436.8984,90.5703 Q4437.5156,89.4219 4438.6094,88.8047 Q4439.7031,88.1875 4440.9375,88.1875 Q4441.6719,88.1875 4442.3203,88.3516 Q4442.9688,88.5156 4443.5156,88.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="4461.25" y="98.7285">RegexHelper</text><line style="stroke:#181818;stroke-width:0.5;" x1="4292.5" x2="4678.5" y1="109" y2="109"/><line style="stroke:#181818;stroke-width:0.5;" x1="4292.5" x2="4678.5" y1="117" y2="117"/><ellipse cx="4302.5" cy="131.3047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="362" x="4311.5" y="135.5332">TryToGetBrowserWithoutVersion(browser : string) : string</text></g><!--MD5=[3fd616f346a44cd59a91eb10b19e157c]
class User--><g id="elem_User"><rect codeLine="165" fill="#F1F1F1" height="136.0469" id="User" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="168" x="1836.5" y="701"/><ellipse cx="1901.75" cy="717" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1904.5156,712.875 Q1904.6719,712.6563 1904.8594,712.5469 Q1905.0469,712.4375 1905.2656,712.4375 Q1905.6406,712.4375 1905.875,712.6953 Q1906.1094,712.9531 1906.1094,713.5625 L1906.1094,715.0156 Q1906.1094,715.625 1905.875,715.8906 Q1905.6406,716.1563 1905.2656,716.1563 Q1904.9219,716.1563 1904.7188,715.9531 Q1904.5156,715.7656 1904.4063,715.25 Q1904.3594,714.8906 1904.1719,714.7031 Q1903.8438,714.3281 1903.2344,714.1094 Q1902.625,713.8906 1902,713.8906 Q1901.2344,713.8906 1900.6016,714.2188 Q1899.9688,714.5469 1899.4766,715.2969 Q1898.9844,716.0469 1898.9844,717.0781 L1898.9844,718.1719 Q1898.9844,719.4063 1899.875,720.2266 Q1900.7656,721.0469 1902.3594,721.0469 Q1903.2969,721.0469 1903.9531,720.7969 Q1904.3438,720.6406 1904.7656,720.2031 Q1905.0313,719.9375 1905.1797,719.8594 Q1905.3281,719.7813 1905.5313,719.7813 Q1905.8594,719.7813 1906.1172,720.0391 Q1906.375,720.2969 1906.375,720.6406 Q1906.375,720.9844 1906.0313,721.3906 Q1905.5313,721.9688 1904.7344,722.2969 Q1903.6563,722.75 1902.3594,722.75 Q1900.8438,722.75 1899.6406,722.125 Q1898.6563,721.625 1897.9688,720.5547 Q1897.2813,719.4844 1897.2813,718.2031 L1897.2813,717.0469 Q1897.2813,715.7188 1897.8984,714.5703 Q1898.5156,713.4219 1899.6094,712.8047 Q1900.7031,712.1875 1901.9375,712.1875 Q1902.6719,712.1875 1903.3203,712.3516 Q1903.9688,712.5156 1904.5156,712.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="1922.25" y="722.7285">User</text><line style="stroke:#181818;stroke-width:0.5;" x1="1837.5" x2="2003.5" y1="733" y2="733"/><ellipse cx="1847.5" cy="747.3047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="1856.5" y="751.5332">ID : int</text><ellipse cx="1847.5" cy="764.9141" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97" x="1856.5" y="769.1426">IsVerified : bool</text><ellipse cx="1847.5" cy="782.5234" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="1856.5" y="786.752">IsLocked : bool</text><ellipse cx="1847.5" cy="800.1328" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="1856.5" y="804.3613">FailedTries : int</text><ellipse cx="1847.5" cy="817.7422" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="142" x="1856.5" y="821.9707">LockedDate datetime?</text><line style="stroke:#181818;stroke-width:0.5;" x1="1837.5" x2="2003.5" y1="829.0469" y2="829.0469"/></g><!--MD5=[d72258e41e132b68712ed2a953e26009]
class UserBase--><g id="elem_UserBase"><rect codeLine="185" fill="#F1F1F1" height="118.4375" id="UserBase" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="1549" y="897"/><ellipse cx="1595.75" cy="913" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1598.5156,908.875 Q1598.6719,908.6563 1598.8594,908.5469 Q1599.0469,908.4375 1599.2656,908.4375 Q1599.6406,908.4375 1599.875,908.6953 Q1600.1094,908.9531 1600.1094,909.5625 L1600.1094,911.0156 Q1600.1094,911.625 1599.875,911.8906 Q1599.6406,912.1563 1599.2656,912.1563 Q1598.9219,912.1563 1598.7188,911.9531 Q1598.5156,911.7656 1598.4063,911.25 Q1598.3594,910.8906 1598.1719,910.7031 Q1597.8438,910.3281 1597.2344,910.1094 Q1596.625,909.8906 1596,909.8906 Q1595.2344,909.8906 1594.6016,910.2188 Q1593.9688,910.5469 1593.4766,911.2969 Q1592.9844,912.0469 1592.9844,913.0781 L1592.9844,914.1719 Q1592.9844,915.4063 1593.875,916.2266 Q1594.7656,917.0469 1596.3594,917.0469 Q1597.2969,917.0469 1597.9531,916.7969 Q1598.3438,916.6406 1598.7656,916.2031 Q1599.0313,915.9375 1599.1797,915.8594 Q1599.3281,915.7813 1599.5313,915.7813 Q1599.8594,915.7813 1600.1172,916.0391 Q1600.375,916.2969 1600.375,916.6406 Q1600.375,916.9844 1600.0313,917.3906 Q1599.5313,917.9688 1598.7344,918.2969 Q1597.6563,918.75 1596.3594,918.75 Q1594.8438,918.75 1593.6406,918.125 Q1592.6563,917.625 1591.9688,916.5547 Q1591.2813,915.4844 1591.2813,914.2031 L1591.2813,913.0469 Q1591.2813,911.7188 1591.8984,910.5703 Q1592.5156,909.4219 1593.6094,908.8047 Q1594.7031,908.1875 1595.9375,908.1875 Q1596.6719,908.1875 1597.3203,908.3516 Q1597.9688,908.5156 1598.5156,908.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="1616.25" y="918.7285">UserBase</text><line style="stroke:#181818;stroke-width:0.5;" x1="1550" x2="1711" y1="929" y2="929"/><ellipse cx="1560" cy="943.3047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="1569" y="947.5332">Email : string</text><ellipse cx="1560" cy="960.9141" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="1569" y="965.1426">FirstName : string</text><ellipse cx="1560" cy="978.5234" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110" x="1569" y="982.752">LastName : string</text><ellipse cx="1560" cy="996.1328" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137" x="1569" y="1000.3613">PhoneNumber : string</text><line style="stroke:#181818;stroke-width:0.5;" x1="1550" x2="1711" y1="1007.4375" y2="1007.4375"/></g><!--MD5=[1dfc107116a4b0bc1198698a4e609bfa]
reverse link UserController to IUserManager--><g id="link_UserController_IUserManager"><path codeLine="19" d="M835.5,217.75 C835.5,242.85 835.5,268.68 835.5,290.72 " fill="none" id="UserController-backto-IUserManager" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="835.5,204.72,831.5,210.72,835.5,216.72,839.5,210.72,835.5,204.72" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[548e9c59867ce01a8de3c5e8efb076c9]
reverse link UserController to ITokenManager--><g id="link_UserController_ITokenManager"><path codeLine="20" d="M606.17,209.7 C534.29,240.64 458.02,273.46 397.59,299.47 " fill="none" id="UserController-backto-ITokenManager" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="618.13,204.55,611.0372,203.2492,607.1085,209.2961,614.2013,210.5969,618.13,204.55" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[d4b0c0978a527e7d73578f3b8ff1d639]
link IUserManager to UserCreate--><g id="link_IUserManager_UserCreate"><path codeLine="70" d="M933.48,409.2 C1081.64,497.21 1358.16,661.47 1478.75,733.1 " fill="none" id="IUserManager-to-UserCreate" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1483.32,735.82,1477.6093,727.7958,1479.0162,733.2749,1473.5371,734.6819,1483.32,735.82" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[b144519fb167e24c357139cc31a61e5d]
link IUserManager to UserLogin--><g id="link_IUserManager_UserLogin"><path codeLine="71" d="M835.5,409.21 C835.5,443.16 835.5,485.39 835.5,517 " fill="none" id="IUserManager-to-UserLogin" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="835.5,522.37,839.5,513.37,835.5,517.37,831.5,513.37,835.5,522.37" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[5d0d21d87f609d36e9bd211d6cdf12f6]
link UserManager to IUserManager--><g id="link_UserManager_IUserManager"><path codeLine="72" d="M1924.09,186.35 C1860.43,195.78 1795.91,204.93 1734.5,213 C1488.51,245.32 1424.33,232.84 1179.5,273 C1154.49,277.1 1128.56,281.87 1102.67,286.97 " fill="none" id="UserManager-to-IUserManager" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="1103.88,293.87,1082.9,290.94,1101.13,280.14,1103.88,293.87" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[1231944e95ebfb91f3104517f7260a55]
reverse link UserManager to IUserProvider--><g id="link_UserManager_IUserProvider"><path codeLine="74" d="M2466.51,224.56 C2476.99,240.87 2487.55,257.3 2497.42,272.65 " fill="none" id="UserManager-backto-IUserProvider" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="2459.27,213.31,2459.1513,220.5201,2465.7611,223.4029,2465.8798,216.1927,2459.27,213.31" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[536fba823f8263b20c30d29df0fd99b8]
reverse link UserManager to IUserLocationManager--><g id="link_UserManager_IUserLocationManager"><path codeLine="75" d="M2231.98,220.52 C2191.28,248.12 2149.56,276.4 2115.68,299.38 " fill="none" id="UserManager-backto-IUserLocationManager" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="2242.86,213.14,2235.6491,213.1993,2232.9305,219.8783,2240.1414,219.819,2242.86,213.14" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[acaf6dcafaeef567235e025343905109]
reverse link UserManager to ILeakedPasswordProvider--><g id="link_UserManager_ILeakedPasswordProvider"><path codeLine="76" d="M2659.41,218.08 C2748.56,253.98 2841.34,291.35 2904.85,316.92 " fill="none" id="UserManager-backto-ILeakedPasswordProvider" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="2647.14,213.14,2651.2107,219.0922,2658.2708,217.624,2654.2,211.6717,2647.14,213.14" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[f4b9cc5a9edb981f7418b8fcf7de3067]
link TokenManager to ITokenManager--><g id="link_TokenManager_ITokenManager"><path codeLine="78" d="M275.04,151.64 C276.36,186.62 278.3,237.87 279.87,279.37 " fill="none" id="TokenManager-to-ITokenManager" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="286.87,279.2,280.63,299.45,272.88,279.73,286.87,279.2" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[8f9038f41d1a9fcfa0da510f3a7dcbcc]
reverse link ITokenManager to UserToken--><g id="link_ITokenManager_UserToken"><path codeLine="79" d="M282.5,413.88 C282.5,445.62 282.5,483.57 282.5,513.24 " fill="none" id="ITokenManager-backto-UserToken" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="282.5,400.7,278.5,406.7,282.5,412.7,286.5,406.7,282.5,400.7" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[a7358745a089081073f5a601608e5a73]
link UserLocationManager to IUserLocationManager--><g id="link_UserLocationManager_IUserLocationManager"><path codeLine="82" d="M1582.79,151.51 C1672.35,189.98 1807.91,248.22 1908.64,291.49 " fill="none" id="UserLocationManager-to-IUserLocationManager" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="1911.41,285.07,1927.02,299.39,1905.89,297.93,1911.41,285.07" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[0a4ead1edd2c2b1fdc9bf52f1c627135]
reverse link UserLocationManager to IUserLocationProvider--><g id="link_UserLocationManager_IUserLocationProvider"><path codeLine="83" d="M1483.76,164.75 C1480.19,205.16 1475.34,260.1 1471.87,299.45 " fill="none" id="UserLocationManager-backto-IUserLocationProvider" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="1484.91,151.64,1480.3978,157.2649,1483.8545,163.5935,1488.3667,157.9686,1484.91,151.64" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[ebed19925dbee498eddafde4c2e5889a]
reverse link IUserProvider to DbUser--><g id="link_IUserProvider_DbUser"><path codeLine="127" d="M2380.97,432.99 C2328.1,459.18 2271.07,487.43 2223.72,510.88 " fill="none" id="IUserProvider-backto-DbUser" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="2392.89,427.09,2385.7382,426.1675,2382.1359,432.4143,2389.2877,433.3369,2392.89,427.09" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[ebfa5078469ba21b5ab21ca793b470a4]
reverse link IUserLocationProvider to UserLocation--><g id="link_IUserLocationProvider_UserLocation"><path codeLine="128" d="M1467.5,413.75 C1467.5,436.61 1467.5,462.72 1467.5,486.63 " fill="none" id="IUserLocationProvider-backto-UserLocation" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1467.5,400.7,1463.5,406.7,1467.5,412.7,1471.5,406.7,1467.5,400.7" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[1d941831239f3bd1b1ef4931734ff75b]
link LeakedPasswordProvider to ILeakedPasswordProvider--><g id="link_LeakedPasswordProvider_ILeakedPasswordProvider"><path codeLine="130" d="M3475.03,143.1 C3372.59,186.1 3190.85,262.38 3079.67,309.05 " fill="none" id="LeakedPasswordProvider-to-ILeakedPasswordProvider" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="3082.26,315.55,3061.11,316.84,3076.85,302.65,3082.26,315.55" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[d5b7a4ae7f7e8e823301b74032a4bc45]
link LeakedPasswordProvider to SqlProvider--><g id="link_LeakedPasswordProvider_SqlProvider"><path codeLine="131" d="M3554.47,143.1 C3557.48,175.74 3562.27,227.56 3566.29,271.05 " fill="none" id="LeakedPasswordProvider-to-SqlProvider" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="3573.27,270.41,3568.14,290.97,3559.32,271.7,3573.27,270.41" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[2afc5d4273870e4232a4e992ffb1f14d]
link UserProvider to IUserProvider--><g id="link_UserProvider_IUserProvider"><path codeLine="133" d="M3033.59,151.51 C2956.73,182.67 2847.89,226.8 2752.59,265.44 " fill="none" id="UserProvider-to-IUserProvider" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="2755.2,271.94,2734.03,272.96,2749.94,258.96,2755.2,271.94" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[49c1666b2e1039e78c6958b57888cb0d]
link UserProvider to SqlProvider--><g id="link_UserProvider_SqlProvider"><path codeLine="134" d="M3208.64,151.64 C3274.33,187.18 3371.05,239.49 3448.4,281.33 " fill="none" id="UserProvider-to-SqlProvider" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="3451.84,275.24,3466.1,290.91,3445.18,287.55,3451.84,275.24" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[2e2cd1f126b2a0e0fb6dd8bdb0da396b]
link User to UserBase--><g id="link_User_UserBase"><path codeLine="152" d="M1836.23,823.76 C1802.9,845.02 1764.34,869.62 1729.67,891.74 " fill="none" id="User-to-UserBase" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="1733.11,897.85,1712.48,902.7,1725.58,886.04,1733.11,897.85" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[96a28894da16093fd8a9c441876c8015]
link UserCreate to UserBase--><g id="link_UserCreate_UserBase"><path codeLine="153" d="M1553.7,802.22 C1564.31,823.34 1578.66,851.87 1592.07,878.56 " fill="none" id="UserCreate-to-UserBase" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="1598.43,875.62,1601.16,896.63,1585.92,881.91,1598.43,875.62" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[64c091ef33e37a15c4a5aacf767b2a5f]
link DbUser to User--><g id="link_DbUser_User"><path codeLine="155" d="M2053.12,632.03 C2036.23,649.35 2017.85,668.19 2000.31,686.17 " fill="none" id="DbUser-to-User" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="2005.13,691.26,1986.15,700.69,1995.1,681.49,2005.13,691.26" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[032f1aa1d83e3771aad1c151b26ff22f]
@startuml API class diagram

top to bottom direction

'Controllers'

class UserController{
    -_userManager{readonly} : IUserManager
    -_tokenManager : ITokenManager
    +UserController(userManager : IUserManager, tokenManager : ITokenManager)
    
    +Create(userCreate : UserCreate) : Task<ActionResult<UserToken>>
    +Login(userLogin : UserLogin) : Task<ActionResult<UserToken>>
    +GetUserFromToken() : Task<ActionResult<User>>
    +VerificationLogin(userLogin : UserLogin) : Task<ActionResult<UserToken>>
}

'Controllers mappings' 

UserController o- - IUserManager
UserController o- - ITokenManager

'Managers'

Interface IUserManager {
    +CreateUserAsync(userCreate : UserCreate) : Task<User>
    +LoginAsync(userLogin : UserLogin, userLocation : UserLocation) : Task<User>
    +GetUserByIDAsync(id : int) : Task<User>
    +LoginWithVerificationCodeAsync(userLogin : UserLogin, userLocation : UserLocation) : Task<User>
}

interface ITokenManager {
    +GenerateUserToken(user : User) : UserToken
    +ValidateToken(token : string) : bool
    +GetUserTokenFromToken(token : string) : UserToken
}


interface IUserLocationManager {
    +IsIPLockedAsync(ip : string) : Task<bool>
    +LogLocationAsync(userLocation : UserLocation) : Task<UserLocation>
    +UserWasLoggedInFromLocationAsync(userLocation : UserLocation) : Task<bool>
}

class TokenManager {
    -GetPrincipal(token : string) : ClaimsPrincipal
    -ClaimsIdentityToUserToken(identity : ClaimsPrincipal, token : string) : UserToken
}

class UserManager {
    -_userProvider : IUserProvider
    -_leakedPasswordProvider : ILeakedPasswordProvider;
    -_userLocationManager : IUserLocationManager
    -_messageService : IMessageService
    -_messageProvider : IMessageProvider
    -_logger : ILogger<UserManager>
    +UserManager(userProvider : IUserProvider, leakedPasswordProvider : ILeakedPasswordProvider, userLocationManager : IUserLocationManager,
     messageService : IMessageService, messageProvider : IMessageProvider, logger : ILogger<UserManager>)
    - -
    -CheckPasswordLeakedForUser(password : string) : Task<bool>
}

class UserLocationManager {
    -_userLocationProvider : IUserLocationProvider
    +UserLocationManager(userLocationProvider : UserLocationProvider)
}


'Managers mappings'

IUserManager - -> UserCreate
IUserManager - -> UserLogin
UserManager .-|> IUserManager

UserManager o- - IUserProvider
UserManager o- - IUserLocationManager
UserManager o- - ILeakedPasswordProvider

TokenManager .-|> ITokenManager
ITokenManager *- - UserToken


UserLocationManager .-|> IUserLocationManager
UserLocationManager o- - IUserLocationProvider
'Providers'

interface IUserProvider {
    +CreateUserAsync(userCreate : DbUser) : Task<DbUser>
    +GetUserByEmailAsync(email : string) : Task<DbUser>
    +GetUserByIdAsync(id : int) : Task<DbUser>
    +UpdateUserFailedTries(userId : int) : Task<DbUser>
    +UpdateUserLoginSuccess(userId : int) : Task<DbUser>
    +UpdateUserLoginNewLocation(userId : int) : Task<DbUser>
}

interface ILeakedPasswordProvider {
    +GetIsPasswordLeakedAsync(password : string) : Task<bool>
}

class SqlProvider {
    +SqlProvider(connection : string)

    {abstract}#RunSpAsync(storedProcedureName : string, storedProcedureElements : SpElements[]) : Task<DataTable>
    {abstract}#RunQueryAsync(query : string) : Task<DataTable>
}

class LeakedPasswordProvider {
    +LeakedPasswordProvider(configuration : IConfiguration)
    - -
}

interface IUserLocationProvider{
    +IsIPLockedAsync(ip : string) : Task<bool>
    +LogLocationAsync(userLocation: UserLocation) : Task<UserLocation>
    +UserWasLoggedInFromLocationAsync(userLocation : UserLocation) : Task<bool>
}

class UserProvider {
    +UserProvider(configuration : IConfiguration)
    - -
    -DRToUser(dr : DataRow) : DbUser
}



'Providers mappings'

IUserProvider *- - DbUser
IUserLocationProvider *- - UserLocation  

LeakedPasswordProvider .-|> ILeakedPasswordProvider
LeakedPasswordProvider - -|> SqlProvider

UserProvider .-|> IUserProvider
UserProvider - -|> SqlProvider

'Utility'

class Security{
    {static}-GetEncryptedPassword(password : string) : string
    {static}+GetSalt(saltLength : int) : string
    {static}+GetEncryptedAndSaltedPassword(password : string, salt : string) : string
    {static}+GetHotp(key : string, counter : long) : string
    {static}+GetHmacKey() : string
}

class RegexHelper{
    {static}+TryToGetBrowserWithoutVersion(browser : string) : string
}

'Users mappings'

User - -|> UserBase
UserCreate - -|> UserBase

DbUser - -|> User

'User models' 

class UserToken{
    +UserID : int
    +Email : string
    +Token : string
}

class User{
    +ID : int 
    +IsVerified : bool
    +IsLocked : bool
    +FailedTries : int
    +LockedDate datetime?
}

class DbUser{
    +HashedPassword : string
    +Salt : string
    +SecretKey : string
    +Count : long
    +LastRequestDate : datetime?
}

class UserCreate {
    +Password : string
}

class UserBase{
    +Email : string
    +FirstName : string
    +LastName : string
    +PhoneNumber : string
}


class UserLogin{
    +Email : string
    +Password : string 
}

class UserLocation{
    +ID : int
    +UserID : int
    +IP : string
    +UserAgent : string
    +Successful : bool
    +CreateDate : datetime
}


@enduml

@startuml API class diagram

top to bottom direction


class UserController{
    -_userManager{readonly} : IUserManager
    -_tokenManager : ITokenManager
    +UserController(userManager : IUserManager, tokenManager : ITokenManager)
    
    +Create(userCreate : UserCreate) : Task<ActionResult<UserToken>>
    +Login(userLogin : UserLogin) : Task<ActionResult<UserToken>>
    +GetUserFromToken() : Task<ActionResult<User>>
    +VerificationLogin(userLogin : UserLogin) : Task<ActionResult<UserToken>>
}


UserController o- - IUserManager
UserController o- - ITokenManager


Interface IUserManager {
    +CreateUserAsync(userCreate : UserCreate) : Task<User>
    +LoginAsync(userLogin : UserLogin, userLocation : UserLocation) : Task<User>
    +GetUserByIDAsync(id : int) : Task<User>
    +LoginWithVerificationCodeAsync(userLogin : UserLogin, userLocation : UserLocation) : Task<User>
}

interface ITokenManager {
    +GenerateUserToken(user : User) : UserToken
    +ValidateToken(token : string) : bool
    +GetUserTokenFromToken(token : string) : UserToken
}


interface IUserLocationManager {
    +IsIPLockedAsync(ip : string) : Task<bool>
    +LogLocationAsync(userLocation : UserLocation) : Task<UserLocation>
    +UserWasLoggedInFromLocationAsync(userLocation : UserLocation) : Task<bool>
}

class TokenManager {
    -GetPrincipal(token : string) : ClaimsPrincipal
    -ClaimsIdentityToUserToken(identity : ClaimsPrincipal, token : string) : UserToken
}

class UserManager {
    -_userProvider : IUserProvider
    -_leakedPasswordProvider : ILeakedPasswordProvider;
    -_userLocationManager : IUserLocationManager
    -_messageService : IMessageService
    -_messageProvider : IMessageProvider
    -_logger : ILogger<UserManager>
    +UserManager(userProvider : IUserProvider, leakedPasswordProvider : ILeakedPasswordProvider, userLocationManager : IUserLocationManager,
     messageService : IMessageService, messageProvider : IMessageProvider, logger : ILogger<UserManager>)
    - -
    -CheckPasswordLeakedForUser(password : string) : Task<bool>
}

class UserLocationManager {
    -_userLocationProvider : IUserLocationProvider
    +UserLocationManager(userLocationProvider : UserLocationProvider)
}



IUserManager - -> UserCreate
IUserManager - -> UserLogin
UserManager .-|> IUserManager

UserManager o- - IUserProvider
UserManager o- - IUserLocationManager
UserManager o- - ILeakedPasswordProvider

TokenManager .-|> ITokenManager
ITokenManager *- - UserToken


UserLocationManager .-|> IUserLocationManager
UserLocationManager o- - IUserLocationProvider

interface IUserProvider {
    +CreateUserAsync(userCreate : DbUser) : Task<DbUser>
    +GetUserByEmailAsync(email : string) : Task<DbUser>
    +GetUserByIdAsync(id : int) : Task<DbUser>
    +UpdateUserFailedTries(userId : int) : Task<DbUser>
    +UpdateUserLoginSuccess(userId : int) : Task<DbUser>
    +UpdateUserLoginNewLocation(userId : int) : Task<DbUser>
}

interface ILeakedPasswordProvider {
    +GetIsPasswordLeakedAsync(password : string) : Task<bool>
}

class SqlProvider {
    +SqlProvider(connection : string)

    {abstract}#RunSpAsync(storedProcedureName : string, storedProcedureElements : SpElements[]) : Task<DataTable>
    {abstract}#RunQueryAsync(query : string) : Task<DataTable>
}

class LeakedPasswordProvider {
    +LeakedPasswordProvider(configuration : IConfiguration)
    - -
}

interface IUserLocationProvider{
    +IsIPLockedAsync(ip : string) : Task<bool>
    +LogLocationAsync(userLocation: UserLocation) : Task<UserLocation>
    +UserWasLoggedInFromLocationAsync(userLocation : UserLocation) : Task<bool>
}

class UserProvider {
    +UserProvider(configuration : IConfiguration)
    - -
    -DRToUser(dr : DataRow) : DbUser
}




IUserProvider *- - DbUser
IUserLocationProvider *- - UserLocation  

LeakedPasswordProvider .-|> ILeakedPasswordProvider
LeakedPasswordProvider - -|> SqlProvider

UserProvider .-|> IUserProvider
UserProvider - -|> SqlProvider


class Security{
    {static}-GetEncryptedPassword(password : string) : string
    {static}+GetSalt(saltLength : int) : string
    {static}+GetEncryptedAndSaltedPassword(password : string, salt : string) : string
    {static}+GetHotp(key : string, counter : long) : string
    {static}+GetHmacKey() : string
}

class RegexHelper{
    {static}+TryToGetBrowserWithoutVersion(browser : string) : string
}


User - -|> UserBase
UserCreate - -|> UserBase

DbUser - -|> User


class UserToken{
    +UserID : int
    +Email : string
    +Token : string
}

class User{
    +ID : int 
    +IsVerified : bool
    +IsLocked : bool
    +FailedTries : int
    +LockedDate datetime?
}

class DbUser{
    +HashedPassword : string
    +Salt : string
    +SecretKey : string
    +Count : long
    +LastRequestDate : datetime?
}

class UserCreate {
    +Password : string
}

class UserBase{
    +Email : string
    +FirstName : string
    +LastName : string
    +PhoneNumber : string
}


class UserLogin{
    +Email : string
    +Password : string 
}

class UserLocation{
    +ID : int
    +UserID : int
    +IP : string
    +UserAgent : string
    +Successful : bool
    +CreateDate : datetime
}


@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>
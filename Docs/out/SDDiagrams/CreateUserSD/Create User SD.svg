<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1252px" preserveAspectRatio="none" style="width:1391px;height:1252px;background:#FFFFFF;" version="1.1" viewBox="0 0 1391 1252" width="1391px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="48.7031" style="stroke:#FF0000;stroke-width:1.0;" width="355" x="10" y="216.6641"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="518" x="10" y="370.4219"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="518" x="10" y="524.1797"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="518" x="10" y="677.9375"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="518" x="10" y="1013.8047"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="37" x2="37" y1="82.6094" y2="1170.5625"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="234" x2="234" y1="82.6094" y2="1170.5625"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="468" x2="468" y1="82.6094" y2="1170.5625"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="657.5" x2="657.5" y1="82.6094" y2="1170.5625"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="802.5" x2="802.5" y1="82.6094" y2="1170.5625"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="955.5" x2="955.5" y1="82.6094" y2="1170.5625"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1096.5" x2="1096.5" y1="82.6094" y2="1170.5625"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1215.5" x2="1215.5" y1="82.6094" y2="1170.5625"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1321.5" x2="1321.5" y1="82.6094" y2="1170.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="20" y="79.5332">User</text><ellipse cx="37.5" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M37.5,21.5 L37.5,48.5 M24.5,29.5 L50.5,29.5 M37.5,48.5 L24.5,63.5 M37.5,48.5 L50.5,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="20" y="1184.0957">User</text><ellipse cx="37.5" cy="1195.6719" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M37.5,1203.6719 L37.5,1230.6719 M24.5,1211.6719 L50.5,1211.6719 M37.5,1230.6719 L24.5,1245.6719 M37.5,1230.6719 L50.5,1245.6719 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105" x="182" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="189" y="71.5332">UserController</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105" x="182" y="1169.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="189" y="1191.0957">UserController</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99" x="419" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="426" y="71.5332">UserManager</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99" x="419" y="1169.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="426" y="1191.0957">UserManager</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96" x="609.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="616.5" y="71.5332">UserProvider</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96" x="609.5" y="1169.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="616.5" y="1191.0957">UserProvider</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="175" x="715.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="161" x="722.5" y="71.5332">LeakedPasswordProvider</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="175" x="715.5" y="1169.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="161" x="722.5" y="1191.0957">LeakedPasswordProvider</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110" x="900.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="907.5" y="71.5332">TokenManager</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110" x="900.5" y="1169.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="907.5" y="1191.0957">TokenManager</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153" x="1020.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="1027.5" y="71.5332">UserLocationManager</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153" x="1020.5" y="1169.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="1027.5" y="1191.0957">UserLocationManager</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65" x="1183.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="1190.5" y="71.5332">Security</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65" x="1183.5" y="1169.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="1190.5" y="1191.0957">Security</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="127" x="1258.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="1265.5" y="71.5332">MessageManager</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="127" x="1258.5" y="1169.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="1265.5" y="1191.0957">MessageManager</text><polygon fill="#FF4500" points="222.5,110.9609,232.5,114.9609,222.5,118.9609,226.5,114.9609" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="37.5" x2="228.5" y1="114.9609" y2="114.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="44.5" y="110.1045">Create user (email, password)</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="234.5" x2="276.5" y1="145.3125" y2="145.3125"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="276.5" x2="276.5" y1="145.3125" y2="158.3125"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="235.5" x2="276.5" y1="158.3125" y2="158.3125"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="235.5" x2="245.5" y1="158.3125" y2="154.3125"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="235.5" x2="245.5" y1="158.3125" y2="162.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="241.5" y="140.4561">Validate password(password)</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="234.5" x2="276.5" y1="188.6641" y2="188.6641"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="276.5" x2="276.5" y1="188.6641" y2="201.6641"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="235.5" x2="276.5" y1="201.6641" y2="201.6641"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="235.5" x2="245.5" y1="201.6641" y2="197.6641"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="235.5" x2="245.5" y1="201.6641" y2="205.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="241.5" y="183.8076">Validate email(email)</text><path d="M10,216.6641 L71,216.6641 L71,225.0156 L61,235.0156 L10,235.0156 L10,216.6641 " fill="#EEEEEE" style="stroke:#FF0000;stroke-width:1.5;"/><rect fill="none" height="48.7031" style="stroke:#FF0000;stroke-width:1.0;" width="355" x="10" y="216.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="231.1592">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="274" x="86" y="230.083">[Password not complying or email not complying]</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="38.5" x2="48.5" y1="257.3672" y2="253.3672"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="38.5" x2="48.5" y1="257.3672" y2="261.3672"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="37.5" x2="233.5" y1="257.3672" y2="257.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="54.5" y="252.5107">Return status badrequest</text><polygon fill="#FF4500" points="456.5,290.7188,466.5,294.7188,456.5,298.7188,460.5,294.7188" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="234.5" x2="462.5" y1="294.7188" y2="294.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="241.5" y="289.8623">Create user (email, password)</text><polygon fill="#FF4500" points="1085,321.0703,1095,325.0703,1085,329.0703,1089,325.0703" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="468.5" x2="1091" y1="325.0703" y2="325.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="475.5" y="320.2139">Check if ip is blocked (ipadress)</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="469.5" x2="479.5" y1="355.4219" y2="351.4219"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="469.5" x2="479.5" y1="355.4219" y2="359.4219"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="468.5" x2="1096" y1="355.4219" y2="355.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="485.5" y="350.5654">Returns whether ip is block</text><path d="M10,370.4219 L71,370.4219 L71,378.7734 L61,388.7734 L10,388.7734 L10,370.4219 " fill="#EEEEEE" style="stroke:#FF0000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="518" x="10" y="370.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="384.917">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="65" x="86" y="383.8408">[Ip blocked]</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="235.5" x2="245.5" y1="411.125" y2="407.125"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="235.5" x2="245.5" y1="411.125" y2="415.125"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="234.5" x2="467.5" y1="411.125" y2="411.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="251.5" y="406.2686">Throw IPBlocked exception</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="38.5" x2="48.5" y1="441.4766" y2="437.4766"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="38.5" x2="48.5" y1="441.4766" y2="445.4766"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="37.5" x2="233.5" y1="441.4766" y2="441.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="54.5" y="436.6201">Return status forbidden</text><polygon fill="#FF4500" points="791,474.8281,801,478.8281,791,482.8281,795,478.8281" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="468.5" x2="797" y1="478.8281" y2="478.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="475.5" y="473.9717">Check is password leaked (password)</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="469.5" x2="479.5" y1="509.1797" y2="505.1797"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="469.5" x2="479.5" y1="509.1797" y2="513.1797"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="468.5" x2="802" y1="509.1797" y2="509.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="252" x="485.5" y="504.3232">Returns whether password has been leaked</text><path d="M10,524.1797 L71,524.1797 L71,532.5313 L61,542.5313 L10,542.5313 L10,524.1797 " fill="#EEEEEE" style="stroke:#FF0000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="518" x="10" y="524.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="538.6748">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="117" x="86" y="537.5986">[Password Is leaked]</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="235.5" x2="245.5" y1="564.8828" y2="560.8828"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="235.5" x2="245.5" y1="564.8828" y2="568.8828"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="234.5" x2="467.5" y1="564.8828" y2="564.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="251.5" y="560.0264">Throw password leaked exception</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="38.5" x2="48.5" y1="595.2344" y2="591.2344"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="38.5" x2="48.5" y1="595.2344" y2="599.2344"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="37.5" x2="233.5" y1="595.2344" y2="595.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="54.5" y="590.3779">Return status forbidden</text><polygon fill="#FF4500" points="645.5,628.5859,655.5,632.5859,645.5,636.5859,649.5,632.5859" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="468.5" x2="651.5" y1="632.5859" y2="632.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="475.5" y="627.7295">Get user by email(email)</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="469.5" x2="479.5" y1="662.9375" y2="658.9375"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="469.5" x2="479.5" y1="662.9375" y2="666.9375"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="468.5" x2="656.5" y1="662.9375" y2="662.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="69" x="485.5" y="658.0811">Return User</text><path d="M10,677.9375 L71,677.9375 L71,686.2891 L61,696.2891 L10,696.2891 L10,677.9375 " fill="#EEEEEE" style="stroke:#FF0000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="518" x="10" y="677.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="692.4326">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="69" x="86" y="691.3564">[User found]</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="235.5" x2="245.5" y1="718.6406" y2="714.6406"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="235.5" x2="245.5" y1="718.6406" y2="722.6406"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="234.5" x2="467.5" y1="718.6406" y2="718.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="251.5" y="713.7842">Throw user already exists exception</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="38.5" x2="48.5" y1="748.9922" y2="744.9922"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="38.5" x2="48.5" y1="748.9922" y2="752.9922"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="37.5" x2="233.5" y1="748.9922" y2="748.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="54.5" y="744.1357">Return status conflict</text><polygon fill="#FF4500" points="1204,782.3438,1214,786.3438,1204,790.3438,1208,786.3438" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="468.5" x2="1210" y1="786.3438" y2="786.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="475.5" y="781.4873">Get salt</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="469.5" x2="479.5" y1="816.6953" y2="812.6953"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="469.5" x2="479.5" y1="816.6953" y2="820.6953"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="468.5" x2="1215" y1="816.6953" y2="816.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="485.5" y="811.8389">Return salt</text><polygon fill="#FF4500" points="1204,843.0469,1214,847.0469,1204,851.0469,1208,847.0469" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="468.5" x2="1210" y1="847.0469" y2="847.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="475.5" y="842.1904">Salt password (password, salt)</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="469.5" x2="479.5" y1="877.3984" y2="873.3984"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="469.5" x2="479.5" y1="877.3984" y2="881.3984"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="468.5" x2="1215" y1="877.3984" y2="877.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="485.5" y="872.542">Return salted password</text><polygon fill="#FF4500" points="645.5,903.75,655.5,907.75,645.5,911.75,649.5,907.75" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="468.5" x2="651.5" y1="907.75" y2="907.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="475.5" y="902.8936">Save user in database (user)</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="469.5" x2="479.5" y1="938.1016" y2="934.1016"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="469.5" x2="479.5" y1="938.1016" y2="942.1016"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="468.5" x2="656.5" y1="938.1016" y2="938.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="485.5" y="933.2451">Return saved user</text><polygon fill="#FF4500" points="1310,964.4531,1320,968.4531,1310,972.4531,1314,968.4531" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="468.5" x2="1316" y1="968.4531" y2="968.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="475.5" y="963.5967">SendRegistrationMessage(email, key)</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="469.5" x2="479.5" y1="998.8047" y2="994.8047"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="469.5" x2="479.5" y1="998.8047" y2="1002.8047"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="468.5" x2="1321" y1="998.8047" y2="998.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259" x="485.5" y="993.9482">Return whether the message was sent or not</text><path d="M10,1013.8047 L71,1013.8047 L71,1022.1563 L61,1032.1563 L10,1032.1563 L10,1013.8047 " fill="#EEEEEE" style="stroke:#FF0000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="518" x="10" y="1013.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="1028.2998">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="134" x="86" y="1027.2236">[Message was not sent]</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="235.5" x2="245.5" y1="1054.5078" y2="1050.5078"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="235.5" x2="245.5" y1="1054.5078" y2="1058.5078"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="234.5" x2="467.5" y1="1054.5078" y2="1054.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="251.5" y="1049.6514">Throw SendMessageIssueException</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="38.5" x2="48.5" y1="1084.8594" y2="1080.8594"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="38.5" x2="48.5" y1="1084.8594" y2="1088.8594"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="37.5" x2="233.5" y1="1084.8594" y2="1084.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="54.5" y="1080.0029">Return status internal error</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="235.5" x2="245.5" y1="1122.2109" y2="1118.2109"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="235.5" x2="245.5" y1="1122.2109" y2="1126.2109"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="234.5" x2="467.5" y1="1122.2109" y2="1122.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="251.5" y="1117.3545">Return true</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="38.5" x2="48.5" y1="1152.5625" y2="1148.5625"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="38.5" x2="48.5" y1="1152.5625" y2="1156.5625"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="37.5" x2="233.5" y1="1152.5625" y2="1152.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="54.5" y="1147.7061">Return status Ok</text><!--MD5=[067d2e5942986780c47d960cd039923f]
@startuml Create User SD

skinparam sequence {
    GroupBorderColor red
    GroupBorderThickness 1

    ArrowColor orangered

    LifeLineBorderColor blue

    ParticipantBackgroundColor lightblue
}

actor User
participant UserController
participant UserManager
participant UserProvider
participant LeakedPasswordProvider
participant TokenManager
participant UserLocationManager
participant Security
participant MessageManager



User->UserController: Create user (email, password)
UserController->>UserController: Validate password(password)
UserController->>UserController: Validate email(email)

alt Password not complying or email not complying
UserController- ->>User: Return status badrequest
end

UserController->UserManager: Create user (email, password)
UserManager->UserLocationManager: Check if ip is blocked (ipadress)
UserLocationManager- ->>UserManager: Returns whether ip is block

alt Ip blocked
UserManager- ->>UserController: Throw IPBlocked exception
UserController- ->>User: Return status forbidden
end


UserManager->LeakedPasswordProvider: Check is password leaked (password)
LeakedPasswordProvider- ->>UserManager: Returns whether password has been leaked

alt Password Is leaked
UserManager- ->>UserController: Throw password leaked exception
UserController- ->>User: Return status forbidden
end

UserManager->UserProvider: Get user by email(email)
UserProvider- ->>UserManager: Return User

alt User found

UserManager- ->>UserController: Throw user already exists exception
UserController- ->>User: Return status conflict

end


UserManager->Security: Get salt
Security- ->>UserManager: Return salt

UserManager->Security: Salt password (password, salt)
Security- ->>UserManager: Return salted password

UserManager->UserProvider: Save user in database (user)
UserProvider- ->>UserManager: Return saved user

UserManager->MessageManager: SendRegistrationMessage(email, key)
MessageManager- ->>UserManager: Return whether the message was sent or not

alt Message was not sent
UserManager - ->> UserController: Throw SendMessageIssueException
UserController - ->> User: Return status internal error
end

UserManager- ->>UserController: Return true
UserController- ->>User: Return status Ok

@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>
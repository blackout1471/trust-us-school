<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1306px" preserveAspectRatio="none" style="width:4542px;height:1306px;background:#FFFFFF;" version="1.1" viewBox="0 0 4542 1306" width="4542px" zoomAndPan="magnify"><defs/><g><!--MD5=[29f97d496cbdc4ec81664c6d94dc9bf6]
class UserController--><g id="elem_UserController"><rect codeLine="6" fill="#F1F1F1" height="206.4844" id="UserController" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="628" x="575.5" y="247.5"/><ellipse cx="839.75" cy="263.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M842.5156,259.375 Q842.6719,259.1563 842.8594,259.0469 Q843.0469,258.9375 843.2656,258.9375 Q843.6406,258.9375 843.875,259.2031 Q844.1094,259.4531 844.1094,260.0625 L844.1094,261.5156 Q844.1094,262.125 843.875,262.3906 Q843.6406,262.6563 843.2656,262.6563 Q842.9219,262.6563 842.7188,262.4531 Q842.5156,262.2656 842.4063,261.75 Q842.3594,261.3906 842.1719,261.2031 Q841.8438,260.8281 841.2344,260.6094 Q840.625,260.3906 840,260.3906 Q839.2344,260.3906 838.5938,260.7188 Q837.9688,261.0469 837.4688,261.7969 Q836.9844,262.5469 836.9844,263.5781 L836.9844,264.6719 Q836.9844,265.9063 837.875,266.7344 Q838.7656,267.5469 840.3594,267.5469 Q841.2969,267.5469 841.9531,267.2969 Q842.3438,267.1406 842.7656,266.7031 Q843.0313,266.4375 843.1719,266.3594 Q843.3281,266.2813 843.5313,266.2813 Q843.8594,266.2813 844.1094,266.5469 Q844.375,266.7969 844.375,267.1406 Q844.375,267.4844 844.0313,267.8906 Q843.5313,268.4688 842.7344,268.7969 Q841.6563,269.25 840.3594,269.25 Q838.8438,269.25 837.6406,268.625 Q836.6563,268.125 835.9688,267.0625 Q835.2813,265.9844 835.2813,264.7031 L835.2813,263.5469 Q835.2813,262.2188 835.8906,261.0781 Q836.5156,259.9219 837.6094,259.3125 Q838.7031,258.6875 839.9375,258.6875 Q840.6719,258.6875 841.3125,258.8594 Q841.9688,259.0156 842.5156,259.375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="860.25" y="269.2285">UserController</text><line style="stroke:#181818;stroke-width:0.5;" x1="576.5" x2="1202.5" y1="279.5" y2="279.5"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="583.5" y="290.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="257" x="595.5" y="298.0332">_userManager{readonly} : IUserManager</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="583.5" y="308.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="210" x="595.5" y="315.6426">_tokenManager : ITokenManager</text><line style="stroke:#181818;stroke-width:1.0;" x1="576.5" x2="1202.5" y1="322.7188" y2="322.7188"/><ellipse cx="586.5" cy="337.0234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="495" x="595.5" y="341.252">UserController(userManager : IUserManager, tokenManager : ITokenManager)</text><ellipse cx="586.5" cy="354.6328" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="384" x="595.5" y="358.8613">CreateAsync(userCreate : UserCreate) : Task&lt;ActionResult&gt;</text><ellipse cx="586.5" cy="372.2422" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="445" x="595.5" y="376.4707">LoginAsync(userLogin : UserLogin) : Task&lt;ActionResult&lt;UserToken&gt;&gt;</text><ellipse cx="586.5" cy="389.8516" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="356" x="595.5" y="394.0801">GetUserFromTokenAsync() : Task&lt;ActionResult&lt;User&gt;&gt;</text><ellipse cx="586.5" cy="407.4609" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="602" x="595.5" y="411.6895">VerificationLoginAsync(verifyCredentials : VerifyCredentials) : Task&lt;ActionResult&lt;UserToken&gt;&gt;</text><ellipse cx="586.5" cy="425.0703" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="530" x="595.5" y="429.2988">VerifyUserRegisterAsync(verifyCredentials : VerifyCredentials) : Task&lt;ActionResult&gt;</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="583.5" y="439.6797"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="211" x="595.5" y="446.9082">GetUserLocation() : UserLocation</text></g><!--MD5=[56ab46cd423624563d94b9f2eeeea516]
class IUserManager--><g id="elem_IUserManager"><rect codeLine="26" fill="#F1F1F1" height="136.0469" id="IUserManager" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="740" x="519.5" y="566.5"/><ellipse cx="839.75" cy="582.5" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M840.7031,579.1406 L840.7031,585.7969 L842.4219,585.7969 Q843.0313,585.7969 843.2969,586.0313 Q843.5625,586.2656 843.5625,586.6563 Q843.5625,587.0313 843.2969,587.2656 Q843.0313,587.5 842.4219,587.5 L837.2813,587.5 Q836.6719,587.5 836.4063,587.2656 Q836.1406,587.0313 836.1406,586.6406 Q836.1406,586.2656 836.4063,586.0313 Q836.6719,585.7969 837.2813,585.7969 L839,585.7969 L839,579.1406 L837.2813,579.1406 Q836.6719,579.1406 836.4063,578.9063 Q836.1406,578.6719 836.1406,578.2813 Q836.1406,577.9063 836.4063,577.6719 Q836.6719,577.4375 837.2813,577.4375 L842.4219,577.4375 Q843.0313,577.4375 843.2969,577.6719 Q843.5625,577.9063 843.5625,578.2813 Q843.5625,578.6719 843.2969,578.9063 Q843.0313,579.1406 842.4219,579.1406 L840.7031,579.1406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="91" x="860.25" y="588.2285">IUserManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="520.5" x2="1258.5" y1="598.5" y2="598.5"/><line style="stroke:#181818;stroke-width:0.5;" x1="520.5" x2="1258.5" y1="606.5" y2="606.5"/><ellipse cx="530.5" cy="620.8047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="361" x="539.5" y="625.0332">CreateUserAsync(userCreate : UserCreate) : Task&lt;bool&gt;</text><ellipse cx="530.5" cy="638.4141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="495" x="539.5" y="642.6426">LoginAsync(userLogin : UserLogin, userLocation : UserLocation) : Task&lt;User&gt;</text><ellipse cx="530.5" cy="656.0234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="255" x="539.5" y="660.252">GetUserByIDAsync(id : int) : Task&lt;User&gt;</text><ellipse cx="530.5" cy="673.6328" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="714" x="539.5" y="677.8613">LoginWithVerificationCodeAsync(verifyCredentials : VerifyCredentials, userLocation : UserLocation) : Task&lt;User&gt;</text><ellipse cx="530.5" cy="691.2422" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="682" x="539.5" y="695.4707">VerifyUserRegistrationAsync(verifyCredentials : VerifyCredentials, userLocation: UserLocation) : Task&lt;bool&gt;</text></g><!--MD5=[1258d900524f45f247dd7f1e09584eb4]
class ITokenManager--><g id="elem_ITokenManager"><rect codeLine="34" fill="#F1F1F1" height="100.8281" id="ITokenManager" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="364" x="106.5" y="584"/><ellipse cx="233.25" cy="600" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M234.2031,596.6406 L234.2031,603.2969 L235.9219,603.2969 Q236.5313,603.2969 236.7969,603.5313 Q237.0625,603.7656 237.0625,604.1563 Q237.0625,604.5313 236.7969,604.7656 Q236.5313,605 235.9219,605 L230.7813,605 Q230.1719,605 229.9063,604.7656 Q229.6406,604.5313 229.6406,604.1406 Q229.6406,603.7656 229.9063,603.5313 Q230.1719,603.2969 230.7813,603.2969 L232.5,603.2969 L232.5,596.6406 L230.7813,596.6406 Q230.1719,596.6406 229.9063,596.4063 Q229.6406,596.1719 229.6406,595.7813 Q229.6406,595.4063 229.9063,595.1719 Q230.1719,594.9375 230.7813,594.9375 L235.9219,594.9375 Q236.5313,594.9375 236.7969,595.1719 Q237.0625,595.4063 237.0625,595.7813 Q237.0625,596.1719 236.7969,596.4063 Q236.5313,596.6406 235.9219,596.6406 L234.2031,596.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="102" x="253.75" y="605.7285">ITokenManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="107.5" x2="469.5" y1="616" y2="616"/><line style="stroke:#181818;stroke-width:0.5;" x1="107.5" x2="469.5" y1="624" y2="624"/><ellipse cx="117.5" cy="638.3047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="289" x="126.5" y="642.5332">GenerateUserToken(user : User) : UserToken</text><ellipse cx="117.5" cy="655.9141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="222" x="126.5" y="660.1426">ValidateToken(token : string) : bool</text><ellipse cx="117.5" cy="673.5234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="338" x="126.5" y="677.752">GetUserTokenFromToken(token : string) : UserToken</text></g><!--MD5=[d00c2197046b95564bb4dabcd5edfb06]
class IUserLocationManager--><g id="elem_IUserLocationManager"><rect codeLine="41" fill="#F1F1F1" height="100.8281" id="IUserLocationManager" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="540" x="1294.5" y="584"/><ellipse cx="1487.75" cy="600" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1488.7031,596.6406 L1488.7031,603.2969 L1490.4219,603.2969 Q1491.0313,603.2969 1491.2969,603.5313 Q1491.5625,603.7656 1491.5625,604.1563 Q1491.5625,604.5313 1491.2969,604.7656 Q1491.0313,605 1490.4219,605 L1485.2813,605 Q1484.6719,605 1484.4063,604.7656 Q1484.1406,604.5313 1484.1406,604.1406 Q1484.1406,603.7656 1484.4063,603.5313 Q1484.6719,603.2969 1485.2813,603.2969 L1487,603.2969 L1487,596.6406 L1485.2813,596.6406 Q1484.6719,596.6406 1484.4063,596.4063 Q1484.1406,596.1719 1484.1406,595.7813 Q1484.1406,595.4063 1484.4063,595.1719 Q1484.6719,594.9375 1485.2813,594.9375 L1490.4219,594.9375 Q1491.0313,594.9375 1491.2969,595.1719 Q1491.5625,595.4063 1491.5625,595.7813 Q1491.5625,596.1719 1491.2969,596.4063 Q1491.0313,596.6406 1490.4219,596.6406 L1488.7031,596.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="145" x="1508.25" y="605.7285">IUserLocationManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="1295.5" x2="1833.5" y1="616" y2="616"/><line style="stroke:#181818;stroke-width:0.5;" x1="1295.5" x2="1833.5" y1="624" y2="624"/><ellipse cx="1305.5" cy="638.3047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="260" x="1314.5" y="642.5332">IsIPLockedAsync(ip : string) : Task&lt;bool&gt;</text><ellipse cx="1305.5" cy="655.9141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="445" x="1314.5" y="660.1426">LogLocationAsync(userLocation : UserLocation) : Task&lt;UserLocation&gt;</text><ellipse cx="1305.5" cy="673.5234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="514" x="1314.5" y="677.752">UserWasLoggedInFromLocationAsync(userLocation : UserLocation) : Task&lt;bool&gt;</text></g><!--MD5=[5bbb8fec178e848d13dc3ca00e0fbd40]
class IMessageManager--><g id="elem_IMessageManager"><rect codeLine="47" fill="#F1F1F1" height="83.2188" id="IMessageManager" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="497" x="1870" y="593"/><ellipse cx="2054.75" cy="609" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M2055.7031,605.6406 L2055.7031,612.2969 L2057.4219,612.2969 Q2058.0313,612.2969 2058.2969,612.5313 Q2058.5625,612.7656 2058.5625,613.1563 Q2058.5625,613.5313 2058.2969,613.7656 Q2058.0313,614 2057.4219,614 L2052.2813,614 Q2051.6719,614 2051.4063,613.7656 Q2051.1406,613.5313 2051.1406,613.1406 Q2051.1406,612.7656 2051.4063,612.5313 Q2051.6719,612.2969 2052.2813,612.2969 L2054,612.2969 L2054,605.6406 L2052.2813,605.6406 Q2051.6719,605.6406 2051.4063,605.4063 Q2051.1406,605.1719 2051.1406,604.7813 Q2051.1406,604.4063 2051.4063,604.1719 Q2051.6719,603.9375 2052.2813,603.9375 L2057.4219,603.9375 Q2058.0313,603.9375 2058.2969,604.1719 Q2058.5625,604.4063 2058.5625,604.7813 Q2058.5625,605.1719 2058.2969,605.4063 Q2058.0313,605.6406 2057.4219,605.6406 L2055.7031,605.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="119" x="2075.25" y="614.7285">IMessageManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="1871" x2="2366" y1="625" y2="625"/><line style="stroke:#181818;stroke-width:0.5;" x1="1871" x2="2366" y1="633" y2="633"/><ellipse cx="1881" cy="647.3047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="441" x="1890" y="651.5332">SendLoginAttemptMessageAsync(to : string, otp : string) : Task&lt;bool&gt;</text><ellipse cx="1881" cy="664.9141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="471" x="1890" y="669.1426">SendLoginRegistrationMessageAsync(to : string, key : string) : Task&lt;bool&gt;</text></g><!--MD5=[6c06fb0cd17dfe24a13aaf4bb7e771c8]
class TokenManager--><g id="elem_TokenManager"><rect codeLine="52" fill="#F1F1F1" height="83.2188" id="TokenManager" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="533" x="7" y="309"/><ellipse cx="221.25" cy="325" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M224.0156,320.875 Q224.1719,320.6563 224.3594,320.5469 Q224.5469,320.4375 224.7656,320.4375 Q225.1406,320.4375 225.375,320.7031 Q225.6094,320.9531 225.6094,321.5625 L225.6094,323.0156 Q225.6094,323.625 225.375,323.8906 Q225.1406,324.1563 224.7656,324.1563 Q224.4219,324.1563 224.2188,323.9531 Q224.0156,323.7656 223.9063,323.25 Q223.8594,322.8906 223.6719,322.7031 Q223.3438,322.3281 222.7344,322.1094 Q222.125,321.8906 221.5,321.8906 Q220.7344,321.8906 220.0938,322.2188 Q219.4688,322.5469 218.9688,323.2969 Q218.4844,324.0469 218.4844,325.0781 L218.4844,326.1719 Q218.4844,327.4063 219.375,328.2344 Q220.2656,329.0469 221.8594,329.0469 Q222.7969,329.0469 223.4531,328.7969 Q223.8438,328.6406 224.2656,328.2031 Q224.5313,327.9375 224.6719,327.8594 Q224.8281,327.7813 225.0313,327.7813 Q225.3594,327.7813 225.6094,328.0469 Q225.875,328.2969 225.875,328.6406 Q225.875,328.9844 225.5313,329.3906 Q225.0313,329.9688 224.2344,330.2969 Q223.1563,330.75 221.8594,330.75 Q220.3438,330.75 219.1406,330.125 Q218.1563,329.625 217.4688,328.5625 Q216.7813,327.4844 216.7813,326.2031 L216.7813,325.0469 Q216.7813,323.7188 217.3906,322.5781 Q218.0156,321.4219 219.1094,320.8125 Q220.2031,320.1875 221.4375,320.1875 Q222.1719,320.1875 222.8125,320.3594 Q223.4688,320.5156 224.0156,320.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="241.75" y="330.7285">TokenManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="539" y1="341" y2="341"/><line style="stroke:#181818;stroke-width:1.0;" x1="8" x2="539" y1="349" y2="349"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="15" y="360.3047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="277" x="27" y="367.5332">GetPrincipal(token : string) : ClaimsPrincipal</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="15" y="377.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="507" x="27" y="385.1426">ClaimsIdentityToUserToken(identity : ClaimsPrincipal, token : string) : UserToken</text></g><!--MD5=[24add822970012a00cd97a40cd79feff]
class UserManager--><g id="elem_UserManager"><rect codeLine="58" fill="#F1F1F1" height="259.3125" id="UserManager" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="1128" x="1379.5" y="221"/><ellipse cx="1896.75" cy="237" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1899.5156,232.875 Q1899.6719,232.6563 1899.8594,232.5469 Q1900.0469,232.4375 1900.2656,232.4375 Q1900.6406,232.4375 1900.875,232.7031 Q1901.1094,232.9531 1901.1094,233.5625 L1901.1094,235.0156 Q1901.1094,235.625 1900.875,235.8906 Q1900.6406,236.1563 1900.2656,236.1563 Q1899.9219,236.1563 1899.7188,235.9531 Q1899.5156,235.7656 1899.4063,235.25 Q1899.3594,234.8906 1899.1719,234.7031 Q1898.8438,234.3281 1898.2344,234.1094 Q1897.625,233.8906 1897,233.8906 Q1896.2344,233.8906 1895.5938,234.2188 Q1894.9688,234.5469 1894.4688,235.2969 Q1893.9844,236.0469 1893.9844,237.0781 L1893.9844,238.1719 Q1893.9844,239.4063 1894.875,240.2344 Q1895.7656,241.0469 1897.3594,241.0469 Q1898.2969,241.0469 1898.9531,240.7969 Q1899.3438,240.6406 1899.7656,240.2031 Q1900.0313,239.9375 1900.1719,239.8594 Q1900.3281,239.7813 1900.5313,239.7813 Q1900.8594,239.7813 1901.1094,240.0469 Q1901.375,240.2969 1901.375,240.6406 Q1901.375,240.9844 1901.0313,241.3906 Q1900.5313,241.9688 1899.7344,242.2969 Q1898.6563,242.75 1897.3594,242.75 Q1895.8438,242.75 1894.6406,242.125 Q1893.6563,241.625 1892.9688,240.5625 Q1892.2813,239.4844 1892.2813,238.2031 L1892.2813,237.0469 Q1892.2813,235.7188 1892.8906,234.5781 Q1893.5156,233.4219 1894.6094,232.8125 Q1895.7031,232.1875 1896.9375,232.1875 Q1897.6719,232.1875 1898.3125,232.3594 Q1898.9688,232.5156 1899.5156,232.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="1917.25" y="242.7285">UserManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="1380.5" x2="2506.5" y1="253" y2="253"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1387.5" y="264.3047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="186" x="1399.5" y="271.5332">_userProvider : IUserProvider</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1387.5" y="281.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="344" x="1399.5" y="289.1426">_leakedPasswordProvider : ILeakedPasswordProvider;</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1387.5" y="299.5234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="300" x="1399.5" y="306.752">_userLocationManager : IUserLocationManager</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1387.5" y="317.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="249" x="1399.5" y="324.3613">_messageManager : IMessageManager</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1387.5" y="334.7422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="209" x="1399.5" y="341.9707">_logger : ILogger&lt;UserManager&gt;</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1387.5" y="352.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="190" x="1399.5" y="359.5801">_configuration : IConfiguration</text><line style="stroke:#181818;stroke-width:1.0;" x1="1380.5" x2="2506.5" y1="366.6563" y2="366.6563"/><ellipse cx="1390.5" cy="380.9609" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="1102" x="1399.5" y="385.1895">UserManager(configuration : IConfiguration, userProvider : IUserProvider, leakedPasswordProvider : ILeakedPasswordProvider, userLocationManager : IUserLocationManager,</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="455" x="1399.5" y="402.7988">messageManager : IMessageManager, logger : ILogger&lt;UserManager&gt;)</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1387.5" y="413.1797"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="438" x="1399.5" y="420.4082">IsVerificationCodeValid(verificationCode : string, user : DbUser) : bool</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1387.5" y="430.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="440" x="1399.5" y="438.0176">CheckPasswordLeakedForUserAsync(password : string) : Task&lt;bool&gt;</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1387.5" y="448.3984"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="471" x="1399.5" y="455.627">IsUserNotVerifiedAsync(userLocation : UserLocation, user : DbUser) : Task</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1387.5" y="466.0078"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="448" x="1399.5" y="473.2363">IsUserLockedAsync(userLocation : UserLocation, user : DbUser) : Task</text></g><!--MD5=[f73269fd56b24b10ecd9be8e99f9cb1e]
class UserLocationManager--><g id="elem_UserLocationManager"><rect codeLine="74" fill="#F1F1F1" height="83.2188" id="UserLocationManager" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="461" x="2565" y="42.5"/><ellipse cx="2721.75" cy="58.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M2724.5156,54.375 Q2724.6719,54.1563 2724.8594,54.0469 Q2725.0469,53.9375 2725.2656,53.9375 Q2725.6406,53.9375 2725.875,54.2031 Q2726.1094,54.4531 2726.1094,55.0625 L2726.1094,56.5156 Q2726.1094,57.125 2725.875,57.3906 Q2725.6406,57.6563 2725.2656,57.6563 Q2724.9219,57.6563 2724.7188,57.4531 Q2724.5156,57.2656 2724.4063,56.75 Q2724.3594,56.3906 2724.1719,56.2031 Q2723.8438,55.8281 2723.2344,55.6094 Q2722.625,55.3906 2722,55.3906 Q2721.2344,55.3906 2720.5938,55.7188 Q2719.9688,56.0469 2719.4688,56.7969 Q2718.9844,57.5469 2718.9844,58.5781 L2718.9844,59.6719 Q2718.9844,60.9063 2719.875,61.7344 Q2720.7656,62.5469 2722.3594,62.5469 Q2723.2969,62.5469 2723.9531,62.2969 Q2724.3438,62.1406 2724.7656,61.7031 Q2725.0313,61.4375 2725.1719,61.3594 Q2725.3281,61.2813 2725.5313,61.2813 Q2725.8594,61.2813 2726.1094,61.5469 Q2726.375,61.7969 2726.375,62.1406 Q2726.375,62.4844 2726.0313,62.8906 Q2725.5313,63.4688 2724.7344,63.7969 Q2723.6563,64.25 2722.3594,64.25 Q2720.8438,64.25 2719.6406,63.625 Q2718.6563,63.125 2717.9688,62.0625 Q2717.2813,60.9844 2717.2813,59.7031 L2717.2813,58.5469 Q2717.2813,57.2188 2717.8906,56.0781 Q2718.5156,54.9219 2719.6094,54.3125 Q2720.7031,53.6875 2721.9375,53.6875 Q2722.6719,53.6875 2723.3125,53.8594 Q2723.9688,54.0156 2724.5156,54.375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="2742.25" y="64.2285">UserLocationManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="2566" x2="3025" y1="74.5" y2="74.5"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="2573" y="85.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="294" x="2585" y="93.0332">_userLocationProvider : IUserLocationProvider</text><line style="stroke:#181818;stroke-width:1.0;" x1="2566" x2="3025" y1="100.1094" y2="100.1094"/><ellipse cx="2576" cy="114.4141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="435" x="2585" y="118.6426">UserLocationManager(userLocationProvider : IUserLocationProvider)</text></g><!--MD5=[20fcb2fa68efbd583f0fa2981cab489f]
class MessageManager--><g id="elem_MessageManager"><rect codeLine="80" fill="#F1F1F1" height="100.8281" id="MessageManager" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="668" x="2542.5" y="300"/><ellipse cx="2815.75" cy="316" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M2818.5156,311.875 Q2818.6719,311.6563 2818.8594,311.5469 Q2819.0469,311.4375 2819.2656,311.4375 Q2819.6406,311.4375 2819.875,311.7031 Q2820.1094,311.9531 2820.1094,312.5625 L2820.1094,314.0156 Q2820.1094,314.625 2819.875,314.8906 Q2819.6406,315.1563 2819.2656,315.1563 Q2818.9219,315.1563 2818.7188,314.9531 Q2818.5156,314.7656 2818.4063,314.25 Q2818.3594,313.8906 2818.1719,313.7031 Q2817.8438,313.3281 2817.2344,313.1094 Q2816.625,312.8906 2816,312.8906 Q2815.2344,312.8906 2814.5938,313.2188 Q2813.9688,313.5469 2813.4688,314.2969 Q2812.9844,315.0469 2812.9844,316.0781 L2812.9844,317.1719 Q2812.9844,318.4063 2813.875,319.2344 Q2814.7656,320.0469 2816.3594,320.0469 Q2817.2969,320.0469 2817.9531,319.7969 Q2818.3438,319.6406 2818.7656,319.2031 Q2819.0313,318.9375 2819.1719,318.8594 Q2819.3281,318.7813 2819.5313,318.7813 Q2819.8594,318.7813 2820.1094,319.0469 Q2820.375,319.2969 2820.375,319.6406 Q2820.375,319.9844 2820.0313,320.3906 Q2819.5313,320.9688 2818.7344,321.2969 Q2817.6563,321.75 2816.3594,321.75 Q2814.8438,321.75 2813.6406,321.125 Q2812.6563,320.625 2811.9688,319.5625 Q2811.2813,318.4844 2811.2813,317.2031 L2811.2813,316.0469 Q2811.2813,314.7188 2811.8906,313.5781 Q2812.5156,312.4219 2813.6094,311.8125 Q2814.7031,311.1875 2815.9375,311.1875 Q2816.6719,311.1875 2817.3125,311.3594 Q2817.9688,311.5156 2818.5156,311.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="2836.25" y="321.7285">MessageManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="2543.5" x2="3209.5" y1="332" y2="332"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="2550.5" y="343.3047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="231" x="2562.5" y="350.5332">_messageService : IMessageService</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="2550.5" y="360.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="243" x="2562.5" y="368.1426">_messageProvider : IMessageProvider</text><line style="stroke:#181818;stroke-width:1.0;" x1="2543.5" x2="3209.5" y1="375.2188" y2="375.2188"/><ellipse cx="2553.5" cy="389.5234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="642" x="2562.5" y="393.752">MessageManager(messageService : EmailMessageService, messageProvider : MailMessageProvider)</text></g><!--MD5=[177726c6dccf199602c5c27bb05f2a1e]
class UserCreate--><g id="elem_UserCreate"><rect codeLine="209" fill="#F1F1F1" height="65.6094" id="UserCreate" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="1317.5" y="1020"/><ellipse cx="1346" cy="1036" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1348.7656,1031.875 Q1348.9219,1031.6563 1349.1094,1031.5469 Q1349.2969,1031.4375 1349.5156,1031.4375 Q1349.8906,1031.4375 1350.125,1031.7031 Q1350.3594,1031.9531 1350.3594,1032.5625 L1350.3594,1034.0156 Q1350.3594,1034.625 1350.125,1034.8906 Q1349.8906,1035.1563 1349.5156,1035.1563 Q1349.1719,1035.1563 1348.9688,1034.9531 Q1348.7656,1034.7656 1348.6563,1034.25 Q1348.6094,1033.8906 1348.4219,1033.7031 Q1348.0938,1033.3281 1347.4844,1033.1094 Q1346.875,1032.8906 1346.25,1032.8906 Q1345.4844,1032.8906 1344.8438,1033.2188 Q1344.2188,1033.5469 1343.7188,1034.2969 Q1343.2344,1035.0469 1343.2344,1036.0781 L1343.2344,1037.1719 Q1343.2344,1038.4063 1344.125,1039.2344 Q1345.0156,1040.0469 1346.6094,1040.0469 Q1347.5469,1040.0469 1348.2031,1039.7969 Q1348.5938,1039.6406 1349.0156,1039.2031 Q1349.2813,1038.9375 1349.4219,1038.8594 Q1349.5781,1038.7813 1349.7813,1038.7813 Q1350.1094,1038.7813 1350.3594,1039.0469 Q1350.625,1039.2969 1350.625,1039.6406 Q1350.625,1039.9844 1350.2813,1040.3906 Q1349.7813,1040.9688 1348.9844,1041.2969 Q1347.9063,1041.75 1346.6094,1041.75 Q1345.0938,1041.75 1343.8906,1041.125 Q1342.9063,1040.625 1342.2188,1039.5625 Q1341.5313,1038.4844 1341.5313,1037.2031 L1341.5313,1036.0469 Q1341.5313,1034.7188 1342.1406,1033.5781 Q1342.7656,1032.4219 1343.8594,1031.8125 Q1344.9531,1031.1875 1346.1875,1031.1875 Q1346.9219,1031.1875 1347.5625,1031.3594 Q1348.2188,1031.5156 1348.7656,1031.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72" x="1363" y="1041.7285">UserCreate</text><line style="stroke:#181818;stroke-width:0.5;" x1="1318.5" x2="1450.5" y1="1052" y2="1052"/><ellipse cx="1328.5" cy="1066.3047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="1337.5" y="1070.5332">Password : string</text><line style="stroke:#181818;stroke-width:0.5;" x1="1318.5" x2="1450.5" y1="1077.6094" y2="1077.6094"/></g><!--MD5=[f8bd6c2ec23e906322bbeaf68b53bb4f]
class UserLogin--><g id="elem_UserLogin"><rect codeLine="221" fill="#F1F1F1" height="83.2188" id="UserLogin" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="1003.5" y="815.5"/><ellipse cx="1035.6" cy="831.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1038.3656,827.375 Q1038.5219,827.1563 1038.7094,827.0469 Q1038.8969,826.9375 1039.1156,826.9375 Q1039.4906,826.9375 1039.725,827.2031 Q1039.9594,827.4531 1039.9594,828.0625 L1039.9594,829.5156 Q1039.9594,830.125 1039.725,830.3906 Q1039.4906,830.6563 1039.1156,830.6563 Q1038.7719,830.6563 1038.5688,830.4531 Q1038.3656,830.2656 1038.2563,829.75 Q1038.2094,829.3906 1038.0219,829.2031 Q1037.6938,828.8281 1037.0844,828.6094 Q1036.475,828.3906 1035.85,828.3906 Q1035.0844,828.3906 1034.4438,828.7188 Q1033.8188,829.0469 1033.3188,829.7969 Q1032.8344,830.5469 1032.8344,831.5781 L1032.8344,832.6719 Q1032.8344,833.9063 1033.725,834.7344 Q1034.6156,835.5469 1036.2094,835.5469 Q1037.1469,835.5469 1037.8031,835.2969 Q1038.1938,835.1406 1038.6156,834.7031 Q1038.8813,834.4375 1039.0219,834.3594 Q1039.1781,834.2813 1039.3813,834.2813 Q1039.7094,834.2813 1039.9594,834.5469 Q1040.225,834.7969 1040.225,835.1406 Q1040.225,835.4844 1039.8813,835.8906 Q1039.3813,836.4688 1038.5844,836.7969 Q1037.5063,837.25 1036.2094,837.25 Q1034.6938,837.25 1033.4906,836.625 Q1032.5063,836.125 1031.8188,835.0625 Q1031.1313,833.9844 1031.1313,832.7031 L1031.1313,831.5469 Q1031.1313,830.2188 1031.7406,829.0781 Q1032.3656,827.9219 1033.4594,827.3125 Q1034.5531,826.6875 1035.7875,826.6875 Q1036.5219,826.6875 1037.1625,826.8594 Q1037.8188,827.0156 1038.3656,827.375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="1053.4" y="837.2285">UserLogin</text><line style="stroke:#181818;stroke-width:0.5;" x1="1004.5" x2="1136.5" y1="847.5" y2="847.5"/><ellipse cx="1014.5" cy="861.8047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="1023.5" y="866.0332">Email : string</text><ellipse cx="1014.5" cy="879.4141" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="1023.5" y="883.6426">Password : string</text><line style="stroke:#181818;stroke-width:0.5;" x1="1004.5" x2="1136.5" y1="890.7188" y2="890.7188"/></g><!--MD5=[7e38db3769ab3d4a7934dc4e6ba3ae24]
class VerifyCredentials--><g id="elem_VerifyCredentials"><rect codeLine="226" fill="#F1F1F1" height="83.2188" id="VerifyCredentials" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="140" x="757.5" y="815.5"/><ellipse cx="772.5" cy="831.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M775.2656,827.375 Q775.4219,827.1563 775.6094,827.0469 Q775.7969,826.9375 776.0156,826.9375 Q776.3906,826.9375 776.625,827.2031 Q776.8594,827.4531 776.8594,828.0625 L776.8594,829.5156 Q776.8594,830.125 776.625,830.3906 Q776.3906,830.6563 776.0156,830.6563 Q775.6719,830.6563 775.4688,830.4531 Q775.2656,830.2656 775.1563,829.75 Q775.1094,829.3906 774.9219,829.2031 Q774.5938,828.8281 773.9844,828.6094 Q773.375,828.3906 772.75,828.3906 Q771.9844,828.3906 771.3438,828.7188 Q770.7188,829.0469 770.2188,829.7969 Q769.7344,830.5469 769.7344,831.5781 L769.7344,832.6719 Q769.7344,833.9063 770.625,834.7344 Q771.5156,835.5469 773.1094,835.5469 Q774.0469,835.5469 774.7031,835.2969 Q775.0938,835.1406 775.5156,834.7031 Q775.7813,834.4375 775.9219,834.3594 Q776.0781,834.2813 776.2813,834.2813 Q776.6094,834.2813 776.8594,834.5469 Q777.125,834.7969 777.125,835.1406 Q777.125,835.4844 776.7813,835.8906 Q776.2813,836.4688 775.4844,836.7969 Q774.4063,837.25 773.1094,837.25 Q771.5938,837.25 770.3906,836.625 Q769.4063,836.125 768.7188,835.0625 Q768.0313,833.9844 768.0313,832.7031 L768.0313,831.5469 Q768.0313,830.2188 768.6406,829.0781 Q769.2656,827.9219 770.3594,827.3125 Q771.4531,826.6875 772.6875,826.6875 Q773.4219,826.6875 774.0625,826.8594 Q774.7188,827.0156 775.2656,827.375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="786.5" y="837.2285">VerifyCredentials</text><line style="stroke:#181818;stroke-width:0.5;" x1="758.5" x2="896.5" y1="847.5" y2="847.5"/><ellipse cx="768.5" cy="861.8047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="777.5" y="866.0332">Email : string</text><ellipse cx="768.5" cy="879.4141" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="777.5" y="883.6426">Password : string</text><line style="stroke:#181818;stroke-width:0.5;" x1="758.5" x2="896.5" y1="890.7188" y2="890.7188"/></g><!--MD5=[6ac818b5870897fde505b1069c30005c]
class IUserProvider--><g id="elem_IUserProvider"><rect codeLine="109" fill="#F1F1F1" height="188.875" id="IUserProvider" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="540" x="2402.5" y="540"/><ellipse cx="2625.25" cy="556" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M2626.2031,552.6406 L2626.2031,559.2969 L2627.9219,559.2969 Q2628.5313,559.2969 2628.7969,559.5313 Q2629.0625,559.7656 2629.0625,560.1563 Q2629.0625,560.5313 2628.7969,560.7656 Q2628.5313,561 2627.9219,561 L2622.7813,561 Q2622.1719,561 2621.9063,560.7656 Q2621.6406,560.5313 2621.6406,560.1406 Q2621.6406,559.7656 2621.9063,559.5313 Q2622.1719,559.2969 2622.7813,559.2969 L2624.5,559.2969 L2624.5,552.6406 L2622.7813,552.6406 Q2622.1719,552.6406 2621.9063,552.4063 Q2621.6406,552.1719 2621.6406,551.7813 Q2621.6406,551.4063 2621.9063,551.1719 Q2622.1719,550.9375 2622.7813,550.9375 L2627.9219,550.9375 Q2628.5313,550.9375 2628.7969,551.1719 Q2629.0625,551.4063 2629.0625,551.7813 Q2629.0625,552.1719 2628.7969,552.4063 Q2628.5313,552.6406 2627.9219,552.6406 L2626.2031,552.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="86" x="2645.75" y="561.7285">IUserProvider</text><line style="stroke:#181818;stroke-width:0.5;" x1="2403.5" x2="2941.5" y1="572" y2="572"/><line style="stroke:#181818;stroke-width:0.5;" x1="2403.5" x2="2941.5" y1="580" y2="580"/><ellipse cx="2413.5" cy="594.3047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="356" x="2422.5" y="598.5332">CreateUserAsync(userCreate : DbUser) : Task&lt;DbUser&gt;</text><ellipse cx="2413.5" cy="611.9141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="336" x="2422.5" y="616.1426">GetUserByEmailAsync(email : string) : Task&lt;DbUser&gt;</text><ellipse cx="2413.5" cy="629.5234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="271" x="2422.5" y="633.752">GetUserByIdAsync(id : int) : Task&lt;DbUser&gt;</text><ellipse cx="2413.5" cy="647.1328" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="365" x="2422.5" y="651.3613">UpdateUserFailedTriesAsync(userId : int) : Task&lt;DbUser&gt;</text><ellipse cx="2413.5" cy="664.7422" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="382" x="2422.5" y="668.9707">UpdateUserLoginSuccessAsync(userId : int) : Task&lt;DbUser&gt;</text><ellipse cx="2413.5" cy="682.3516" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="409" x="2422.5" y="686.5801">UpdateUserLoginNewLocationAsync(userId : int) : Task&lt;DbUser&gt;</text><ellipse cx="2413.5" cy="699.9609" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="298" x="2422.5" y="704.1895">UpdateUserToVerifiedAsync(userID : int) : Task</text><ellipse cx="2413.5" cy="717.5703" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="514" x="2422.5" y="721.7988">UpdateUserLoginSuccessWithVerificationCodeAsync(userId : int) : Task&lt;DbUser&gt;</text></g><!--MD5=[e3292821846300d7b478166358ada8cf]
class ILeakedPasswordProvider--><g id="elem_ILeakedPasswordProvider"><rect codeLine="120" fill="#F1F1F1" height="65.6094" id="ILeakedPasswordProvider" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="408" x="2977.5" y="601.5"/><ellipse cx="3094.75" cy="617.5" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M3095.7031,614.1406 L3095.7031,620.7969 L3097.4219,620.7969 Q3098.0313,620.7969 3098.2969,621.0313 Q3098.5625,621.2656 3098.5625,621.6563 Q3098.5625,622.0313 3098.2969,622.2656 Q3098.0313,622.5 3097.4219,622.5 L3092.2813,622.5 Q3091.6719,622.5 3091.4063,622.2656 Q3091.1406,622.0313 3091.1406,621.6406 Q3091.1406,621.2656 3091.4063,621.0313 Q3091.6719,620.7969 3092.2813,620.7969 L3094,620.7969 L3094,614.1406 L3092.2813,614.1406 Q3091.6719,614.1406 3091.4063,613.9063 Q3091.1406,613.6719 3091.1406,613.2813 Q3091.1406,612.9063 3091.4063,612.6719 Q3091.6719,612.4375 3092.2813,612.4375 L3097.4219,612.4375 Q3098.0313,612.4375 3098.2969,612.6719 Q3098.5625,612.9063 3098.5625,613.2813 Q3098.5625,613.6719 3098.2969,613.9063 Q3098.0313,614.1406 3097.4219,614.1406 L3095.7031,614.1406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="165" x="3115.25" y="623.2285">ILeakedPasswordProvider</text><line style="stroke:#181818;stroke-width:0.5;" x1="2978.5" x2="3384.5" y1="633.5" y2="633.5"/><line style="stroke:#181818;stroke-width:0.5;" x1="2978.5" x2="3384.5" y1="641.5" y2="641.5"/><ellipse cx="2988.5" cy="655.8047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="382" x="2997.5" y="660.0332">GetIsPasswordLeakedAsync(password : string) : Task&lt;bool&gt;</text></g><!--MD5=[88f66da615ead437be96f70edff3214c]
class UserToken--><g id="elem_UserToken"><rect codeLine="187" fill="#F1F1F1" height="100.8281" id="UserToken" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="113" x="232" y="806.5"/><ellipse cx="252.4" cy="822.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M255.1656,818.375 Q255.3219,818.1563 255.5094,818.0469 Q255.6969,817.9375 255.9156,817.9375 Q256.2906,817.9375 256.525,818.2031 Q256.7594,818.4531 256.7594,819.0625 L256.7594,820.5156 Q256.7594,821.125 256.525,821.3906 Q256.2906,821.6563 255.9156,821.6563 Q255.5719,821.6563 255.3688,821.4531 Q255.1656,821.2656 255.0563,820.75 Q255.0094,820.3906 254.8219,820.2031 Q254.4938,819.8281 253.8844,819.6094 Q253.275,819.3906 252.65,819.3906 Q251.8844,819.3906 251.2438,819.7188 Q250.6188,820.0469 250.1188,820.7969 Q249.6344,821.5469 249.6344,822.5781 L249.6344,823.6719 Q249.6344,824.9063 250.525,825.7344 Q251.4156,826.5469 253.0094,826.5469 Q253.9469,826.5469 254.6031,826.2969 Q254.9938,826.1406 255.4156,825.7031 Q255.6813,825.4375 255.8219,825.3594 Q255.9781,825.2813 256.1813,825.2813 Q256.5094,825.2813 256.7594,825.5469 Q257.025,825.7969 257.025,826.1406 Q257.025,826.4844 256.6813,826.8906 Q256.1813,827.4688 255.3844,827.7969 Q254.3063,828.25 253.0094,828.25 Q251.4938,828.25 250.2906,827.625 Q249.3063,827.125 248.6188,826.0625 Q247.9313,824.9844 247.9313,823.7031 L247.9313,822.5469 Q247.9313,821.2188 248.5406,820.0781 Q249.1656,818.9219 250.2594,818.3125 Q251.3531,817.6875 252.5875,817.6875 Q253.3219,817.6875 253.9625,817.8594 Q254.6188,818.0156 255.1656,818.375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="267.6" y="828.2285">UserToken</text><line style="stroke:#181818;stroke-width:0.5;" x1="233" x2="344" y1="838.5" y2="838.5"/><ellipse cx="243" cy="852.8047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="252" y="857.0332">UserID : int</text><ellipse cx="243" cy="870.4141" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="252" y="874.6426">Email : string</text><ellipse cx="243" cy="888.0234" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="252" y="892.252">Token : string</text><line style="stroke:#181818;stroke-width:0.5;" x1="233" x2="344" y1="899.3281" y2="899.3281"/></g><!--MD5=[3a13148eff96962085f13babcc0d4f9f]
class IUserLocationProvider--><g id="elem_IUserLocationProvider"><rect codeLine="136" fill="#F1F1F1" height="100.8281" id="IUserLocationProvider" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="540" x="3995.5" y="300"/><ellipse cx="4191.25" cy="316" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M4192.2031,312.6406 L4192.2031,319.2969 L4193.9219,319.2969 Q4194.5313,319.2969 4194.7969,319.5313 Q4195.0625,319.7656 4195.0625,320.1563 Q4195.0625,320.5313 4194.7969,320.7656 Q4194.5313,321 4193.9219,321 L4188.7813,321 Q4188.1719,321 4187.9063,320.7656 Q4187.6406,320.5313 4187.6406,320.1406 Q4187.6406,319.7656 4187.9063,319.5313 Q4188.1719,319.2969 4188.7813,319.2969 L4190.5,319.2969 L4190.5,312.6406 L4188.7813,312.6406 Q4188.1719,312.6406 4187.9063,312.4063 Q4187.6406,312.1719 4187.6406,311.7813 Q4187.6406,311.4063 4187.9063,311.1719 Q4188.1719,310.9375 4188.7813,310.9375 L4193.9219,310.9375 Q4194.5313,310.9375 4194.7969,311.1719 Q4195.0625,311.4063 4195.0625,311.7813 Q4195.0625,312.1719 4194.7969,312.4063 Q4194.5313,312.6406 4193.9219,312.6406 L4192.2031,312.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="140" x="4211.75" y="321.7285">IUserLocationProvider</text><line style="stroke:#181818;stroke-width:0.5;" x1="3996.5" x2="4534.5" y1="332" y2="332"/><line style="stroke:#181818;stroke-width:0.5;" x1="3996.5" x2="4534.5" y1="340" y2="340"/><ellipse cx="4006.5" cy="354.3047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="260" x="4015.5" y="358.5332">IsIPLockedAsync(ip : string) : Task&lt;bool&gt;</text><ellipse cx="4006.5" cy="371.9141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="441" x="4015.5" y="376.1426">LogLocationAsync(userLocation: UserLocation) : Task&lt;UserLocation&gt;</text><ellipse cx="4006.5" cy="389.5234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="514" x="4015.5" y="393.752">UserWasLoggedInFromLocationAsync(userLocation : UserLocation) : Task&lt;bool&gt;</text></g><!--MD5=[3a675687b1cd1bb713529f5053553131]
class SqlProvider--><g id="elem_SqlProvider"><rect codeLine="124" fill="#F1F1F1" height="100.8281" id="SqlProvider" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="700" x="3420.5" y="584"/><ellipse cx="3729.75" cy="600" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M3732.5156,595.875 Q3732.6719,595.6563 3732.8594,595.5469 Q3733.0469,595.4375 3733.2656,595.4375 Q3733.6406,595.4375 3733.875,595.7031 Q3734.1094,595.9531 3734.1094,596.5625 L3734.1094,598.0156 Q3734.1094,598.625 3733.875,598.8906 Q3733.6406,599.1563 3733.2656,599.1563 Q3732.9219,599.1563 3732.7188,598.9531 Q3732.5156,598.7656 3732.4063,598.25 Q3732.3594,597.8906 3732.1719,597.7031 Q3731.8438,597.3281 3731.2344,597.1094 Q3730.625,596.8906 3730,596.8906 Q3729.2344,596.8906 3728.5938,597.2188 Q3727.9688,597.5469 3727.4688,598.2969 Q3726.9844,599.0469 3726.9844,600.0781 L3726.9844,601.1719 Q3726.9844,602.4063 3727.875,603.2344 Q3728.7656,604.0469 3730.3594,604.0469 Q3731.2969,604.0469 3731.9531,603.7969 Q3732.3438,603.6406 3732.7656,603.2031 Q3733.0313,602.9375 3733.1719,602.8594 Q3733.3281,602.7813 3733.5313,602.7813 Q3733.8594,602.7813 3734.1094,603.0469 Q3734.375,603.2969 3734.375,603.6406 Q3734.375,603.9844 3734.0313,604.3906 Q3733.5313,604.9688 3732.7344,605.2969 Q3731.6563,605.75 3730.3594,605.75 Q3728.8438,605.75 3727.6406,605.125 Q3726.6563,604.625 3725.9688,603.5625 Q3725.2813,602.4844 3725.2813,601.2031 L3725.2813,600.0469 Q3725.2813,598.7188 3725.8906,597.5781 Q3726.5156,596.4219 3727.6094,595.8125 Q3728.7031,595.1875 3729.9375,595.1875 Q3730.6719,595.1875 3731.3125,595.3594 Q3731.9688,595.5156 3732.5156,595.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="3750.25" y="605.7285">SqlProvider</text><line style="stroke:#181818;stroke-width:0.5;" x1="3421.5" x2="4119.5" y1="616" y2="616"/><line style="stroke:#181818;stroke-width:1.0;" x1="3421.5" x2="4119.5" y1="624" y2="624"/><ellipse cx="3431.5" cy="638.3047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="199" x="3440.5" y="642.5332">SqlProvider(connection : string)</text><polygon fill="#FFFF44" points="3431.5,650.9141,3435.5,654.9141,3431.5,658.9141,3427.5,654.9141" style="stroke:#B38D22;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="674" x="3440.5" y="660.1426">RunSpAsync(storedProcedureName : string, storedProcedureElements : SpElements[]) : Task&lt;DataTable&gt;</text><polygon fill="#FFFF44" points="3431.5,668.5234,3435.5,672.5234,3431.5,676.5234,3427.5,672.5234" style="stroke:#B38D22;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="322" x="3440.5" y="677.752">RunQueryAsync(query : string) : Task&lt;DataTable&gt;</text></g><!--MD5=[54606654dd7012b88529a0f0305a5f2d]
class LeakedPasswordProvider--><g id="elem_LeakedPasswordProvider"><rect codeLine="131" fill="#F1F1F1" height="65.6094" id="LeakedPasswordProvider" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="379" x="3581" y="317.5"/><ellipse cx="3685.75" cy="333.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M3688.5156,329.375 Q3688.6719,329.1563 3688.8594,329.0469 Q3689.0469,328.9375 3689.2656,328.9375 Q3689.6406,328.9375 3689.875,329.2031 Q3690.1094,329.4531 3690.1094,330.0625 L3690.1094,331.5156 Q3690.1094,332.125 3689.875,332.3906 Q3689.6406,332.6563 3689.2656,332.6563 Q3688.9219,332.6563 3688.7188,332.4531 Q3688.5156,332.2656 3688.4063,331.75 Q3688.3594,331.3906 3688.1719,331.2031 Q3687.8438,330.8281 3687.2344,330.6094 Q3686.625,330.3906 3686,330.3906 Q3685.2344,330.3906 3684.5938,330.7188 Q3683.9688,331.0469 3683.4688,331.7969 Q3682.9844,332.5469 3682.9844,333.5781 L3682.9844,334.6719 Q3682.9844,335.9063 3683.875,336.7344 Q3684.7656,337.5469 3686.3594,337.5469 Q3687.2969,337.5469 3687.9531,337.2969 Q3688.3438,337.1406 3688.7656,336.7031 Q3689.0313,336.4375 3689.1719,336.3594 Q3689.3281,336.2813 3689.5313,336.2813 Q3689.8594,336.2813 3690.1094,336.5469 Q3690.375,336.7969 3690.375,337.1406 Q3690.375,337.4844 3690.0313,337.8906 Q3689.5313,338.4688 3688.7344,338.7969 Q3687.6563,339.25 3686.3594,339.25 Q3684.8438,339.25 3683.6406,338.625 Q3682.6563,338.125 3681.9688,337.0625 Q3681.2813,335.9844 3681.2813,334.7031 L3681.2813,333.5469 Q3681.2813,332.2188 3681.8906,331.0781 Q3682.5156,329.9219 3683.6094,329.3125 Q3684.7031,328.6875 3685.9375,328.6875 Q3686.6719,328.6875 3687.3125,328.8594 Q3687.9688,329.0156 3688.5156,329.375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="161" x="3706.25" y="339.2285">LeakedPasswordProvider</text><line style="stroke:#181818;stroke-width:0.5;" x1="3582" x2="3959" y1="349.5" y2="349.5"/><line style="stroke:#181818;stroke-width:1.0;" x1="3582" x2="3959" y1="357.5" y2="357.5"/><ellipse cx="3592" cy="371.8047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="353" x="3601" y="376.0332">LeakedPasswordProvider(configuration : IConfiguration)</text></g><!--MD5=[615787437c5f23b61c90c6d240d4b67f]
class UserProvider--><g id="elem_UserProvider"><rect codeLine="142" fill="#F1F1F1" height="83.2188" id="UserProvider" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="300" x="3245.5" y="309"/><ellipse cx="3350.25" cy="325" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M3353.0156,320.875 Q3353.1719,320.6563 3353.3594,320.5469 Q3353.5469,320.4375 3353.7656,320.4375 Q3354.1406,320.4375 3354.375,320.7031 Q3354.6094,320.9531 3354.6094,321.5625 L3354.6094,323.0156 Q3354.6094,323.625 3354.375,323.8906 Q3354.1406,324.1563 3353.7656,324.1563 Q3353.4219,324.1563 3353.2188,323.9531 Q3353.0156,323.7656 3352.9063,323.25 Q3352.8594,322.8906 3352.6719,322.7031 Q3352.3438,322.3281 3351.7344,322.1094 Q3351.125,321.8906 3350.5,321.8906 Q3349.7344,321.8906 3349.0938,322.2188 Q3348.4688,322.5469 3347.9688,323.2969 Q3347.4844,324.0469 3347.4844,325.0781 L3347.4844,326.1719 Q3347.4844,327.4063 3348.375,328.2344 Q3349.2656,329.0469 3350.8594,329.0469 Q3351.7969,329.0469 3352.4531,328.7969 Q3352.8438,328.6406 3353.2656,328.2031 Q3353.5313,327.9375 3353.6719,327.8594 Q3353.8281,327.7813 3354.0313,327.7813 Q3354.3594,327.7813 3354.6094,328.0469 Q3354.875,328.2969 3354.875,328.6406 Q3354.875,328.9844 3354.5313,329.3906 Q3354.0313,329.9688 3353.2344,330.2969 Q3352.1563,330.75 3350.8594,330.75 Q3349.3438,330.75 3348.1406,330.125 Q3347.1563,329.625 3346.4688,328.5625 Q3345.7813,327.4844 3345.7813,326.2031 L3345.7813,325.0469 Q3345.7813,323.7188 3346.3906,322.5781 Q3347.0156,321.4219 3348.1094,320.8125 Q3349.2031,320.1875 3350.4375,320.1875 Q3351.1719,320.1875 3351.8125,320.3594 Q3352.4688,320.5156 3353.0156,320.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="3370.75" y="330.7285">UserProvider</text><line style="stroke:#181818;stroke-width:0.5;" x1="3246.5" x2="3544.5" y1="341" y2="341"/><line style="stroke:#181818;stroke-width:1.0;" x1="3246.5" x2="3544.5" y1="349" y2="349"/><ellipse cx="3256.5" cy="363.3047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="274" x="3265.5" y="367.5332">UserProvider(configuration : IConfiguration)</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="3253.5" y="377.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="217" x="3265.5" y="385.1426">DRToUser(dr : DataRow) : DbUser</text></g><!--MD5=[a2d8207c5488f269b0816fb28beca551]
class DbUser--><g id="elem_DbUser"><rect codeLine="201" fill="#F1F1F1" height="136.0469" id="DbUser" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="210" x="1900.5" y="789"/><ellipse cx="1977.75" cy="805" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1980.5156,800.875 Q1980.6719,800.6563 1980.8594,800.5469 Q1981.0469,800.4375 1981.2656,800.4375 Q1981.6406,800.4375 1981.875,800.7031 Q1982.1094,800.9531 1982.1094,801.5625 L1982.1094,803.0156 Q1982.1094,803.625 1981.875,803.8906 Q1981.6406,804.1563 1981.2656,804.1563 Q1980.9219,804.1563 1980.7188,803.9531 Q1980.5156,803.7656 1980.4063,803.25 Q1980.3594,802.8906 1980.1719,802.7031 Q1979.8438,802.3281 1979.2344,802.1094 Q1978.625,801.8906 1978,801.8906 Q1977.2344,801.8906 1976.5938,802.2188 Q1975.9688,802.5469 1975.4688,803.2969 Q1974.9844,804.0469 1974.9844,805.0781 L1974.9844,806.1719 Q1974.9844,807.4063 1975.875,808.2344 Q1976.7656,809.0469 1978.3594,809.0469 Q1979.2969,809.0469 1979.9531,808.7969 Q1980.3438,808.6406 1980.7656,808.2031 Q1981.0313,807.9375 1981.1719,807.8594 Q1981.3281,807.7813 1981.5313,807.7813 Q1981.8594,807.7813 1982.1094,808.0469 Q1982.375,808.2969 1982.375,808.6406 Q1982.375,808.9844 1982.0313,809.3906 Q1981.5313,809.9688 1980.7344,810.2969 Q1979.6563,810.75 1978.3594,810.75 Q1976.8438,810.75 1975.6406,810.125 Q1974.6563,809.625 1973.9688,808.5625 Q1973.2813,807.4844 1973.2813,806.2031 L1973.2813,805.0469 Q1973.2813,803.7188 1973.8906,802.5781 Q1974.5156,801.4219 1975.6094,800.8125 Q1976.7031,800.1875 1977.9375,800.1875 Q1978.6719,800.1875 1979.3125,800.3594 Q1979.9688,800.5156 1980.5156,800.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="1998.25" y="810.7285">DbUser</text><line style="stroke:#181818;stroke-width:0.5;" x1="1901.5" x2="2109.5" y1="821" y2="821"/><ellipse cx="1911.5" cy="835.3047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="156" x="1920.5" y="839.5332">HashedPassword : string</text><ellipse cx="1911.5" cy="852.9141" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="1920.5" y="857.1426">Salt : string</text><ellipse cx="1911.5" cy="870.5234" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="1920.5" y="874.752">SecretKey : string</text><ellipse cx="1911.5" cy="888.1328" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="1920.5" y="892.3613">Count : long</text><ellipse cx="1911.5" cy="905.7422" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="184" x="1920.5" y="909.9707">LastRequestDate : datetime?</text><line style="stroke:#181818;stroke-width:0.5;" x1="1901.5" x2="2109.5" y1="917.0469" y2="917.0469"/></g><!--MD5=[1a3d1e414f70b9a6597f64281cc6a626]
class UserLocation--><g id="elem_UserLocation"><rect codeLine="231" fill="#F1F1F1" height="153.6563" id="UserLocation" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="165" x="4183" y="557.5"/><ellipse cx="4220.5" cy="573.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M4223.2656,569.375 Q4223.4219,569.1563 4223.6094,569.0469 Q4223.7969,568.9375 4224.0156,568.9375 Q4224.3906,568.9375 4224.625,569.2031 Q4224.8594,569.4531 4224.8594,570.0625 L4224.8594,571.5156 Q4224.8594,572.125 4224.625,572.3906 Q4224.3906,572.6563 4224.0156,572.6563 Q4223.6719,572.6563 4223.4688,572.4531 Q4223.2656,572.2656 4223.1563,571.75 Q4223.1094,571.3906 4222.9219,571.2031 Q4222.5938,570.8281 4221.9844,570.6094 Q4221.375,570.3906 4220.75,570.3906 Q4219.9844,570.3906 4219.3438,570.7188 Q4218.7188,571.0469 4218.2188,571.7969 Q4217.7344,572.5469 4217.7344,573.5781 L4217.7344,574.6719 Q4217.7344,575.9063 4218.625,576.7344 Q4219.5156,577.5469 4221.1094,577.5469 Q4222.0469,577.5469 4222.7031,577.2969 Q4223.0938,577.1406 4223.5156,576.7031 Q4223.7813,576.4375 4223.9219,576.3594 Q4224.0781,576.2813 4224.2813,576.2813 Q4224.6094,576.2813 4224.8594,576.5469 Q4225.125,576.7969 4225.125,577.1406 Q4225.125,577.4844 4224.7813,577.8906 Q4224.2813,578.4688 4223.4844,578.7969 Q4222.4063,579.25 4221.1094,579.25 Q4219.5938,579.25 4218.3906,578.625 Q4217.4063,578.125 4216.7188,577.0625 Q4216.0313,575.9844 4216.0313,574.7031 L4216.0313,573.5469 Q4216.0313,572.2188 4216.6406,571.0781 Q4217.2656,569.9219 4218.3594,569.3125 Q4219.4531,568.6875 4220.6875,568.6875 Q4221.4219,568.6875 4222.0625,568.8594 Q4222.7188,569.0156 4223.2656,569.375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="4239.5" y="579.2285">UserLocation</text><line style="stroke:#181818;stroke-width:0.5;" x1="4184" x2="4347" y1="589.5" y2="589.5"/><ellipse cx="4194" cy="603.8047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="4203" y="608.0332">ID : int</text><ellipse cx="4194" cy="621.4141" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="4203" y="625.6426">UserID : int</text><ellipse cx="4194" cy="639.0234" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="4203" y="643.252">IP : string</text><ellipse cx="4194" cy="656.6328" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="4203" y="660.8613">UserAgent : string</text><ellipse cx="4194" cy="674.2422" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="4203" y="678.4707">Successful : bool</text><ellipse cx="4194" cy="691.8516" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="4203" y="696.0801">CreateDate : datetime</text><line style="stroke:#181818;stroke-width:0.5;" x1="4184" x2="4347" y1="703.1563" y2="703.1563"/></g><!--MD5=[c40368751ea5476301fbcdc8cb25eba8]
class Security--><g id="elem_Security"><rect codeLine="163" fill="#F1F1F1" height="153.6563" id="Security" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="580" x="3061.5" y="7"/><ellipse cx="3321.75" cy="23" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M3324.5156,18.875 Q3324.6719,18.6563 3324.8594,18.5469 Q3325.0469,18.4375 3325.2656,18.4375 Q3325.6406,18.4375 3325.875,18.7031 Q3326.1094,18.9531 3326.1094,19.5625 L3326.1094,21.0156 Q3326.1094,21.625 3325.875,21.8906 Q3325.6406,22.1563 3325.2656,22.1563 Q3324.9219,22.1563 3324.7188,21.9531 Q3324.5156,21.7656 3324.4063,21.25 Q3324.3594,20.8906 3324.1719,20.7031 Q3323.8438,20.3281 3323.2344,20.1094 Q3322.625,19.8906 3322,19.8906 Q3321.2344,19.8906 3320.5938,20.2188 Q3319.9688,20.5469 3319.4688,21.2969 Q3318.9844,22.0469 3318.9844,23.0781 L3318.9844,24.1719 Q3318.9844,25.4063 3319.875,26.2344 Q3320.7656,27.0469 3322.3594,27.0469 Q3323.2969,27.0469 3323.9531,26.7969 Q3324.3438,26.6406 3324.7656,26.2031 Q3325.0313,25.9375 3325.1719,25.8594 Q3325.3281,25.7813 3325.5313,25.7813 Q3325.8594,25.7813 3326.1094,26.0469 Q3326.375,26.2969 3326.375,26.6406 Q3326.375,26.9844 3326.0313,27.3906 Q3325.5313,27.9688 3324.7344,28.2969 Q3323.6563,28.75 3322.3594,28.75 Q3320.8438,28.75 3319.6406,28.125 Q3318.6563,27.625 3317.9688,26.5625 Q3317.2813,25.4844 3317.2813,24.2031 L3317.2813,23.0469 Q3317.2813,21.7188 3317.8906,20.5781 Q3318.5156,19.4219 3319.6094,18.8125 Q3320.7031,18.1875 3321.9375,18.1875 Q3322.6719,18.1875 3323.3125,18.3594 Q3323.9688,18.5156 3324.5156,18.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="3342.25" y="28.7285">Security</text><line style="stroke:#181818;stroke-width:0.5;" x1="3062.5" x2="3640.5" y1="39" y2="39"/><line style="stroke:#181818;stroke-width:1.0;" x1="3062.5" x2="3640.5" y1="47" y2="47"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="3069.5" y="58.3047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="253" x="3081.5" y="65.5332">ComputeHash(password : string) : string</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="3069.5" y="75.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="321" x="3081.5" y="83.1426">HashPassword(password : salt, salt : string) : string</text><ellipse cx="3072.5" cy="96.5234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="197" x="3081.5" y="100.752">GetSalt(saltLength : int) : string</text><ellipse cx="3072.5" cy="114.1328" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="554" x="3081.5" y="118.3613">GetEncryptedAndSaltedPassword(password : string, salt : string, pepper : string) : string</text><ellipse cx="3072.5" cy="131.7422" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="273" x="3081.5" y="135.9707">GetHotp(key : string, counter : long) : string</text><ellipse cx="3072.5" cy="149.3516" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="139" x="3081.5" y="153.5801">GetHmacKey() : string</text></g><!--MD5=[530bdd8d88d30015127c6b1b07c38463]
class RegexHelper--><g id="elem_RegexHelper"><rect codeLine="173" fill="#F1F1F1" height="65.6094" id="RegexHelper" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="388" x="3676.5" y="51"/><ellipse cx="3825.75" cy="67" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M3828.5156,62.875 Q3828.6719,62.6563 3828.8594,62.5469 Q3829.0469,62.4375 3829.2656,62.4375 Q3829.6406,62.4375 3829.875,62.7031 Q3830.1094,62.9531 3830.1094,63.5625 L3830.1094,65.0156 Q3830.1094,65.625 3829.875,65.8906 Q3829.6406,66.1563 3829.2656,66.1563 Q3828.9219,66.1563 3828.7188,65.9531 Q3828.5156,65.7656 3828.4063,65.25 Q3828.3594,64.8906 3828.1719,64.7031 Q3827.8438,64.3281 3827.2344,64.1094 Q3826.625,63.8906 3826,63.8906 Q3825.2344,63.8906 3824.5938,64.2188 Q3823.9688,64.5469 3823.4688,65.2969 Q3822.9844,66.0469 3822.9844,67.0781 L3822.9844,68.1719 Q3822.9844,69.4063 3823.875,70.2344 Q3824.7656,71.0469 3826.3594,71.0469 Q3827.2969,71.0469 3827.9531,70.7969 Q3828.3438,70.6406 3828.7656,70.2031 Q3829.0313,69.9375 3829.1719,69.8594 Q3829.3281,69.7813 3829.5313,69.7813 Q3829.8594,69.7813 3830.1094,70.0469 Q3830.375,70.2969 3830.375,70.6406 Q3830.375,70.9844 3830.0313,71.3906 Q3829.5313,71.9688 3828.7344,72.2969 Q3827.6563,72.75 3826.3594,72.75 Q3824.8438,72.75 3823.6406,72.125 Q3822.6563,71.625 3821.9688,70.5625 Q3821.2813,69.4844 3821.2813,68.2031 L3821.2813,67.0469 Q3821.2813,65.7188 3821.8906,64.5781 Q3822.5156,63.4219 3823.6094,62.8125 Q3824.7031,62.1875 3825.9375,62.1875 Q3826.6719,62.1875 3827.3125,62.3594 Q3827.9688,62.5156 3828.5156,62.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="3846.25" y="72.7285">RegexHelper</text><line style="stroke:#181818;stroke-width:0.5;" x1="3677.5" x2="4063.5" y1="83" y2="83"/><line style="stroke:#181818;stroke-width:1.0;" x1="3677.5" x2="4063.5" y1="91" y2="91"/><ellipse cx="3687.5" cy="105.3047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="362" x="3696.5" y="109.5332">TryToGetBrowserWithoutVersion(browser : string) : string</text></g><!--MD5=[3fd616f346a44cd59a91eb10b19e157c]
class User--><g id="elem_User"><rect codeLine="193" fill="#F1F1F1" height="136.0469" id="User" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="168" x="1703.5" y="985"/><ellipse cx="1768.75" cy="1001" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1771.5156,996.875 Q1771.6719,996.6563 1771.8594,996.5469 Q1772.0469,996.4375 1772.2656,996.4375 Q1772.6406,996.4375 1772.875,996.7031 Q1773.1094,996.9531 1773.1094,997.5625 L1773.1094,999.0156 Q1773.1094,999.625 1772.875,999.8906 Q1772.6406,1000.1563 1772.2656,1000.1563 Q1771.9219,1000.1563 1771.7188,999.9531 Q1771.5156,999.7656 1771.4063,999.25 Q1771.3594,998.8906 1771.1719,998.7031 Q1770.8438,998.3281 1770.2344,998.1094 Q1769.625,997.8906 1769,997.8906 Q1768.2344,997.8906 1767.5938,998.2188 Q1766.9688,998.5469 1766.4688,999.2969 Q1765.9844,1000.0469 1765.9844,1001.0781 L1765.9844,1002.1719 Q1765.9844,1003.4063 1766.875,1004.2344 Q1767.7656,1005.0469 1769.3594,1005.0469 Q1770.2969,1005.0469 1770.9531,1004.7969 Q1771.3438,1004.6406 1771.7656,1004.2031 Q1772.0313,1003.9375 1772.1719,1003.8594 Q1772.3281,1003.7813 1772.5313,1003.7813 Q1772.8594,1003.7813 1773.1094,1004.0469 Q1773.375,1004.2969 1773.375,1004.6406 Q1773.375,1004.9844 1773.0313,1005.3906 Q1772.5313,1005.9688 1771.7344,1006.2969 Q1770.6563,1006.75 1769.3594,1006.75 Q1767.8438,1006.75 1766.6406,1006.125 Q1765.6563,1005.625 1764.9688,1004.5625 Q1764.2813,1003.4844 1764.2813,1002.2031 L1764.2813,1001.0469 Q1764.2813,999.7188 1764.8906,998.5781 Q1765.5156,997.4219 1766.6094,996.8125 Q1767.7031,996.1875 1768.9375,996.1875 Q1769.6719,996.1875 1770.3125,996.3594 Q1770.9688,996.5156 1771.5156,996.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="1789.25" y="1006.7285">User</text><line style="stroke:#181818;stroke-width:0.5;" x1="1704.5" x2="1870.5" y1="1017" y2="1017"/><ellipse cx="1714.5" cy="1031.3047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="1723.5" y="1035.5332">ID : int</text><ellipse cx="1714.5" cy="1048.9141" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97" x="1723.5" y="1053.1426">IsVerified : bool</text><ellipse cx="1714.5" cy="1066.5234" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="1723.5" y="1070.752">IsLocked : bool</text><ellipse cx="1714.5" cy="1084.1328" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="1723.5" y="1088.3613">FailedTries : int</text><ellipse cx="1714.5" cy="1101.7422" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="142" x="1723.5" y="1105.9707">LockedDate datetime?</text><line style="stroke:#181818;stroke-width:0.5;" x1="1704.5" x2="1870.5" y1="1113.0469" y2="1113.0469"/></g><!--MD5=[d72258e41e132b68712ed2a953e26009]
class UserBase--><g id="elem_UserBase"><rect codeLine="213" fill="#F1F1F1" height="118.4375" id="UserBase" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="1396" y="1181"/><ellipse cx="1442.75" cy="1197" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1445.5156,1192.875 Q1445.6719,1192.6563 1445.8594,1192.5469 Q1446.0469,1192.4375 1446.2656,1192.4375 Q1446.6406,1192.4375 1446.875,1192.7031 Q1447.1094,1192.9531 1447.1094,1193.5625 L1447.1094,1195.0156 Q1447.1094,1195.625 1446.875,1195.8906 Q1446.6406,1196.1563 1446.2656,1196.1563 Q1445.9219,1196.1563 1445.7188,1195.9531 Q1445.5156,1195.7656 1445.4063,1195.25 Q1445.3594,1194.8906 1445.1719,1194.7031 Q1444.8438,1194.3281 1444.2344,1194.1094 Q1443.625,1193.8906 1443,1193.8906 Q1442.2344,1193.8906 1441.5938,1194.2188 Q1440.9688,1194.5469 1440.4688,1195.2969 Q1439.9844,1196.0469 1439.9844,1197.0781 L1439.9844,1198.1719 Q1439.9844,1199.4063 1440.875,1200.2344 Q1441.7656,1201.0469 1443.3594,1201.0469 Q1444.2969,1201.0469 1444.9531,1200.7969 Q1445.3438,1200.6406 1445.7656,1200.2031 Q1446.0313,1199.9375 1446.1719,1199.8594 Q1446.3281,1199.7813 1446.5313,1199.7813 Q1446.8594,1199.7813 1447.1094,1200.0469 Q1447.375,1200.2969 1447.375,1200.6406 Q1447.375,1200.9844 1447.0313,1201.3906 Q1446.5313,1201.9688 1445.7344,1202.2969 Q1444.6563,1202.75 1443.3594,1202.75 Q1441.8438,1202.75 1440.6406,1202.125 Q1439.6563,1201.625 1438.9688,1200.5625 Q1438.2813,1199.4844 1438.2813,1198.2031 L1438.2813,1197.0469 Q1438.2813,1195.7188 1438.8906,1194.5781 Q1439.5156,1193.4219 1440.6094,1192.8125 Q1441.7031,1192.1875 1442.9375,1192.1875 Q1443.6719,1192.1875 1444.3125,1192.3594 Q1444.9688,1192.5156 1445.5156,1192.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="1463.25" y="1202.7285">UserBase</text><line style="stroke:#181818;stroke-width:0.5;" x1="1397" x2="1558" y1="1213" y2="1213"/><ellipse cx="1407" cy="1227.3047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="1416" y="1231.5332">Email : string</text><ellipse cx="1407" cy="1244.9141" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="1416" y="1249.1426">FirstName : string</text><ellipse cx="1407" cy="1262.5234" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110" x="1416" y="1266.752">LastName : string</text><ellipse cx="1407" cy="1280.1328" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137" x="1416" y="1284.3613">PhoneNumber : string</text><line style="stroke:#181818;stroke-width:0.5;" x1="1397" x2="1558" y1="1291.4375" y2="1291.4375"/></g><!--MD5=[1dfc107116a4b0bc1198698a4e609bfa]
reverse link UserController to IUserManager--><g id="link_UserController_IUserManager"><path codeLine="21" d="M889.5,466.83 C889.5,466.83 889.5,566.23 889.5,566.23 " fill="none" id="UserController-backto-IUserManager" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="889.5,453.83,885.5,459.83,889.5,465.83,893.5,459.83,889.5,453.83" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="882.243" y="475.496">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="882.1391" y="555.8755">1</text></g><!--MD5=[548e9c59867ce01a8de3c5e8efb076c9]
reverse link UserController to ITokenManager--><g id="link_UserController_ITokenManager"><path codeLine="22" d="M562.19,423 C562.19,423 349.17,423 349.17,423 C349.17,423 349.17,521.27 349.17,583.84 " fill="none" id="UserController-backto-ITokenManager" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="575.19,423,569.19,419,563.19,423,569.19,427,575.19,423" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="560.7413" y="422.0053">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="350.2095" y="573.1229">1</text></g><!--MD5=[d4b0c0978a527e7d73578f3b8ff1d639]
link IUserManager to UserCreate--><g id="link_IUserManager_UserCreate"><path codeLine="90" d="M1259.59,694 C1331.21,694 1384.5,694 1384.5,694 C1384.5,694 1384.5,1014.87 1384.5,1014.87 " fill="none" id="IUserManager-to-UserCreate" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1384.5,1019.87,1388.5,1010.87,1384.5,1014.87,1380.5,1010.87,1384.5,1019.87" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="1267.1785" y="692.5443">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="1376.7781" y="1008.9586">1</text></g><!--MD5=[b144519fb167e24c357139cc31a61e5d]
link IUserManager to UserLogin--><g id="link_IUserManager_UserLogin"><path codeLine="91" d="M1070.5,702.77 C1070.5,702.77 1070.5,810.39 1070.5,810.39 " fill="none" id="IUserManager-to-UserLogin" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1070.5,815.39,1074.5,806.39,1070.5,810.39,1066.5,806.39,1070.5,815.39" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="1081.8047" y="724.1462">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="1062.9203" y="804.6795">1</text></g><!--MD5=[bda616a4ec88bb93f38d43595a1d9abc]
link IUserManager to VerifyCredentials--><g id="link_IUserManager_VerifyCredentials"><path codeLine="92" d="M827.5,702.77 C827.5,702.77 827.5,810.39 827.5,810.39 " fill="none" id="IUserManager-to-VerifyCredentials" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="827.5,815.39,831.5,806.39,827.5,810.39,823.5,806.39,827.5,815.39" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="813.7453" y="724.1462">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="819.9203" y="804.6795">1</text></g><!--MD5=[5d0d21d87f609d36e9bd211d6cdf12f6]
link UserManager to IUserManager--><g id="link_UserManager_IUserManager"><path codeLine="93" d="M1379.46,467 C1292.82,467 1231.5,467 1231.5,467 C1231.5,467 1231.5,546.37 1231.5,546.37 " fill="none" id="UserManager-to-IUserManager" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="1238.5,546.37,1231.5,566.37,1224.5,546.37,1238.5,546.37" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[1d484ee4b213f86a79b7b13bd52fde3a]
link MessageManager to IMessageManager--><g id="link_MessageManager_IMessageManager"><path codeLine="94" d="M2742.5,401.41 C2742.5,448.08 2742.5,510 2742.5,510 C2742.5,510 2201.33,510 2201.33,510 C2201.33,510 2201.33,572.7 2201.33,572.7 " fill="none" id="MessageManager-to-IMessageManager" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="2208.33,572.7,2201.33,592.7,2194.33,572.7,2208.33,572.7" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[1231944e95ebfb91f3104517f7260a55]
reverse link UserManager to IUserProvider--><g id="link_UserManager_IUserProvider"><path codeLine="96" d="M2455,493.03 C2455,493.03 2455,539.97 2455,539.97 " fill="none" id="UserManager-backto-IUserProvider" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="2455,480.03,2451,486.03,2455,492.03,2459,486.03,2455,480.03" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="2478.9563" y="501.907">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="2429.6984" y="528.9941">1</text></g><!--MD5=[536fba823f8263b20c30d29df0fd99b8]
reverse link UserManager to IUserLocationManager--><g id="link_UserManager_IUserLocationManager"><path codeLine="97" d="M1607,493.03 C1607,493.03 1607,583.98 1607,583.98 " fill="none" id="UserManager-backto-IUserLocationManager" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="1607,480.03,1603,486.03,1607,492.03,1611,486.03,1607,480.03" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="1579.2813" y="501.907">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="1605.4844" y="573.2825">1</text></g><!--MD5=[acaf6dcafaeef567235e025343905109]
reverse link UserManager to ILeakedPasswordProvider--><g id="link_UserManager_ILeakedPasswordProvider"><path codeLine="98" d="M2520.8,441 C2520.8,441 3094,441 3094,441 C3094,441 3094,545.91 3094,601.24 " fill="none" id="UserManager-backto-ILeakedPasswordProvider" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="2507.8,441,2513.8,445,2519.8,441,2513.8,437,2507.8,441" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="2515.7847" y="439.6555">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="3069.0844" y="590.6851">1</text></g><!--MD5=[f1b914c86bbf4264254e7be00f738a27]
reverse link UserManager to IMessageManager--><g id="link_UserManager_IMessageManager"><path codeLine="99" d="M2035.67,493.03 C2035.67,493.03 2035.67,592.68 2035.67,592.68 " fill="none" id="UserManager-backto-IMessageManager" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="2035.67,480.03,2031.67,486.03,2035.67,492.03,2039.67,486.03,2035.67,480.03" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="2034.0733" y="501.907">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="2014.9112" y="582.2456">1</text></g><!--MD5=[f4b9cc5a9edb981f7418b8fcf7de3067]
link TokenManager to ITokenManager--><g id="link_TokenManager_ITokenManager"><path codeLine="101" d="M227.83,392.1 C227.83,392.1 227.83,563.66 227.83,563.66 " fill="none" id="TokenManager-to-ITokenManager" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="234.83,563.66,227.83,583.66,220.83,563.66,234.83,563.66" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[8f9038f41d1a9fcfa0da510f3a7dcbcc]
reverse link ITokenManager to UserToken--><g id="link_ITokenManager_UserToken"><path codeLine="102" d="M288.5,698.27 C288.5,698.27 288.5,806.45 288.5,806.45 " fill="none" id="ITokenManager-backto-UserToken" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="288.5,685.27,284.5,691.27,288.5,697.27,292.5,691.27,288.5,685.27" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="281.0516" y="706.3286">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="281.0078" y="795.7483">1</text></g><!--MD5=[a7358745a089081073f5a601608e5a73]
link UserLocationManager to IUserLocationManager--><g id="link_UserLocationManager_IUserLocationManager"><path codeLine="105" d="M2564.8,84 C2153.67,84 1337,84 1337,84 C1337,84 1337,563.7 1337,563.7 " fill="none" id="UserLocationManager-to-IUserLocationManager" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="1344,563.7,1337,583.7,1330,563.7,1344,563.7" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[0a4ead1edd2c2b1fdc9bf52f1c627135]
reverse link UserLocationManager to IUserLocationProvider--><g id="link_UserLocationManager_IUserLocationProvider"><path codeLine="106" d="M2795.5,138.68 C2795.5,138.68 2795.5,191 2795.5,191 C2795.5,191 4030,191 4030,191 C4030,191 4030,252.92 4030,299.59 " fill="none" id="UserLocationManager-backto-IUserLocationProvider" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="2795.5,125.68,2791.5,131.68,2795.5,137.68,2799.5,131.68,2795.5,125.68" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="2787.9422" y="147.1035">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="3990.8844" y="289.2043">1</text></g><!--MD5=[ebed19925dbee498eddafde4c2e5889a]
reverse link IUserProvider to DbUser--><g id="link_IUserProvider_DbUser"><path codeLine="152" d="M2389.17,716 C2389.17,716 2005.5,716 2005.5,716 C2005.5,716 2005.5,752.92 2005.5,788.98 " fill="none" id="IUserProvider-backto-DbUser" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="2402.17,716,2396.17,712,2390.17,716,2396.17,720,2402.17,716" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="2387.8964" y="715.4538">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="1998.1172" y="778.1771">1</text></g><!--MD5=[ebfa5078469ba21b5ab21ca793b470a4]
reverse link IUserLocationProvider to UserLocation--><g id="link_IUserLocationProvider_UserLocation"><path codeLine="153" d="M4265.5,414.27 C4265.5,414.27 4265.5,557.41 4265.5,557.41 " fill="none" id="IUserLocationProvider-backto-UserLocation" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="4265.5,401.27,4261.5,407.27,4265.5,413.27,4269.5,407.27,4265.5,401.27" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="4258.0516" y="422.3286">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="4258.1555" y="546.5633">1</text></g><!--MD5=[1d941831239f3bd1b1ef4931734ff75b]
link LeakedPasswordProvider to ILeakedPasswordProvider--><g id="link_LeakedPasswordProvider_ILeakedPasswordProvider"><path codeLine="155" d="M3707.33,383.8 C3707.33,391.25 3707.33,397 3707.33,397 C3707.33,397 3338.83,397 3338.83,397 C3338.83,397 3338.83,581.48 3338.83,581.48 " fill="none" id="LeakedPasswordProvider-to-ILeakedPasswordProvider" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="3345.83,581.48,3338.83,601.48,3331.83,581.48,3345.83,581.48" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[d5b7a4ae7f7e8e823301b74032a4bc45]
link LeakedPasswordProvider to SqlProvider--><g id="link_LeakedPasswordProvider_SqlProvider"><path codeLine="156" d="M3833.67,383.63 C3833.67,383.63 3833.67,563.89 3833.67,563.89 " fill="none" id="LeakedPasswordProvider-to-SqlProvider" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="3840.67,563.89,3833.67,583.89,3826.67,563.89,3840.67,563.89" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[2afc5d4273870e4232a4e992ffb1f14d]
link UserProvider to IUserProvider--><g id="link_UserProvider_IUserProvider"><path codeLine="158" d="M3292.17,392.11 C3292.17,450.32 3292.17,549 3292.17,549 C3292.17,549 2962.94,549 2962.94,549 " fill="none" id="UserProvider-to-IUserProvider" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="2962.94,556,2942.94,549,2962.94,542,2962.94,556" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[49c1666b2e1039e78c6958b57888cb0d]
link UserProvider to SqlProvider--><g id="link_UserProvider_SqlProvider"><path codeLine="159" d="M3483,392.1 C3483,392.1 3483,563.66 3483,563.66 " fill="none" id="UserProvider-to-SqlProvider" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="3490,563.66,3483,583.66,3476,563.66,3490,563.66" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[2e2cd1f126b2a0e0fb6dd8bdb0da396b]
link User to UserBase--><g id="link_User_UserBase"><path codeLine="180" d="M1703.2,1104 C1620.03,1104 1505.25,1104 1505.25,1104 C1505.25,1104 1505.25,1160.74 1505.25,1160.74 " fill="none" id="User-to-UserBase" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="1512.25,1160.74,1505.25,1180.74,1498.25,1160.74,1512.25,1160.74" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[96a28894da16093fd8a9c441876c8015]
link UserCreate to UserBase--><g id="link_UserCreate_UserBase"><path codeLine="181" d="M1423.75,1086 C1423.75,1086 1423.75,1160.89 1423.75,1160.89 " fill="none" id="UserCreate-to-UserBase" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="1430.75,1160.89,1423.75,1180.89,1416.75,1160.89,1430.75,1160.89" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[64c091ef33e37a15c4a5aacf767b2a5f]
link DbUser to User--><g id="link_DbUser_User"><path codeLine="183" d="M1900.32,917 C1873.58,917 1852.25,917 1852.25,917 C1852.25,917 1852.25,964.6 1852.25,964.6 " fill="none" id="DbUser-to-User" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="1859.25,964.6,1852.25,984.6,1845.25,964.6,1859.25,964.6" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[1ccba3d51f842abcdb9cd9aad15aeadf]
@startuml API class diagram

top to bottom direction
skinparam linetype ortho
'Controllers'

class UserController{
    -_userManager{readonly} : IUserManager
    -_tokenManager : ITokenManager
    - -
    +UserController(userManager : IUserManager, tokenManager : ITokenManager)
    +CreateAsync(userCreate : UserCreate) : Task<ActionResult>
    +LoginAsync(userLogin : UserLogin) : Task<ActionResult<UserToken>>
    +GetUserFromTokenAsync() : Task<ActionResult<User>>
    +VerificationLoginAsync(verifyCredentials : VerifyCredentials) : Task<ActionResult<UserToken>>
    +VerifyUserRegisterAsync(verifyCredentials : VerifyCredentials) : Task<ActionResult>
    -GetUserLocation() : UserLocation
}

'Controllers mappings' 

UserController "1" o- - "1" IUserManager
UserController "1" o- - "1" ITokenManager

'Managers'

Interface IUserManager {
    +CreateUserAsync(userCreate : UserCreate) : Task<bool>
    +LoginAsync(userLogin : UserLogin, userLocation : UserLocation) : Task<User>
    +GetUserByIDAsync(id : int) : Task<User>
    +LoginWithVerificationCodeAsync(verifyCredentials : VerifyCredentials, userLocation : UserLocation) : Task<User>
    +VerifyUserRegistrationAsync(verifyCredentials : VerifyCredentials, userLocation: UserLocation) : Task<bool>
}

interface ITokenManager {
    +GenerateUserToken(user : User) : UserToken
    +ValidateToken(token : string) : bool
    +GetUserTokenFromToken(token : string) : UserToken
}


interface IUserLocationManager {
    +IsIPLockedAsync(ip : string) : Task<bool>
    +LogLocationAsync(userLocation : UserLocation) : Task<UserLocation>
    +UserWasLoggedInFromLocationAsync(userLocation : UserLocation) : Task<bool>
}

interface IMessageManager {
    +SendLoginAttemptMessageAsync(to : string, otp : string) : Task<bool>
    +SendLoginRegistrationMessageAsync(to : string, key : string) : Task<bool>
}

class TokenManager {
    - -
    -GetPrincipal(token : string) : ClaimsPrincipal
    -ClaimsIdentityToUserToken(identity : ClaimsPrincipal, token : string) : UserToken
}

class UserManager {
    -_userProvider : IUserProvider
    -_leakedPasswordProvider : ILeakedPasswordProvider;
    -_userLocationManager : IUserLocationManager
    -_messageManager : IMessageManager
    -_logger : ILogger<UserManager>
    -_configuration : IConfiguration
    - -
    +UserManager(configuration : IConfiguration, userProvider : IUserProvider, leakedPasswordProvider : ILeakedPasswordProvider, userLocationManager : IUserLocationManager,
     messageManager : IMessageManager, logger : ILogger<UserManager>)
    -IsVerificationCodeValid(verificationCode : string, user : DbUser) : bool
    -CheckPasswordLeakedForUserAsync(password : string) : Task<bool>
    -IsUserNotVerifiedAsync(userLocation : UserLocation, user : DbUser) : Task
    -IsUserLockedAsync(userLocation : UserLocation, user : DbUser) : Task
}

class UserLocationManager {
    -_userLocationProvider : IUserLocationProvider
    - -
    +UserLocationManager(userLocationProvider : IUserLocationProvider)
}

class MessageManager {
    -_messageService : IMessageService
    -_messageProvider : IMessageProvider
    - -
    +MessageManager(messageService : EmailMessageService, messageProvider : MailMessageProvider)
}


'Managers mappings'

IUserManager "1" - -> "1" UserCreate
IUserManager "1" - -> "1" UserLogin
IUserManager "1" - -> "1" VerifyCredentials
UserManager .-|> IUserManager
MessageManager .-|> IMessageManager

UserManager "1" o- - "1" IUserProvider
UserManager "1" o- - "1" IUserLocationManager
UserManager "1" o- - "1" ILeakedPasswordProvider
UserManager "1" o- - "1" IMessageManager

TokenManager .-|> ITokenManager
ITokenManager "1" *- - "1" UserToken


UserLocationManager .- -|> IUserLocationManager
UserLocationManager "1" o- - "1" IUserLocationProvider
'Providers'

interface IUserProvider {
    +CreateUserAsync(userCreate : DbUser) : Task<DbUser>
    +GetUserByEmailAsync(email : string) : Task<DbUser>
    +GetUserByIdAsync(id : int) : Task<DbUser>
    +UpdateUserFailedTriesAsync(userId : int) : Task<DbUser>
    +UpdateUserLoginSuccessAsync(userId : int) : Task<DbUser>
    +UpdateUserLoginNewLocationAsync(userId : int) : Task<DbUser>
    +UpdateUserToVerifiedAsync(userID : int) : Task
    +UpdateUserLoginSuccessWithVerificationCodeAsync(userId : int) : Task<DbUser>
}

interface ILeakedPasswordProvider {
    +GetIsPasswordLeakedAsync(password : string) : Task<bool>
}

class SqlProvider {
    - -
    +SqlProvider(connection : string)
    {abstract}#RunSpAsync(storedProcedureName : string, storedProcedureElements : SpElements[]) : Task<DataTable>
    {abstract}#RunQueryAsync(query : string) : Task<DataTable>
}

class LeakedPasswordProvider {
    - -
    +LeakedPasswordProvider(configuration : IConfiguration)
}

interface IUserLocationProvider{
    +IsIPLockedAsync(ip : string) : Task<bool>
    +LogLocationAsync(userLocation: UserLocation) : Task<UserLocation>
    +UserWasLoggedInFromLocationAsync(userLocation : UserLocation) : Task<bool>
}

class UserProvider {
    - -
    +UserProvider(configuration : IConfiguration)
    -DRToUser(dr : DataRow) : DbUser
}



'Providers mappings'

IUserProvider "1" *- - "1" DbUser
IUserLocationProvider "1" *- - "1" UserLocation  

LeakedPasswordProvider .-|> ILeakedPasswordProvider
LeakedPasswordProvider - -|> SqlProvider

UserProvider .-|> IUserProvider
UserProvider - -|> SqlProvider

'Utility'

class Security{
    - -
    {static}-ComputeHash(password : string) : string
    {static}-HashPassword(password : salt, salt : string) : string
    {static}+GetSalt(saltLength : int) : string
    {static}+GetEncryptedAndSaltedPassword(password : string, salt : string, pepper : string) : string
    {static}+GetHotp(key : string, counter : long) : string
    {static}+GetHmacKey() : string
}

class RegexHelper{
    - -
    {static}+TryToGetBrowserWithoutVersion(browser : string) : string
}

'Users mappings'

User - -|> UserBase
UserCreate - -|> UserBase

DbUser - -|> User

'User models' 

class UserToken{
    +UserID : int
    +Email : string
    +Token : string
}

class User{
    +ID : int 
    +IsVerified : bool
    +IsLocked : bool
    +FailedTries : int
    +LockedDate datetime?
}

class DbUser{
    +HashedPassword : string
    +Salt : string
    +SecretKey : string
    +Count : long
    +LastRequestDate : datetime?
}

class UserCreate {
    +Password : string
}

class UserBase{
    +Email : string
    +FirstName : string
    +LastName : string
    +PhoneNumber : string
}


class UserLogin{
    +Email : string
    +Password : string 
}

class VerifyCredentials {
    +Email : string
    +Password : string
}

class UserLocation{
    +ID : int
    +UserID : int
    +IP : string
    +UserAgent : string
    +Successful : bool
    +CreateDate : datetime
}


@enduml

@startuml API class diagram

top to bottom direction
skinparam linetype ortho

class UserController{
    -_userManager{readonly} : IUserManager
    -_tokenManager : ITokenManager
    - -
    +UserController(userManager : IUserManager, tokenManager : ITokenManager)
    +CreateAsync(userCreate : UserCreate) : Task<ActionResult>
    +LoginAsync(userLogin : UserLogin) : Task<ActionResult<UserToken>>
    +GetUserFromTokenAsync() : Task<ActionResult<User>>
    +VerificationLoginAsync(verifyCredentials : VerifyCredentials) : Task<ActionResult<UserToken>>
    +VerifyUserRegisterAsync(verifyCredentials : VerifyCredentials) : Task<ActionResult>
    -GetUserLocation() : UserLocation
}


UserController "1" o- - "1" IUserManager
UserController "1" o- - "1" ITokenManager


Interface IUserManager {
    +CreateUserAsync(userCreate : UserCreate) : Task<bool>
    +LoginAsync(userLogin : UserLogin, userLocation : UserLocation) : Task<User>
    +GetUserByIDAsync(id : int) : Task<User>
    +LoginWithVerificationCodeAsync(verifyCredentials : VerifyCredentials, userLocation : UserLocation) : Task<User>
    +VerifyUserRegistrationAsync(verifyCredentials : VerifyCredentials, userLocation: UserLocation) : Task<bool>
}

interface ITokenManager {
    +GenerateUserToken(user : User) : UserToken
    +ValidateToken(token : string) : bool
    +GetUserTokenFromToken(token : string) : UserToken
}


interface IUserLocationManager {
    +IsIPLockedAsync(ip : string) : Task<bool>
    +LogLocationAsync(userLocation : UserLocation) : Task<UserLocation>
    +UserWasLoggedInFromLocationAsync(userLocation : UserLocation) : Task<bool>
}

interface IMessageManager {
    +SendLoginAttemptMessageAsync(to : string, otp : string) : Task<bool>
    +SendLoginRegistrationMessageAsync(to : string, key : string) : Task<bool>
}

class TokenManager {
    - -
    -GetPrincipal(token : string) : ClaimsPrincipal
    -ClaimsIdentityToUserToken(identity : ClaimsPrincipal, token : string) : UserToken
}

class UserManager {
    -_userProvider : IUserProvider
    -_leakedPasswordProvider : ILeakedPasswordProvider;
    -_userLocationManager : IUserLocationManager
    -_messageManager : IMessageManager
    -_logger : ILogger<UserManager>
    -_configuration : IConfiguration
    - -
    +UserManager(configuration : IConfiguration, userProvider : IUserProvider, leakedPasswordProvider : ILeakedPasswordProvider, userLocationManager : IUserLocationManager,
     messageManager : IMessageManager, logger : ILogger<UserManager>)
    -IsVerificationCodeValid(verificationCode : string, user : DbUser) : bool
    -CheckPasswordLeakedForUserAsync(password : string) : Task<bool>
    -IsUserNotVerifiedAsync(userLocation : UserLocation, user : DbUser) : Task
    -IsUserLockedAsync(userLocation : UserLocation, user : DbUser) : Task
}

class UserLocationManager {
    -_userLocationProvider : IUserLocationProvider
    - -
    +UserLocationManager(userLocationProvider : IUserLocationProvider)
}

class MessageManager {
    -_messageService : IMessageService
    -_messageProvider : IMessageProvider
    - -
    +MessageManager(messageService : EmailMessageService, messageProvider : MailMessageProvider)
}



IUserManager "1" - -> "1" UserCreate
IUserManager "1" - -> "1" UserLogin
IUserManager "1" - -> "1" VerifyCredentials
UserManager .-|> IUserManager
MessageManager .-|> IMessageManager

UserManager "1" o- - "1" IUserProvider
UserManager "1" o- - "1" IUserLocationManager
UserManager "1" o- - "1" ILeakedPasswordProvider
UserManager "1" o- - "1" IMessageManager

TokenManager .-|> ITokenManager
ITokenManager "1" *- - "1" UserToken


UserLocationManager .- -|> IUserLocationManager
UserLocationManager "1" o- - "1" IUserLocationProvider

interface IUserProvider {
    +CreateUserAsync(userCreate : DbUser) : Task<DbUser>
    +GetUserByEmailAsync(email : string) : Task<DbUser>
    +GetUserByIdAsync(id : int) : Task<DbUser>
    +UpdateUserFailedTriesAsync(userId : int) : Task<DbUser>
    +UpdateUserLoginSuccessAsync(userId : int) : Task<DbUser>
    +UpdateUserLoginNewLocationAsync(userId : int) : Task<DbUser>
    +UpdateUserToVerifiedAsync(userID : int) : Task
    +UpdateUserLoginSuccessWithVerificationCodeAsync(userId : int) : Task<DbUser>
}

interface ILeakedPasswordProvider {
    +GetIsPasswordLeakedAsync(password : string) : Task<bool>
}

class SqlProvider {
    - -
    +SqlProvider(connection : string)
    {abstract}#RunSpAsync(storedProcedureName : string, storedProcedureElements : SpElements[]) : Task<DataTable>
    {abstract}#RunQueryAsync(query : string) : Task<DataTable>
}

class LeakedPasswordProvider {
    - -
    +LeakedPasswordProvider(configuration : IConfiguration)
}

interface IUserLocationProvider{
    +IsIPLockedAsync(ip : string) : Task<bool>
    +LogLocationAsync(userLocation: UserLocation) : Task<UserLocation>
    +UserWasLoggedInFromLocationAsync(userLocation : UserLocation) : Task<bool>
}

class UserProvider {
    - -
    +UserProvider(configuration : IConfiguration)
    -DRToUser(dr : DataRow) : DbUser
}




IUserProvider "1" *- - "1" DbUser
IUserLocationProvider "1" *- - "1" UserLocation  

LeakedPasswordProvider .-|> ILeakedPasswordProvider
LeakedPasswordProvider - -|> SqlProvider

UserProvider .-|> IUserProvider
UserProvider - -|> SqlProvider


class Security{
    - -
    {static}-ComputeHash(password : string) : string
    {static}-HashPassword(password : salt, salt : string) : string
    {static}+GetSalt(saltLength : int) : string
    {static}+GetEncryptedAndSaltedPassword(password : string, salt : string, pepper : string) : string
    {static}+GetHotp(key : string, counter : long) : string
    {static}+GetHmacKey() : string
}

class RegexHelper{
    - -
    {static}+TryToGetBrowserWithoutVersion(browser : string) : string
}


User - -|> UserBase
UserCreate - -|> UserBase

DbUser - -|> User


class UserToken{
    +UserID : int
    +Email : string
    +Token : string
}

class User{
    +ID : int 
    +IsVerified : bool
    +IsLocked : bool
    +FailedTries : int
    +LockedDate datetime?
}

class DbUser{
    +HashedPassword : string
    +Salt : string
    +SecretKey : string
    +Count : long
    +LastRequestDate : datetime?
}

class UserCreate {
    +Password : string
}

class UserBase{
    +Email : string
    +FirstName : string
    +LastName : string
    +PhoneNumber : string
}


class UserLogin{
    +Email : string
    +Password : string 
}

class VerifyCredentials {
    +Email : string
    +Password : string
}

class UserLocation{
    +ID : int
    +UserID : int
    +IP : string
    +UserAgent : string
    +Successful : bool
    +CreateDate : datetime
}


@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>
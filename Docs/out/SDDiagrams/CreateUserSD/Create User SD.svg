<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="856px" preserveAspectRatio="none" style="width:1089px;height:856px;background:#FFFFFF;" version="1.1" viewBox="0 0 1089 856" width="1089px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="516" x="10" y="221.0156"/><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="516" x="10" y="374.7734"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="37" x2="37" y1="82.6094" y2="774.3438"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="234" x2="234" y1="82.6094" y2="774.3438"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="466" x2="466" y1="82.6094" y2="774.3438"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="655.5" x2="655.5" y1="82.6094" y2="774.3438"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="800.5" x2="800.5" y1="82.6094" y2="774.3438"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="953.5" x2="953.5" y1="82.6094" y2="774.3438"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1050.5" x2="1050.5" y1="82.6094" y2="774.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="20" y="79.5332">User</text><ellipse cx="37.5" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M37.5,21.5 L37.5,48.5 M24.5,29.5 L50.5,29.5 M37.5,48.5 L24.5,63.5 M37.5,48.5 L50.5,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="20" y="787.877">User</text><ellipse cx="37.5" cy="799.4531" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M37.5,807.4531 L37.5,834.4531 M24.5,815.4531 L50.5,815.4531 M37.5,834.4531 L24.5,849.4531 M37.5,834.4531 L50.5,849.4531 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105" x="182" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="189" y="71.5332">UserController</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105" x="182" y="773.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="189" y="794.877">UserController</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99" x="417" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="424" y="71.5332">UserManager</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99" x="417" y="773.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="424" y="794.877">UserManager</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96" x="607.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="614.5" y="71.5332">UserProvider</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96" x="607.5" y="773.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="614.5" y="794.877">UserProvider</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="175" x="713.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="161" x="720.5" y="71.5332">LeakedPasswordProvider</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="175" x="713.5" y="773.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="161" x="720.5" y="794.877">LeakedPasswordProvider</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110" x="898.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="905.5" y="71.5332">TokenManager</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110" x="898.5" y="773.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="905.5" y="794.877">TokenManager</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65" x="1018.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="1025.5" y="71.5332">Security</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65" x="1018.5" y="773.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="1025.5" y="794.877">Security</text><polygon fill="#181818" points="222.5,110.9609,232.5,114.9609,222.5,118.9609,226.5,114.9609" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="37.5" x2="228.5" y1="114.9609" y2="114.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="44.5" y="110.1045">Create user (email, password)</text><polygon fill="#181818" points="454.5,141.3125,464.5,145.3125,454.5,149.3125,458.5,145.3125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="234.5" x2="460.5" y1="145.3125" y2="145.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="241.5" y="140.4561">Create user (email, password)</text><polygon fill="#181818" points="789,171.6641,799,175.6641,789,179.6641,793,175.6641" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="466.5" x2="795" y1="175.6641" y2="175.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="473.5" y="170.8076">Check is password leaked (password)</text><polygon fill="#181818" points="477.5,202.0156,467.5,206.0156,477.5,210.0156,473.5,206.0156" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="471.5" x2="800" y1="206.0156" y2="206.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="483.5" y="201.1592">return boolean</text><path d="M10,221.0156 L71,221.0156 L71,229.3672 L61,239.3672 L10,239.3672 L10,221.0156 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="516" x="10" y="221.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="235.5107">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="117" x="86" y="234.4346">[Password Is leaked]</text><polygon fill="#181818" points="245.5,257.7188,235.5,261.7188,245.5,265.7188,241.5,261.7188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="239.5" x2="465.5" y1="261.7188" y2="261.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="251.5" y="256.8623">Throw password leaked exception</text><polygon fill="#181818" points="48.5,288.0703,38.5,292.0703,48.5,296.0703,44.5,292.0703" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="42.5" x2="233.5" y1="292.0703" y2="292.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="54.5" y="287.2139">Return status forbidden</text><polygon fill="#181818" points="643.5,325.4219,653.5,329.4219,643.5,333.4219,647.5,329.4219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="466.5" x2="649.5" y1="329.4219" y2="329.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="473.5" y="324.5654">Get user by email(email)</text><polygon fill="#181818" points="477.5,355.7734,467.5,359.7734,477.5,363.7734,473.5,359.7734" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="471.5" x2="654.5" y1="359.7734" y2="359.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="69" x="483.5" y="354.917">Return User</text><path d="M10,374.7734 L71,374.7734 L71,383.125 L61,393.125 L10,393.125 L10,374.7734 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#000000;stroke-width:1.5;" width="516" x="10" y="374.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="389.2686">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="69" x="86" y="388.1924">[User found]</text><polygon fill="#181818" points="245.5,411.4766,235.5,415.4766,245.5,419.4766,241.5,415.4766" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="239.5" x2="465.5" y1="415.4766" y2="415.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="251.5" y="410.6201">Throw user already exists exception</text><polygon fill="#181818" points="48.5,441.8281,38.5,445.8281,48.5,449.8281,44.5,445.8281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="42.5" x2="233.5" y1="445.8281" y2="445.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="54.5" y="440.9717">return status conflict</text><polygon fill="#181818" points="1039,479.1797,1049,483.1797,1039,487.1797,1043,483.1797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="466.5" x2="1045" y1="483.1797" y2="483.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="473.5" y="478.3232">Get salt</text><polygon fill="#181818" points="477.5,509.5313,467.5,513.5313,477.5,517.5313,473.5,513.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="471.5" x2="1050" y1="513.5313" y2="513.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="483.5" y="508.6748">Return salt</text><polygon fill="#181818" points="1039,539.8828,1049,543.8828,1039,547.8828,1043,543.8828" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="466.5" x2="1045" y1="543.8828" y2="543.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="473.5" y="539.0264">Salt password (password, salt)</text><polygon fill="#181818" points="477.5,570.2344,467.5,574.2344,477.5,578.2344,473.5,574.2344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="471.5" x2="1050" y1="574.2344" y2="574.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="483.5" y="569.3779">Return salted password</text><polygon fill="#181818" points="643.5,600.5859,653.5,604.5859,643.5,608.5859,647.5,604.5859" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="466.5" x2="649.5" y1="604.5859" y2="604.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="473.5" y="599.7295">Save user in database (user)</text><polygon fill="#181818" points="477.5,630.9375,467.5,634.9375,477.5,638.9375,473.5,634.9375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="471.5" x2="654.5" y1="634.9375" y2="634.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="483.5" y="630.0811">Return saved user</text><polygon fill="#181818" points="245.5,661.2891,235.5,665.2891,245.5,669.2891,241.5,665.2891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="239.5" x2="465.5" y1="665.2891" y2="665.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="251.5" y="660.4326">Returns User</text><polygon fill="#181818" points="941.5,691.6406,951.5,695.6406,941.5,699.6406,945.5,695.6406" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="234.5" x2="947.5" y1="695.6406" y2="695.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="241.5" y="690.7842">Get token for user (User)</text><polygon fill="#181818" points="245.5,721.9922,235.5,725.9922,245.5,729.9922,241.5,725.9922" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="239.5" x2="952.5" y1="725.9922" y2="725.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="251.5" y="721.1357">Returns Token</text><polygon fill="#181818" points="48.5,752.3438,38.5,756.3438,48.5,760.3438,44.5,756.3438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="42.5" x2="233.5" y1="756.3438" y2="756.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="54.5" y="751.4873">Return token</text><!--MD5=[45cf651fb3fe30b10414bd1b13fb7820]
@startuml Create User SD


actor User
participant UserController
participant UserManager
participant UserProvider
participant LeakedPasswordProvider
participant TokenManager
participant Security

User->UserController: Create user (email, password)
UserController->UserManager: Create user (email, password)

UserManager->LeakedPasswordProvider: Check is password leaked (password)
LeakedPasswordProvider- ->UserManager: return boolean

alt Password Is leaked
UserManager- ->UserController: Throw password leaked exception
UserController- ->User: Return status forbidden
end

UserManager->UserProvider: Get user by email(email)
UserProvider- ->UserManager: Return User

alt User found

UserManager- ->UserController: Throw user already exists exception
UserController- ->User: return status conflict

end


UserManager->Security: Get salt
Security- ->UserManager: Return salt

UserManager->Security: Salt password (password, salt)
Security- ->UserManager: Return salted password

UserManager->UserProvider: Save user in database (user)
UserProvider- ->UserManager: Return saved user


UserManager- ->UserController: Returns User
UserController->TokenManager: Get token for user (User)
TokenManager- ->UserController: Returns Token

UserController- ->User: Return token

@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) Client VM
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>
<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1110px" preserveAspectRatio="none" style="width:5545px;height:1110px;background:#FFFFFF;" version="1.1" viewBox="0 0 5545 1110" width="5545px" zoomAndPan="magnify"><defs/><g><!--MD5=[29f97d496cbdc4ec81664c6d94dc9bf6]
class UserController--><g id="elem_UserController"><rect codeLine="6" fill="#F1F1F1" height="206.4844" id="UserController" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="628" x="670.5" y="33.5"/><ellipse cx="934.75" cy="49.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M937.5156,45.375 Q937.6719,45.1563 937.8594,45.0469 Q938.0469,44.9375 938.2656,44.9375 Q938.6406,44.9375 938.875,45.1953 Q939.1094,45.4531 939.1094,46.0625 L939.1094,47.5156 Q939.1094,48.125 938.875,48.3906 Q938.6406,48.6563 938.2656,48.6563 Q937.9219,48.6563 937.7188,48.4531 Q937.5156,48.2656 937.4063,47.75 Q937.3594,47.3906 937.1719,47.2031 Q936.8438,46.8281 936.2344,46.6094 Q935.625,46.3906 935,46.3906 Q934.2344,46.3906 933.6016,46.7188 Q932.9688,47.0469 932.4766,47.7969 Q931.9844,48.5469 931.9844,49.5781 L931.9844,50.6719 Q931.9844,51.9063 932.875,52.7266 Q933.7656,53.5469 935.3594,53.5469 Q936.2969,53.5469 936.9531,53.2969 Q937.3438,53.1406 937.7656,52.7031 Q938.0313,52.4375 938.1797,52.3594 Q938.3281,52.2813 938.5313,52.2813 Q938.8594,52.2813 939.1172,52.5391 Q939.375,52.7969 939.375,53.1406 Q939.375,53.4844 939.0313,53.8906 Q938.5313,54.4688 937.7344,54.7969 Q936.6563,55.25 935.3594,55.25 Q933.8438,55.25 932.6406,54.625 Q931.6563,54.125 930.9688,53.0547 Q930.2813,51.9844 930.2813,50.7031 L930.2813,49.5469 Q930.2813,48.2188 930.8984,47.0703 Q931.5156,45.9219 932.6094,45.3047 Q933.7031,44.6875 934.9375,44.6875 Q935.6719,44.6875 936.3203,44.8516 Q936.9688,45.0156 937.5156,45.375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="955.25" y="55.2285">UserController</text><line style="stroke:#181818;stroke-width:0.5;" x1="671.5" x2="1297.5" y1="65.5" y2="65.5"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="678.5" y="76.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="257" x="690.5" y="84.0332">_userManager{readonly} : IUserManager</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="678.5" y="94.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="210" x="690.5" y="101.6426">_tokenManager : ITokenManager</text><line style="stroke:#181818;stroke-width:1.0;" x1="671.5" x2="1297.5" y1="108.7188" y2="108.7188"/><ellipse cx="681.5" cy="123.0234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="495" x="690.5" y="127.252">UserController(userManager : IUserManager, tokenManager : ITokenManager)</text><ellipse cx="681.5" cy="140.6328" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="384" x="690.5" y="144.8613">CreateAsync(userCreate : UserCreate) : Task&lt;ActionResult&gt;</text><ellipse cx="681.5" cy="158.2422" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="445" x="690.5" y="162.4707">LoginAsync(userLogin : UserLogin) : Task&lt;ActionResult&lt;UserToken&gt;&gt;</text><ellipse cx="681.5" cy="175.8516" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="356" x="690.5" y="180.0801">GetUserFromTokenAsync() : Task&lt;ActionResult&lt;User&gt;&gt;</text><ellipse cx="681.5" cy="193.4609" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="602" x="690.5" y="197.6895">VerificationLoginAsync(verifyCredentials : VerifyCredentials) : Task&lt;ActionResult&lt;UserToken&gt;&gt;</text><ellipse cx="681.5" cy="211.0703" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="530" x="690.5" y="215.2988">VerifyUserRegisterAsync(verifyCredentials : VerifyCredentials) : Task&lt;ActionResult&gt;</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="678.5" y="225.6797"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="211" x="690.5" y="232.9082">GetUserLocation() : UserLocation</text></g><!--MD5=[56ab46cd423624563d94b9f2eeeea516]
class IUserManager--><g id="elem_IUserManager"><rect codeLine="26" fill="#F1F1F1" height="136.0469" id="IUserManager" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="740" x="1065.5" y="352.5"/><ellipse cx="1385.75" cy="368.5" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1386.7031,365.1406 L1386.7031,371.7969 L1388.4219,371.7969 Q1389.0313,371.7969 1389.2969,372.0313 Q1389.5625,372.2656 1389.5625,372.6563 Q1389.5625,373.0313 1389.2969,373.2656 Q1389.0313,373.5 1388.4219,373.5 L1383.2813,373.5 Q1382.6719,373.5 1382.4063,373.2656 Q1382.1406,373.0313 1382.1406,372.6406 Q1382.1406,372.2656 1382.4063,372.0313 Q1382.6719,371.7969 1383.2813,371.7969 L1385,371.7969 L1385,365.1406 L1383.2813,365.1406 Q1382.6719,365.1406 1382.4063,364.9063 Q1382.1406,364.6719 1382.1406,364.2813 Q1382.1406,363.9063 1382.4063,363.6719 Q1382.6719,363.4375 1383.2813,363.4375 L1388.4219,363.4375 Q1389.0313,363.4375 1389.2969,363.6719 Q1389.5625,363.9063 1389.5625,364.2813 Q1389.5625,364.6719 1389.2969,364.9063 Q1389.0313,365.1406 1388.4219,365.1406 L1386.7031,365.1406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="91" x="1406.25" y="374.2285">IUserManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="1066.5" x2="1804.5" y1="384.5" y2="384.5"/><line style="stroke:#181818;stroke-width:0.5;" x1="1066.5" x2="1804.5" y1="392.5" y2="392.5"/><ellipse cx="1076.5" cy="406.8047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="361" x="1085.5" y="411.0332">CreateUserAsync(userCreate : UserCreate) : Task&lt;bool&gt;</text><ellipse cx="1076.5" cy="424.4141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="495" x="1085.5" y="428.6426">LoginAsync(userLogin : UserLogin, userLocation : UserLocation) : Task&lt;User&gt;</text><ellipse cx="1076.5" cy="442.0234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="255" x="1085.5" y="446.252">GetUserByIDAsync(id : int) : Task&lt;User&gt;</text><ellipse cx="1076.5" cy="459.6328" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="714" x="1085.5" y="463.8613">LoginWithVerificationCodeAsync(verifyCredentials : VerifyCredentials, userLocation : UserLocation) : Task&lt;User&gt;</text><ellipse cx="1076.5" cy="477.2422" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="682" x="1085.5" y="481.4707">VerifyUserRegistrationAsync(verifyCredentials : VerifyCredentials, userLocation: UserLocation) : Task&lt;bool&gt;</text></g><!--MD5=[1258d900524f45f247dd7f1e09584eb4]
class ITokenManager--><g id="elem_ITokenManager"><rect codeLine="34" fill="#F1F1F1" height="100.8281" id="ITokenManager" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="364" x="91.5" y="370"/><ellipse cx="218.25" cy="386" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M219.2031,382.6406 L219.2031,389.2969 L220.9219,389.2969 Q221.5313,389.2969 221.7969,389.5313 Q222.0625,389.7656 222.0625,390.1563 Q222.0625,390.5313 221.7969,390.7656 Q221.5313,391 220.9219,391 L215.7813,391 Q215.1719,391 214.9063,390.7656 Q214.6406,390.5313 214.6406,390.1406 Q214.6406,389.7656 214.9063,389.5313 Q215.1719,389.2969 215.7813,389.2969 L217.5,389.2969 L217.5,382.6406 L215.7813,382.6406 Q215.1719,382.6406 214.9063,382.4063 Q214.6406,382.1719 214.6406,381.7813 Q214.6406,381.4063 214.9063,381.1719 Q215.1719,380.9375 215.7813,380.9375 L220.9219,380.9375 Q221.5313,380.9375 221.7969,381.1719 Q222.0625,381.4063 222.0625,381.7813 Q222.0625,382.1719 221.7969,382.4063 Q221.5313,382.6406 220.9219,382.6406 L219.2031,382.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="102" x="238.75" y="391.7285">ITokenManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="92.5" x2="454.5" y1="402" y2="402"/><line style="stroke:#181818;stroke-width:0.5;" x1="92.5" x2="454.5" y1="410" y2="410"/><ellipse cx="102.5" cy="424.3047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="289" x="111.5" y="428.5332">GenerateUserToken(user : User) : UserToken</text><ellipse cx="102.5" cy="441.9141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="222" x="111.5" y="446.1426">ValidateToken(token : string) : bool</text><ellipse cx="102.5" cy="459.5234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="338" x="111.5" y="463.752">GetUserTokenFromToken(token : string) : UserToken</text></g><!--MD5=[d00c2197046b95564bb4dabcd5edfb06]
class IUserLocationManager--><g id="elem_IUserLocationManager"><rect codeLine="41" fill="#F1F1F1" height="100.8281" id="IUserLocationManager" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="540" x="1840.5" y="370"/><ellipse cx="2033.75" cy="386" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M2034.7031,382.6406 L2034.7031,389.2969 L2036.4219,389.2969 Q2037.0313,389.2969 2037.2969,389.5313 Q2037.5625,389.7656 2037.5625,390.1563 Q2037.5625,390.5313 2037.2969,390.7656 Q2037.0313,391 2036.4219,391 L2031.2813,391 Q2030.6719,391 2030.4063,390.7656 Q2030.1406,390.5313 2030.1406,390.1406 Q2030.1406,389.7656 2030.4063,389.5313 Q2030.6719,389.2969 2031.2813,389.2969 L2033,389.2969 L2033,382.6406 L2031.2813,382.6406 Q2030.6719,382.6406 2030.4063,382.4063 Q2030.1406,382.1719 2030.1406,381.7813 Q2030.1406,381.4063 2030.4063,381.1719 Q2030.6719,380.9375 2031.2813,380.9375 L2036.4219,380.9375 Q2037.0313,380.9375 2037.2969,381.1719 Q2037.5625,381.4063 2037.5625,381.7813 Q2037.5625,382.1719 2037.2969,382.4063 Q2037.0313,382.6406 2036.4219,382.6406 L2034.7031,382.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="145" x="2054.25" y="391.7285">IUserLocationManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="1841.5" x2="2379.5" y1="402" y2="402"/><line style="stroke:#181818;stroke-width:0.5;" x1="1841.5" x2="2379.5" y1="410" y2="410"/><ellipse cx="1851.5" cy="424.3047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="260" x="1860.5" y="428.5332">IsIPLockedAsync(ip : string) : Task&lt;bool&gt;</text><ellipse cx="1851.5" cy="441.9141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="445" x="1860.5" y="446.1426">LogLocationAsync(userLocation : UserLocation) : Task&lt;UserLocation&gt;</text><ellipse cx="1851.5" cy="459.5234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="514" x="1860.5" y="463.752">UserWasLoggedInFromLocationAsync(userLocation : UserLocation) : Task&lt;bool&gt;</text></g><!--MD5=[5bbb8fec178e848d13dc3ca00e0fbd40]
class IMessageManager--><g id="elem_IMessageManager"><rect codeLine="47" fill="#F1F1F1" height="83.2188" id="IMessageManager" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="497" x="2416" y="379"/><ellipse cx="2600.75" cy="395" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M2601.7031,391.6406 L2601.7031,398.2969 L2603.4219,398.2969 Q2604.0313,398.2969 2604.2969,398.5313 Q2604.5625,398.7656 2604.5625,399.1563 Q2604.5625,399.5313 2604.2969,399.7656 Q2604.0313,400 2603.4219,400 L2598.2813,400 Q2597.6719,400 2597.4063,399.7656 Q2597.1406,399.5313 2597.1406,399.1406 Q2597.1406,398.7656 2597.4063,398.5313 Q2597.6719,398.2969 2598.2813,398.2969 L2600,398.2969 L2600,391.6406 L2598.2813,391.6406 Q2597.6719,391.6406 2597.4063,391.4063 Q2597.1406,391.1719 2597.1406,390.7813 Q2597.1406,390.4063 2597.4063,390.1719 Q2597.6719,389.9375 2598.2813,389.9375 L2603.4219,389.9375 Q2604.0313,389.9375 2604.2969,390.1719 Q2604.5625,390.4063 2604.5625,390.7813 Q2604.5625,391.1719 2604.2969,391.4063 Q2604.0313,391.6406 2603.4219,391.6406 L2601.7031,391.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="119" x="2621.25" y="400.7285">IMessageManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="2417" x2="2912" y1="411" y2="411"/><line style="stroke:#181818;stroke-width:0.5;" x1="2417" x2="2912" y1="419" y2="419"/><ellipse cx="2427" cy="433.3047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="441" x="2436" y="437.5332">SendLoginAttemptMessageAsync(to : string, otp : string) : Task&lt;bool&gt;</text><ellipse cx="2427" cy="450.9141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="471" x="2436" y="455.1426">SendLoginRegistrationMessageAsync(to : string, key : string) : Task&lt;bool&gt;</text></g><!--MD5=[6c06fb0cd17dfe24a13aaf4bb7e771c8]
class TokenManager--><g id="elem_TokenManager"><rect codeLine="52" fill="#F1F1F1" height="83.2188" id="TokenManager" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="533" x="7" y="95"/><ellipse cx="221.25" cy="111" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M224.0156,106.875 Q224.1719,106.6563 224.3594,106.5469 Q224.5469,106.4375 224.7656,106.4375 Q225.1406,106.4375 225.375,106.6953 Q225.6094,106.9531 225.6094,107.5625 L225.6094,109.0156 Q225.6094,109.625 225.375,109.8906 Q225.1406,110.1563 224.7656,110.1563 Q224.4219,110.1563 224.2188,109.9531 Q224.0156,109.7656 223.9063,109.25 Q223.8594,108.8906 223.6719,108.7031 Q223.3438,108.3281 222.7344,108.1094 Q222.125,107.8906 221.5,107.8906 Q220.7344,107.8906 220.1016,108.2188 Q219.4688,108.5469 218.9766,109.2969 Q218.4844,110.0469 218.4844,111.0781 L218.4844,112.1719 Q218.4844,113.4063 219.375,114.2266 Q220.2656,115.0469 221.8594,115.0469 Q222.7969,115.0469 223.4531,114.7969 Q223.8438,114.6406 224.2656,114.2031 Q224.5313,113.9375 224.6797,113.8594 Q224.8281,113.7813 225.0313,113.7813 Q225.3594,113.7813 225.6172,114.0391 Q225.875,114.2969 225.875,114.6406 Q225.875,114.9844 225.5313,115.3906 Q225.0313,115.9688 224.2344,116.2969 Q223.1563,116.75 221.8594,116.75 Q220.3438,116.75 219.1406,116.125 Q218.1563,115.625 217.4688,114.5547 Q216.7813,113.4844 216.7813,112.2031 L216.7813,111.0469 Q216.7813,109.7188 217.3984,108.5703 Q218.0156,107.4219 219.1094,106.8047 Q220.2031,106.1875 221.4375,106.1875 Q222.1719,106.1875 222.8203,106.3516 Q223.4688,106.5156 224.0156,106.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="241.75" y="116.7285">TokenManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="539" y1="127" y2="127"/><line style="stroke:#181818;stroke-width:1.0;" x1="8" x2="539" y1="135" y2="135"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="15" y="146.3047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="277" x="27" y="153.5332">GetPrincipal(token : string) : ClaimsPrincipal</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="15" y="163.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="507" x="27" y="171.1426">ClaimsIdentityToUserToken(identity : ClaimsPrincipal, token : string) : UserToken</text></g><!--MD5=[24add822970012a00cd97a40cd79feff]
class UserManager--><g id="elem_UserManager"><rect codeLine="58" fill="#F1F1F1" height="259.3125" id="UserManager" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="1128" x="2604.5" y="7"/><ellipse cx="3121.75" cy="23" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M3124.5156,18.875 Q3124.6719,18.6563 3124.8594,18.5469 Q3125.0469,18.4375 3125.2656,18.4375 Q3125.6406,18.4375 3125.875,18.6953 Q3126.1094,18.9531 3126.1094,19.5625 L3126.1094,21.0156 Q3126.1094,21.625 3125.875,21.8906 Q3125.6406,22.1563 3125.2656,22.1563 Q3124.9219,22.1563 3124.7188,21.9531 Q3124.5156,21.7656 3124.4063,21.25 Q3124.3594,20.8906 3124.1719,20.7031 Q3123.8438,20.3281 3123.2344,20.1094 Q3122.625,19.8906 3122,19.8906 Q3121.2344,19.8906 3120.6016,20.2188 Q3119.9688,20.5469 3119.4766,21.2969 Q3118.9844,22.0469 3118.9844,23.0781 L3118.9844,24.1719 Q3118.9844,25.4063 3119.875,26.2266 Q3120.7656,27.0469 3122.3594,27.0469 Q3123.2969,27.0469 3123.9531,26.7969 Q3124.3438,26.6406 3124.7656,26.2031 Q3125.0313,25.9375 3125.1797,25.8594 Q3125.3281,25.7813 3125.5313,25.7813 Q3125.8594,25.7813 3126.1172,26.0391 Q3126.375,26.2969 3126.375,26.6406 Q3126.375,26.9844 3126.0313,27.3906 Q3125.5313,27.9688 3124.7344,28.2969 Q3123.6563,28.75 3122.3594,28.75 Q3120.8438,28.75 3119.6406,28.125 Q3118.6563,27.625 3117.9688,26.5547 Q3117.2813,25.4844 3117.2813,24.2031 L3117.2813,23.0469 Q3117.2813,21.7188 3117.8984,20.5703 Q3118.5156,19.4219 3119.6094,18.8047 Q3120.7031,18.1875 3121.9375,18.1875 Q3122.6719,18.1875 3123.3203,18.3516 Q3123.9688,18.5156 3124.5156,18.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="3142.25" y="28.7285">UserManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="2605.5" x2="3731.5" y1="39" y2="39"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="2612.5" y="50.3047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="186" x="2624.5" y="57.5332">_userProvider : IUserProvider</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="2612.5" y="67.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="344" x="2624.5" y="75.1426">_leakedPasswordProvider : ILeakedPasswordProvider;</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="2612.5" y="85.5234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="300" x="2624.5" y="92.752">_userLocationManager : IUserLocationManager</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="2612.5" y="103.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="249" x="2624.5" y="110.3613">_messageManager : IMessageManager</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="2612.5" y="120.7422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="209" x="2624.5" y="127.9707">_logger : ILogger&lt;UserManager&gt;</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="2612.5" y="138.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="190" x="2624.5" y="145.5801">_configuration : IConfiguration</text><line style="stroke:#181818;stroke-width:1.0;" x1="2605.5" x2="3731.5" y1="152.6563" y2="152.6563"/><ellipse cx="2615.5" cy="166.9609" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="1102" x="2624.5" y="171.1895">UserManager(configuration : IConfiguration, userProvider : IUserProvider, leakedPasswordProvider : ILeakedPasswordProvider, userLocationManager : IUserLocationManager,</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="455" x="2624.5" y="188.7988">messageManager : IMessageManager, logger : ILogger&lt;UserManager&gt;)</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="2612.5" y="199.1797"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="438" x="2624.5" y="206.4082">IsVerificationCodeValid(verificationCode : string, user : DbUser) : bool</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="2612.5" y="216.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="440" x="2624.5" y="224.0176">CheckPasswordLeakedForUserAsync(password : string) : Task&lt;bool&gt;</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="2612.5" y="234.3984"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="471" x="2624.5" y="241.627">IsUserNotVerifiedAsync(userLocation : UserLocation, user : DbUser) : Task</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="2612.5" y="252.0078"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="448" x="2624.5" y="259.2363">IsUserLockedAsync(userLocation : UserLocation, user : DbUser) : Task</text></g><!--MD5=[f73269fd56b24b10ecd9be8e99f9cb1e]
class UserLocationManager--><g id="elem_UserLocationManager"><rect codeLine="74" fill="#F1F1F1" height="83.2188" id="UserLocationManager" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="461" x="1381" y="95"/><ellipse cx="1537.75" cy="111" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1540.5156,106.875 Q1540.6719,106.6563 1540.8594,106.5469 Q1541.0469,106.4375 1541.2656,106.4375 Q1541.6406,106.4375 1541.875,106.6953 Q1542.1094,106.9531 1542.1094,107.5625 L1542.1094,109.0156 Q1542.1094,109.625 1541.875,109.8906 Q1541.6406,110.1563 1541.2656,110.1563 Q1540.9219,110.1563 1540.7188,109.9531 Q1540.5156,109.7656 1540.4063,109.25 Q1540.3594,108.8906 1540.1719,108.7031 Q1539.8438,108.3281 1539.2344,108.1094 Q1538.625,107.8906 1538,107.8906 Q1537.2344,107.8906 1536.6016,108.2188 Q1535.9688,108.5469 1535.4766,109.2969 Q1534.9844,110.0469 1534.9844,111.0781 L1534.9844,112.1719 Q1534.9844,113.4063 1535.875,114.2266 Q1536.7656,115.0469 1538.3594,115.0469 Q1539.2969,115.0469 1539.9531,114.7969 Q1540.3438,114.6406 1540.7656,114.2031 Q1541.0313,113.9375 1541.1797,113.8594 Q1541.3281,113.7813 1541.5313,113.7813 Q1541.8594,113.7813 1542.1172,114.0391 Q1542.375,114.2969 1542.375,114.6406 Q1542.375,114.9844 1542.0313,115.3906 Q1541.5313,115.9688 1540.7344,116.2969 Q1539.6563,116.75 1538.3594,116.75 Q1536.8438,116.75 1535.6406,116.125 Q1534.6563,115.625 1533.9688,114.5547 Q1533.2813,113.4844 1533.2813,112.2031 L1533.2813,111.0469 Q1533.2813,109.7188 1533.8984,108.5703 Q1534.5156,107.4219 1535.6094,106.8047 Q1536.7031,106.1875 1537.9375,106.1875 Q1538.6719,106.1875 1539.3203,106.3516 Q1539.9688,106.5156 1540.5156,106.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="1558.25" y="116.7285">UserLocationManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="1382" x2="1841" y1="127" y2="127"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1389" y="138.3047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="294" x="1401" y="145.5332">_userLocationProvider : IUserLocationProvider</text><line style="stroke:#181818;stroke-width:1.0;" x1="1382" x2="1841" y1="152.6094" y2="152.6094"/><ellipse cx="1392" cy="166.9141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="435" x="1401" y="171.1426">UserLocationManager(userLocationProvider : IUserLocationProvider)</text></g><!--MD5=[20fcb2fa68efbd583f0fa2981cab489f]
class MessageManager--><g id="elem_MessageManager"><rect codeLine="80" fill="#F1F1F1" height="100.8281" id="MessageManager" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="668" x="1901.5" y="86"/><ellipse cx="2174.75" cy="102" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M2177.5156,97.875 Q2177.6719,97.6563 2177.8594,97.5469 Q2178.0469,97.4375 2178.2656,97.4375 Q2178.6406,97.4375 2178.875,97.6953 Q2179.1094,97.9531 2179.1094,98.5625 L2179.1094,100.0156 Q2179.1094,100.625 2178.875,100.8906 Q2178.6406,101.1563 2178.2656,101.1563 Q2177.9219,101.1563 2177.7188,100.9531 Q2177.5156,100.7656 2177.4063,100.25 Q2177.3594,99.8906 2177.1719,99.7031 Q2176.8438,99.3281 2176.2344,99.1094 Q2175.625,98.8906 2175,98.8906 Q2174.2344,98.8906 2173.6016,99.2188 Q2172.9688,99.5469 2172.4766,100.2969 Q2171.9844,101.0469 2171.9844,102.0781 L2171.9844,103.1719 Q2171.9844,104.4063 2172.875,105.2266 Q2173.7656,106.0469 2175.3594,106.0469 Q2176.2969,106.0469 2176.9531,105.7969 Q2177.3438,105.6406 2177.7656,105.2031 Q2178.0313,104.9375 2178.1797,104.8594 Q2178.3281,104.7813 2178.5313,104.7813 Q2178.8594,104.7813 2179.1172,105.0391 Q2179.375,105.2969 2179.375,105.6406 Q2179.375,105.9844 2179.0313,106.3906 Q2178.5313,106.9688 2177.7344,107.2969 Q2176.6563,107.75 2175.3594,107.75 Q2173.8438,107.75 2172.6406,107.125 Q2171.6563,106.625 2170.9688,105.5547 Q2170.2813,104.4844 2170.2813,103.2031 L2170.2813,102.0469 Q2170.2813,100.7188 2170.8984,99.5703 Q2171.5156,98.4219 2172.6094,97.8047 Q2173.7031,97.1875 2174.9375,97.1875 Q2175.6719,97.1875 2176.3203,97.3516 Q2176.9688,97.5156 2177.5156,97.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="2195.25" y="107.7285">MessageManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="1902.5" x2="2568.5" y1="118" y2="118"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1909.5" y="129.3047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="231" x="1921.5" y="136.5332">_messageService : IMessageService</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1909.5" y="146.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="243" x="1921.5" y="154.1426">_messageProvider : IMessageProvider</text><line style="stroke:#181818;stroke-width:1.0;" x1="1902.5" x2="2568.5" y1="161.2188" y2="161.2188"/><ellipse cx="1912.5" cy="175.5234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="642" x="1921.5" y="179.752">MessageManager(messageService : EmailMessageService, messageProvider : MailMessageProvider)</text></g><!--MD5=[177726c6dccf199602c5c27bb05f2a1e]
class UserCreate--><g id="elem_UserCreate"><rect codeLine="209" fill="#F1F1F1" height="65.6094" id="UserCreate" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="1816.5" y="824"/><ellipse cx="1845" cy="840" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1847.7656,835.875 Q1847.9219,835.6563 1848.1094,835.5469 Q1848.2969,835.4375 1848.5156,835.4375 Q1848.8906,835.4375 1849.125,835.6953 Q1849.3594,835.9531 1849.3594,836.5625 L1849.3594,838.0156 Q1849.3594,838.625 1849.125,838.8906 Q1848.8906,839.1563 1848.5156,839.1563 Q1848.1719,839.1563 1847.9688,838.9531 Q1847.7656,838.7656 1847.6563,838.25 Q1847.6094,837.8906 1847.4219,837.7031 Q1847.0938,837.3281 1846.4844,837.1094 Q1845.875,836.8906 1845.25,836.8906 Q1844.4844,836.8906 1843.8516,837.2188 Q1843.2188,837.5469 1842.7266,838.2969 Q1842.2344,839.0469 1842.2344,840.0781 L1842.2344,841.1719 Q1842.2344,842.4063 1843.125,843.2266 Q1844.0156,844.0469 1845.6094,844.0469 Q1846.5469,844.0469 1847.2031,843.7969 Q1847.5938,843.6406 1848.0156,843.2031 Q1848.2813,842.9375 1848.4297,842.8594 Q1848.5781,842.7813 1848.7813,842.7813 Q1849.1094,842.7813 1849.3672,843.0391 Q1849.625,843.2969 1849.625,843.6406 Q1849.625,843.9844 1849.2813,844.3906 Q1848.7813,844.9688 1847.9844,845.2969 Q1846.9063,845.75 1845.6094,845.75 Q1844.0938,845.75 1842.8906,845.125 Q1841.9063,844.625 1841.2188,843.5547 Q1840.5313,842.4844 1840.5313,841.2031 L1840.5313,840.0469 Q1840.5313,838.7188 1841.1484,837.5703 Q1841.7656,836.4219 1842.8594,835.8047 Q1843.9531,835.1875 1845.1875,835.1875 Q1845.9219,835.1875 1846.5703,835.3516 Q1847.2188,835.5156 1847.7656,835.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72" x="1862" y="845.7285">UserCreate</text><line style="stroke:#181818;stroke-width:0.5;" x1="1817.5" x2="1949.5" y1="856" y2="856"/><ellipse cx="1827.5" cy="870.3047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="1836.5" y="874.5332">Password : string</text><line style="stroke:#181818;stroke-width:0.5;" x1="1817.5" x2="1949.5" y1="881.6094" y2="881.6094"/></g><!--MD5=[f8bd6c2ec23e906322bbeaf68b53bb4f]
class UserLogin--><g id="elem_UserLogin"><rect codeLine="221" fill="#F1F1F1" height="83.2188" id="UserLogin" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="1428.5" y="610.5"/><ellipse cx="1460.6" cy="626.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1463.3656,622.375 Q1463.5219,622.1563 1463.7094,622.0469 Q1463.8969,621.9375 1464.1156,621.9375 Q1464.4906,621.9375 1464.725,622.1953 Q1464.9594,622.4531 1464.9594,623.0625 L1464.9594,624.5156 Q1464.9594,625.125 1464.725,625.3906 Q1464.4906,625.6563 1464.1156,625.6563 Q1463.7719,625.6563 1463.5688,625.4531 Q1463.3656,625.2656 1463.2563,624.75 Q1463.2094,624.3906 1463.0219,624.2031 Q1462.6938,623.8281 1462.0844,623.6094 Q1461.475,623.3906 1460.85,623.3906 Q1460.0844,623.3906 1459.4516,623.7188 Q1458.8188,624.0469 1458.3266,624.7969 Q1457.8344,625.5469 1457.8344,626.5781 L1457.8344,627.6719 Q1457.8344,628.9063 1458.725,629.7266 Q1459.6156,630.5469 1461.2094,630.5469 Q1462.1469,630.5469 1462.8031,630.2969 Q1463.1938,630.1406 1463.6156,629.7031 Q1463.8813,629.4375 1464.0297,629.3594 Q1464.1781,629.2813 1464.3813,629.2813 Q1464.7094,629.2813 1464.9672,629.5391 Q1465.225,629.7969 1465.225,630.1406 Q1465.225,630.4844 1464.8813,630.8906 Q1464.3813,631.4688 1463.5844,631.7969 Q1462.5063,632.25 1461.2094,632.25 Q1459.6938,632.25 1458.4906,631.625 Q1457.5063,631.125 1456.8188,630.0547 Q1456.1313,628.9844 1456.1313,627.7031 L1456.1313,626.5469 Q1456.1313,625.2188 1456.7484,624.0703 Q1457.3656,622.9219 1458.4594,622.3047 Q1459.5531,621.6875 1460.7875,621.6875 Q1461.5219,621.6875 1462.1703,621.8516 Q1462.8188,622.0156 1463.3656,622.375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="1478.4" y="632.2285">UserLogin</text><line style="stroke:#181818;stroke-width:0.5;" x1="1429.5" x2="1561.5" y1="642.5" y2="642.5"/><ellipse cx="1439.5" cy="656.8047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="1448.5" y="661.0332">Email : string</text><ellipse cx="1439.5" cy="674.4141" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="1448.5" y="678.6426">Password : string</text><line style="stroke:#181818;stroke-width:0.5;" x1="1429.5" x2="1561.5" y1="685.7188" y2="685.7188"/></g><!--MD5=[7e38db3769ab3d4a7934dc4e6ba3ae24]
class VerifyCredentials--><g id="elem_VerifyCredentials"><rect codeLine="226" fill="#F1F1F1" height="83.2188" id="VerifyCredentials" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="140" x="1597.5" y="610.5"/><ellipse cx="1612.5" cy="626.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1615.2656,622.375 Q1615.4219,622.1563 1615.6094,622.0469 Q1615.7969,621.9375 1616.0156,621.9375 Q1616.3906,621.9375 1616.625,622.1953 Q1616.8594,622.4531 1616.8594,623.0625 L1616.8594,624.5156 Q1616.8594,625.125 1616.625,625.3906 Q1616.3906,625.6563 1616.0156,625.6563 Q1615.6719,625.6563 1615.4688,625.4531 Q1615.2656,625.2656 1615.1563,624.75 Q1615.1094,624.3906 1614.9219,624.2031 Q1614.5938,623.8281 1613.9844,623.6094 Q1613.375,623.3906 1612.75,623.3906 Q1611.9844,623.3906 1611.3516,623.7188 Q1610.7188,624.0469 1610.2266,624.7969 Q1609.7344,625.5469 1609.7344,626.5781 L1609.7344,627.6719 Q1609.7344,628.9063 1610.625,629.7266 Q1611.5156,630.5469 1613.1094,630.5469 Q1614.0469,630.5469 1614.7031,630.2969 Q1615.0938,630.1406 1615.5156,629.7031 Q1615.7813,629.4375 1615.9297,629.3594 Q1616.0781,629.2813 1616.2813,629.2813 Q1616.6094,629.2813 1616.8672,629.5391 Q1617.125,629.7969 1617.125,630.1406 Q1617.125,630.4844 1616.7813,630.8906 Q1616.2813,631.4688 1615.4844,631.7969 Q1614.4063,632.25 1613.1094,632.25 Q1611.5938,632.25 1610.3906,631.625 Q1609.4063,631.125 1608.7188,630.0547 Q1608.0313,628.9844 1608.0313,627.7031 L1608.0313,626.5469 Q1608.0313,625.2188 1608.6484,624.0703 Q1609.2656,622.9219 1610.3594,622.3047 Q1611.4531,621.6875 1612.6875,621.6875 Q1613.4219,621.6875 1614.0703,621.8516 Q1614.7188,622.0156 1615.2656,622.375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="1626.5" y="632.2285">VerifyCredentials</text><line style="stroke:#181818;stroke-width:0.5;" x1="1598.5" x2="1736.5" y1="642.5" y2="642.5"/><ellipse cx="1608.5" cy="656.8047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="1617.5" y="661.0332">Email : string</text><ellipse cx="1608.5" cy="674.4141" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="1617.5" y="678.6426">Password : string</text><line style="stroke:#181818;stroke-width:0.5;" x1="1598.5" x2="1736.5" y1="685.7188" y2="685.7188"/></g><!--MD5=[6ac818b5870897fde505b1069c30005c]
class IUserProvider--><g id="elem_IUserProvider"><rect codeLine="109" fill="#F1F1F1" height="188.875" id="IUserProvider" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="540" x="2948.5" y="326"/><ellipse cx="3171.25" cy="342" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M3172.2031,338.6406 L3172.2031,345.2969 L3173.9219,345.2969 Q3174.5313,345.2969 3174.7969,345.5313 Q3175.0625,345.7656 3175.0625,346.1563 Q3175.0625,346.5313 3174.7969,346.7656 Q3174.5313,347 3173.9219,347 L3168.7813,347 Q3168.1719,347 3167.9063,346.7656 Q3167.6406,346.5313 3167.6406,346.1406 Q3167.6406,345.7656 3167.9063,345.5313 Q3168.1719,345.2969 3168.7813,345.2969 L3170.5,345.2969 L3170.5,338.6406 L3168.7813,338.6406 Q3168.1719,338.6406 3167.9063,338.4063 Q3167.6406,338.1719 3167.6406,337.7813 Q3167.6406,337.4063 3167.9063,337.1719 Q3168.1719,336.9375 3168.7813,336.9375 L3173.9219,336.9375 Q3174.5313,336.9375 3174.7969,337.1719 Q3175.0625,337.4063 3175.0625,337.7813 Q3175.0625,338.1719 3174.7969,338.4063 Q3174.5313,338.6406 3173.9219,338.6406 L3172.2031,338.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="86" x="3191.75" y="347.7285">IUserProvider</text><line style="stroke:#181818;stroke-width:0.5;" x1="2949.5" x2="3487.5" y1="358" y2="358"/><line style="stroke:#181818;stroke-width:0.5;" x1="2949.5" x2="3487.5" y1="366" y2="366"/><ellipse cx="2959.5" cy="380.3047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="356" x="2968.5" y="384.5332">CreateUserAsync(userCreate : DbUser) : Task&lt;DbUser&gt;</text><ellipse cx="2959.5" cy="397.9141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="336" x="2968.5" y="402.1426">GetUserByEmailAsync(email : string) : Task&lt;DbUser&gt;</text><ellipse cx="2959.5" cy="415.5234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="271" x="2968.5" y="419.752">GetUserByIdAsync(id : int) : Task&lt;DbUser&gt;</text><ellipse cx="2959.5" cy="433.1328" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="365" x="2968.5" y="437.3613">UpdateUserFailedTriesAsync(userId : int) : Task&lt;DbUser&gt;</text><ellipse cx="2959.5" cy="450.7422" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="382" x="2968.5" y="454.9707">UpdateUserLoginSuccessAsync(userId : int) : Task&lt;DbUser&gt;</text><ellipse cx="2959.5" cy="468.3516" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="409" x="2968.5" y="472.5801">UpdateUserLoginNewLocationAsync(userId : int) : Task&lt;DbUser&gt;</text><ellipse cx="2959.5" cy="485.9609" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="298" x="2968.5" y="490.1895">UpdateUserToVerifiedAsync(userID : int) : Task</text><ellipse cx="2959.5" cy="503.5703" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="514" x="2968.5" y="507.7988">UpdateUserLoginSuccessWithVerificationCodeAsync(userId : int) : Task&lt;DbUser&gt;</text></g><!--MD5=[e3292821846300d7b478166358ada8cf]
class ILeakedPasswordProvider--><g id="elem_ILeakedPasswordProvider"><rect codeLine="120" fill="#F1F1F1" height="65.6094" id="ILeakedPasswordProvider" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="408" x="3523.5" y="387.5"/><ellipse cx="3640.75" cy="403.5" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M3641.7031,400.1406 L3641.7031,406.7969 L3643.4219,406.7969 Q3644.0313,406.7969 3644.2969,407.0313 Q3644.5625,407.2656 3644.5625,407.6563 Q3644.5625,408.0313 3644.2969,408.2656 Q3644.0313,408.5 3643.4219,408.5 L3638.2813,408.5 Q3637.6719,408.5 3637.4063,408.2656 Q3637.1406,408.0313 3637.1406,407.6406 Q3637.1406,407.2656 3637.4063,407.0313 Q3637.6719,406.7969 3638.2813,406.7969 L3640,406.7969 L3640,400.1406 L3638.2813,400.1406 Q3637.6719,400.1406 3637.4063,399.9063 Q3637.1406,399.6719 3637.1406,399.2813 Q3637.1406,398.9063 3637.4063,398.6719 Q3637.6719,398.4375 3638.2813,398.4375 L3643.4219,398.4375 Q3644.0313,398.4375 3644.2969,398.6719 Q3644.5625,398.9063 3644.5625,399.2813 Q3644.5625,399.6719 3644.2969,399.9063 Q3644.0313,400.1406 3643.4219,400.1406 L3641.7031,400.1406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="165" x="3661.25" y="409.2285">ILeakedPasswordProvider</text><line style="stroke:#181818;stroke-width:0.5;" x1="3524.5" x2="3930.5" y1="419.5" y2="419.5"/><line style="stroke:#181818;stroke-width:0.5;" x1="3524.5" x2="3930.5" y1="427.5" y2="427.5"/><ellipse cx="3534.5" cy="441.8047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="382" x="3543.5" y="446.0332">GetIsPasswordLeakedAsync(password : string) : Task&lt;bool&gt;</text></g><!--MD5=[88f66da615ead437be96f70edff3214c]
class UserToken--><g id="elem_UserToken"><rect codeLine="187" fill="#F1F1F1" height="100.8281" id="UserToken" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="113" x="217" y="601.5"/><ellipse cx="237.4" cy="617.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M240.1656,613.375 Q240.3219,613.1563 240.5094,613.0469 Q240.6969,612.9375 240.9156,612.9375 Q241.2906,612.9375 241.525,613.1953 Q241.7594,613.4531 241.7594,614.0625 L241.7594,615.5156 Q241.7594,616.125 241.525,616.3906 Q241.2906,616.6563 240.9156,616.6563 Q240.5719,616.6563 240.3688,616.4531 Q240.1656,616.2656 240.0563,615.75 Q240.0094,615.3906 239.8219,615.2031 Q239.4938,614.8281 238.8844,614.6094 Q238.275,614.3906 237.65,614.3906 Q236.8844,614.3906 236.2516,614.7188 Q235.6188,615.0469 235.1266,615.7969 Q234.6344,616.5469 234.6344,617.5781 L234.6344,618.6719 Q234.6344,619.9063 235.525,620.7266 Q236.4156,621.5469 238.0094,621.5469 Q238.9469,621.5469 239.6031,621.2969 Q239.9938,621.1406 240.4156,620.7031 Q240.6813,620.4375 240.8297,620.3594 Q240.9781,620.2813 241.1813,620.2813 Q241.5094,620.2813 241.7672,620.5391 Q242.025,620.7969 242.025,621.1406 Q242.025,621.4844 241.6813,621.8906 Q241.1813,622.4688 240.3844,622.7969 Q239.3063,623.25 238.0094,623.25 Q236.4938,623.25 235.2906,622.625 Q234.3063,622.125 233.6188,621.0547 Q232.9313,619.9844 232.9313,618.7031 L232.9313,617.5469 Q232.9313,616.2188 233.5484,615.0703 Q234.1656,613.9219 235.2594,613.3047 Q236.3531,612.6875 237.5875,612.6875 Q238.3219,612.6875 238.9703,612.8516 Q239.6188,613.0156 240.1656,613.375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="252.6" y="623.2285">UserToken</text><line style="stroke:#181818;stroke-width:0.5;" x1="218" x2="329" y1="633.5" y2="633.5"/><ellipse cx="228" cy="647.8047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="237" y="652.0332">UserID : int</text><ellipse cx="228" cy="665.4141" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="237" y="669.6426">Email : string</text><ellipse cx="228" cy="683.0234" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="237" y="687.252">Token : string</text><line style="stroke:#181818;stroke-width:0.5;" x1="218" x2="329" y1="694.3281" y2="694.3281"/></g><!--MD5=[3a13148eff96962085f13babcc0d4f9f]
class IUserLocationProvider--><g id="elem_IUserLocationProvider"><rect codeLine="136" fill="#F1F1F1" height="100.8281" id="IUserLocationProvider" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="540" x="490.5" y="370"/><ellipse cx="686.25" cy="386" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M687.2031,382.6406 L687.2031,389.2969 L688.9219,389.2969 Q689.5313,389.2969 689.7969,389.5313 Q690.0625,389.7656 690.0625,390.1563 Q690.0625,390.5313 689.7969,390.7656 Q689.5313,391 688.9219,391 L683.7813,391 Q683.1719,391 682.9063,390.7656 Q682.6406,390.5313 682.6406,390.1406 Q682.6406,389.7656 682.9063,389.5313 Q683.1719,389.2969 683.7813,389.2969 L685.5,389.2969 L685.5,382.6406 L683.7813,382.6406 Q683.1719,382.6406 682.9063,382.4063 Q682.6406,382.1719 682.6406,381.7813 Q682.6406,381.4063 682.9063,381.1719 Q683.1719,380.9375 683.7813,380.9375 L688.9219,380.9375 Q689.5313,380.9375 689.7969,381.1719 Q690.0625,381.4063 690.0625,381.7813 Q690.0625,382.1719 689.7969,382.4063 Q689.5313,382.6406 688.9219,382.6406 L687.2031,382.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="140" x="706.75" y="391.7285">IUserLocationProvider</text><line style="stroke:#181818;stroke-width:0.5;" x1="491.5" x2="1029.5" y1="402" y2="402"/><line style="stroke:#181818;stroke-width:0.5;" x1="491.5" x2="1029.5" y1="410" y2="410"/><ellipse cx="501.5" cy="424.3047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="260" x="510.5" y="428.5332">IsIPLockedAsync(ip : string) : Task&lt;bool&gt;</text><ellipse cx="501.5" cy="441.9141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="441" x="510.5" y="446.1426">LogLocationAsync(userLocation: UserLocation) : Task&lt;UserLocation&gt;</text><ellipse cx="501.5" cy="459.5234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="514" x="510.5" y="463.752">UserWasLoggedInFromLocationAsync(userLocation : UserLocation) : Task&lt;bool&gt;</text></g><!--MD5=[3a675687b1cd1bb713529f5053553131]
class SqlProvider--><g id="elem_SqlProvider"><rect codeLine="124" fill="#F1F1F1" height="100.8281" id="SqlProvider" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="700" x="3966.5" y="370"/><ellipse cx="4275.75" cy="386" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M4278.5156,381.875 Q4278.6719,381.6563 4278.8594,381.5469 Q4279.0469,381.4375 4279.2656,381.4375 Q4279.6406,381.4375 4279.875,381.6953 Q4280.1094,381.9531 4280.1094,382.5625 L4280.1094,384.0156 Q4280.1094,384.625 4279.875,384.8906 Q4279.6406,385.1563 4279.2656,385.1563 Q4278.9219,385.1563 4278.7188,384.9531 Q4278.5156,384.7656 4278.4063,384.25 Q4278.3594,383.8906 4278.1719,383.7031 Q4277.8438,383.3281 4277.2344,383.1094 Q4276.625,382.8906 4276,382.8906 Q4275.2344,382.8906 4274.6016,383.2188 Q4273.9688,383.5469 4273.4766,384.2969 Q4272.9844,385.0469 4272.9844,386.0781 L4272.9844,387.1719 Q4272.9844,388.4063 4273.875,389.2266 Q4274.7656,390.0469 4276.3594,390.0469 Q4277.2969,390.0469 4277.9531,389.7969 Q4278.3438,389.6406 4278.7656,389.2031 Q4279.0313,388.9375 4279.1797,388.8594 Q4279.3281,388.7813 4279.5313,388.7813 Q4279.8594,388.7813 4280.1172,389.0391 Q4280.375,389.2969 4280.375,389.6406 Q4280.375,389.9844 4280.0313,390.3906 Q4279.5313,390.9688 4278.7344,391.2969 Q4277.6563,391.75 4276.3594,391.75 Q4274.8438,391.75 4273.6406,391.125 Q4272.6563,390.625 4271.9688,389.5547 Q4271.2813,388.4844 4271.2813,387.2031 L4271.2813,386.0469 Q4271.2813,384.7188 4271.8984,383.5703 Q4272.5156,382.4219 4273.6094,381.8047 Q4274.7031,381.1875 4275.9375,381.1875 Q4276.6719,381.1875 4277.3203,381.3516 Q4277.9688,381.5156 4278.5156,381.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="4296.25" y="391.7285">SqlProvider</text><line style="stroke:#181818;stroke-width:0.5;" x1="3967.5" x2="4665.5" y1="402" y2="402"/><line style="stroke:#181818;stroke-width:1.0;" x1="3967.5" x2="4665.5" y1="410" y2="410"/><ellipse cx="3977.5" cy="424.3047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="199" x="3986.5" y="428.5332">SqlProvider(connection : string)</text><polygon fill="#FFFF44" points="3977.5,436.9141,3981.5,440.9141,3977.5,444.9141,3973.5,440.9141" style="stroke:#B38D22;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="674" x="3986.5" y="446.1426">RunSpAsync(storedProcedureName : string, storedProcedureElements : SpElements[]) : Task&lt;DataTable&gt;</text><polygon fill="#FFFF44" points="3977.5,454.5234,3981.5,458.5234,3977.5,462.5234,3973.5,458.5234" style="stroke:#B38D22;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="322" x="3986.5" y="463.752">RunQueryAsync(query : string) : Task&lt;DataTable&gt;</text></g><!--MD5=[54606654dd7012b88529a0f0305a5f2d]
class LeakedPasswordProvider--><g id="elem_LeakedPasswordProvider"><rect codeLine="131" fill="#F1F1F1" height="65.6094" id="LeakedPasswordProvider" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="379" x="4121" y="103.5"/><ellipse cx="4225.75" cy="119.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M4228.5156,115.375 Q4228.6719,115.1563 4228.8594,115.0469 Q4229.0469,114.9375 4229.2656,114.9375 Q4229.6406,114.9375 4229.875,115.1953 Q4230.1094,115.4531 4230.1094,116.0625 L4230.1094,117.5156 Q4230.1094,118.125 4229.875,118.3906 Q4229.6406,118.6563 4229.2656,118.6563 Q4228.9219,118.6563 4228.7188,118.4531 Q4228.5156,118.2656 4228.4063,117.75 Q4228.3594,117.3906 4228.1719,117.2031 Q4227.8438,116.8281 4227.2344,116.6094 Q4226.625,116.3906 4226,116.3906 Q4225.2344,116.3906 4224.6016,116.7188 Q4223.9688,117.0469 4223.4766,117.7969 Q4222.9844,118.5469 4222.9844,119.5781 L4222.9844,120.6719 Q4222.9844,121.9063 4223.875,122.7266 Q4224.7656,123.5469 4226.3594,123.5469 Q4227.2969,123.5469 4227.9531,123.2969 Q4228.3438,123.1406 4228.7656,122.7031 Q4229.0313,122.4375 4229.1797,122.3594 Q4229.3281,122.2813 4229.5313,122.2813 Q4229.8594,122.2813 4230.1172,122.5391 Q4230.375,122.7969 4230.375,123.1406 Q4230.375,123.4844 4230.0313,123.8906 Q4229.5313,124.4688 4228.7344,124.7969 Q4227.6563,125.25 4226.3594,125.25 Q4224.8438,125.25 4223.6406,124.625 Q4222.6563,124.125 4221.9688,123.0547 Q4221.2813,121.9844 4221.2813,120.7031 L4221.2813,119.5469 Q4221.2813,118.2188 4221.8984,117.0703 Q4222.5156,115.9219 4223.6094,115.3047 Q4224.7031,114.6875 4225.9375,114.6875 Q4226.6719,114.6875 4227.3203,114.8516 Q4227.9688,115.0156 4228.5156,115.375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="161" x="4246.25" y="125.2285">LeakedPasswordProvider</text><line style="stroke:#181818;stroke-width:0.5;" x1="4122" x2="4499" y1="135.5" y2="135.5"/><line style="stroke:#181818;stroke-width:1.0;" x1="4122" x2="4499" y1="143.5" y2="143.5"/><ellipse cx="4132" cy="157.8047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="353" x="4141" y="162.0332">LeakedPasswordProvider(configuration : IConfiguration)</text></g><!--MD5=[615787437c5f23b61c90c6d240d4b67f]
class UserProvider--><g id="elem_UserProvider"><rect codeLine="142" fill="#F1F1F1" height="83.2188" id="UserProvider" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="300" x="3779.5" y="95"/><ellipse cx="3884.25" cy="111" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M3887.0156,106.875 Q3887.1719,106.6563 3887.3594,106.5469 Q3887.5469,106.4375 3887.7656,106.4375 Q3888.1406,106.4375 3888.375,106.6953 Q3888.6094,106.9531 3888.6094,107.5625 L3888.6094,109.0156 Q3888.6094,109.625 3888.375,109.8906 Q3888.1406,110.1563 3887.7656,110.1563 Q3887.4219,110.1563 3887.2188,109.9531 Q3887.0156,109.7656 3886.9063,109.25 Q3886.8594,108.8906 3886.6719,108.7031 Q3886.3438,108.3281 3885.7344,108.1094 Q3885.125,107.8906 3884.5,107.8906 Q3883.7344,107.8906 3883.1016,108.2188 Q3882.4688,108.5469 3881.9766,109.2969 Q3881.4844,110.0469 3881.4844,111.0781 L3881.4844,112.1719 Q3881.4844,113.4063 3882.375,114.2266 Q3883.2656,115.0469 3884.8594,115.0469 Q3885.7969,115.0469 3886.4531,114.7969 Q3886.8438,114.6406 3887.2656,114.2031 Q3887.5313,113.9375 3887.6797,113.8594 Q3887.8281,113.7813 3888.0313,113.7813 Q3888.3594,113.7813 3888.6172,114.0391 Q3888.875,114.2969 3888.875,114.6406 Q3888.875,114.9844 3888.5313,115.3906 Q3888.0313,115.9688 3887.2344,116.2969 Q3886.1563,116.75 3884.8594,116.75 Q3883.3438,116.75 3882.1406,116.125 Q3881.1563,115.625 3880.4688,114.5547 Q3879.7813,113.4844 3879.7813,112.2031 L3879.7813,111.0469 Q3879.7813,109.7188 3880.3984,108.5703 Q3881.0156,107.4219 3882.1094,106.8047 Q3883.2031,106.1875 3884.4375,106.1875 Q3885.1719,106.1875 3885.8203,106.3516 Q3886.4688,106.5156 3887.0156,106.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="3904.75" y="116.7285">UserProvider</text><line style="stroke:#181818;stroke-width:0.5;" x1="3780.5" x2="4078.5" y1="127" y2="127"/><line style="stroke:#181818;stroke-width:1.0;" x1="3780.5" x2="4078.5" y1="135" y2="135"/><ellipse cx="3790.5" cy="149.3047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="274" x="3799.5" y="153.5332">UserProvider(configuration : IConfiguration)</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="3787.5" y="163.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="217" x="3799.5" y="171.1426">DRToUser(dr : DataRow) : DbUser</text></g><!--MD5=[a2d8207c5488f269b0816fb28beca551]
class DbUser--><g id="elem_DbUser"><rect codeLine="201" fill="#F1F1F1" height="136.0469" id="DbUser" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="210" x="2472.5" y="584"/><ellipse cx="2549.75" cy="600" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M2552.5156,595.875 Q2552.6719,595.6563 2552.8594,595.5469 Q2553.0469,595.4375 2553.2656,595.4375 Q2553.6406,595.4375 2553.875,595.6953 Q2554.1094,595.9531 2554.1094,596.5625 L2554.1094,598.0156 Q2554.1094,598.625 2553.875,598.8906 Q2553.6406,599.1563 2553.2656,599.1563 Q2552.9219,599.1563 2552.7188,598.9531 Q2552.5156,598.7656 2552.4063,598.25 Q2552.3594,597.8906 2552.1719,597.7031 Q2551.8438,597.3281 2551.2344,597.1094 Q2550.625,596.8906 2550,596.8906 Q2549.2344,596.8906 2548.6016,597.2188 Q2547.9688,597.5469 2547.4766,598.2969 Q2546.9844,599.0469 2546.9844,600.0781 L2546.9844,601.1719 Q2546.9844,602.4063 2547.875,603.2266 Q2548.7656,604.0469 2550.3594,604.0469 Q2551.2969,604.0469 2551.9531,603.7969 Q2552.3438,603.6406 2552.7656,603.2031 Q2553.0313,602.9375 2553.1797,602.8594 Q2553.3281,602.7813 2553.5313,602.7813 Q2553.8594,602.7813 2554.1172,603.0391 Q2554.375,603.2969 2554.375,603.6406 Q2554.375,603.9844 2554.0313,604.3906 Q2553.5313,604.9688 2552.7344,605.2969 Q2551.6563,605.75 2550.3594,605.75 Q2548.8438,605.75 2547.6406,605.125 Q2546.6563,604.625 2545.9688,603.5547 Q2545.2813,602.4844 2545.2813,601.2031 L2545.2813,600.0469 Q2545.2813,598.7188 2545.8984,597.5703 Q2546.5156,596.4219 2547.6094,595.8047 Q2548.7031,595.1875 2549.9375,595.1875 Q2550.6719,595.1875 2551.3203,595.3516 Q2551.9688,595.5156 2552.5156,595.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="2570.25" y="605.7285">DbUser</text><line style="stroke:#181818;stroke-width:0.5;" x1="2473.5" x2="2681.5" y1="616" y2="616"/><ellipse cx="2483.5" cy="630.3047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="156" x="2492.5" y="634.5332">HashedPassword : string</text><ellipse cx="2483.5" cy="647.9141" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="2492.5" y="652.1426">Salt : string</text><ellipse cx="2483.5" cy="665.5234" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="2492.5" y="669.752">SecretKey : string</text><ellipse cx="2483.5" cy="683.1328" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="2492.5" y="687.3613">Count : long</text><ellipse cx="2483.5" cy="700.7422" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="184" x="2492.5" y="704.9707">LastRequestDate : datetime?</text><line style="stroke:#181818;stroke-width:0.5;" x1="2473.5" x2="2681.5" y1="712.0469" y2="712.0469"/></g><!--MD5=[1a3d1e414f70b9a6597f64281cc6a626]
class UserLocation--><g id="elem_UserLocation"><rect codeLine="231" fill="#F1F1F1" height="153.6563" id="UserLocation" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="165" x="678" y="575"/><ellipse cx="715.5" cy="591" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M718.2656,586.875 Q718.4219,586.6563 718.6094,586.5469 Q718.7969,586.4375 719.0156,586.4375 Q719.3906,586.4375 719.625,586.6953 Q719.8594,586.9531 719.8594,587.5625 L719.8594,589.0156 Q719.8594,589.625 719.625,589.8906 Q719.3906,590.1563 719.0156,590.1563 Q718.6719,590.1563 718.4688,589.9531 Q718.2656,589.7656 718.1563,589.25 Q718.1094,588.8906 717.9219,588.7031 Q717.5938,588.3281 716.9844,588.1094 Q716.375,587.8906 715.75,587.8906 Q714.9844,587.8906 714.3516,588.2188 Q713.7188,588.5469 713.2266,589.2969 Q712.7344,590.0469 712.7344,591.0781 L712.7344,592.1719 Q712.7344,593.4063 713.625,594.2266 Q714.5156,595.0469 716.1094,595.0469 Q717.0469,595.0469 717.7031,594.7969 Q718.0938,594.6406 718.5156,594.2031 Q718.7813,593.9375 718.9297,593.8594 Q719.0781,593.7813 719.2813,593.7813 Q719.6094,593.7813 719.8672,594.0391 Q720.125,594.2969 720.125,594.6406 Q720.125,594.9844 719.7813,595.3906 Q719.2813,595.9688 718.4844,596.2969 Q717.4063,596.75 716.1094,596.75 Q714.5938,596.75 713.3906,596.125 Q712.4063,595.625 711.7188,594.5547 Q711.0313,593.4844 711.0313,592.2031 L711.0313,591.0469 Q711.0313,589.7188 711.6484,588.5703 Q712.2656,587.4219 713.3594,586.8047 Q714.4531,586.1875 715.6875,586.1875 Q716.4219,586.1875 717.0703,586.3516 Q717.7188,586.5156 718.2656,586.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="734.5" y="596.7285">UserLocation</text><line style="stroke:#181818;stroke-width:0.5;" x1="679" x2="842" y1="607" y2="607"/><ellipse cx="689" cy="621.3047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="698" y="625.5332">ID : int</text><ellipse cx="689" cy="638.9141" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="698" y="643.1426">UserID : int</text><ellipse cx="689" cy="656.5234" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="698" y="660.752">IP : string</text><ellipse cx="689" cy="674.1328" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="698" y="678.3613">UserAgent : string</text><ellipse cx="689" cy="691.7422" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="698" y="695.9707">Successful : bool</text><ellipse cx="689" cy="709.3516" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="698" y="713.5801">CreateDate : datetime</text><line style="stroke:#181818;stroke-width:0.5;" x1="679" x2="842" y1="720.6563" y2="720.6563"/></g><!--MD5=[c40368751ea5476301fbcdc8cb25eba8]
class Security--><g id="elem_Security"><rect codeLine="163" fill="#F1F1F1" height="153.6563" id="Security" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="580" x="4535.5" y="59.5"/><ellipse cx="4795.75" cy="75.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M4798.5156,71.375 Q4798.6719,71.1563 4798.8594,71.0469 Q4799.0469,70.9375 4799.2656,70.9375 Q4799.6406,70.9375 4799.875,71.1953 Q4800.1094,71.4531 4800.1094,72.0625 L4800.1094,73.5156 Q4800.1094,74.125 4799.875,74.3906 Q4799.6406,74.6563 4799.2656,74.6563 Q4798.9219,74.6563 4798.7188,74.4531 Q4798.5156,74.2656 4798.4063,73.75 Q4798.3594,73.3906 4798.1719,73.2031 Q4797.8438,72.8281 4797.2344,72.6094 Q4796.625,72.3906 4796,72.3906 Q4795.2344,72.3906 4794.6016,72.7188 Q4793.9688,73.0469 4793.4766,73.7969 Q4792.9844,74.5469 4792.9844,75.5781 L4792.9844,76.6719 Q4792.9844,77.9063 4793.875,78.7266 Q4794.7656,79.5469 4796.3594,79.5469 Q4797.2969,79.5469 4797.9531,79.2969 Q4798.3438,79.1406 4798.7656,78.7031 Q4799.0313,78.4375 4799.1797,78.3594 Q4799.3281,78.2813 4799.5313,78.2813 Q4799.8594,78.2813 4800.1172,78.5391 Q4800.375,78.7969 4800.375,79.1406 Q4800.375,79.4844 4800.0313,79.8906 Q4799.5313,80.4688 4798.7344,80.7969 Q4797.6563,81.25 4796.3594,81.25 Q4794.8438,81.25 4793.6406,80.625 Q4792.6563,80.125 4791.9688,79.0547 Q4791.2813,77.9844 4791.2813,76.7031 L4791.2813,75.5469 Q4791.2813,74.2188 4791.8984,73.0703 Q4792.5156,71.9219 4793.6094,71.3047 Q4794.7031,70.6875 4795.9375,70.6875 Q4796.6719,70.6875 4797.3203,70.8516 Q4797.9688,71.0156 4798.5156,71.375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="4816.25" y="81.2285">Security</text><line style="stroke:#181818;stroke-width:0.5;" x1="4536.5" x2="5114.5" y1="91.5" y2="91.5"/><line style="stroke:#181818;stroke-width:1.0;" x1="4536.5" x2="5114.5" y1="99.5" y2="99.5"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="4543.5" y="110.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="253" x="4555.5" y="118.0332">ComputeHash(password : string) : string</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="4543.5" y="128.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="321" x="4555.5" y="135.6426">HashPassword(password : salt, salt : string) : string</text><ellipse cx="4546.5" cy="149.0234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="197" x="4555.5" y="153.252">GetSalt(saltLength : int) : string</text><ellipse cx="4546.5" cy="166.6328" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="554" x="4555.5" y="170.8613">GetEncryptedAndSaltedPassword(password : string, salt : string, pepper : string) : string</text><ellipse cx="4546.5" cy="184.2422" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="273" x="4555.5" y="188.4707">GetHotp(key : string, counter : long) : string</text><ellipse cx="4546.5" cy="201.8516" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="139" x="4555.5" y="206.0801">GetHmacKey() : string</text></g><!--MD5=[530bdd8d88d30015127c6b1b07c38463]
class RegexHelper--><g id="elem_RegexHelper"><rect codeLine="173" fill="#F1F1F1" height="65.6094" id="RegexHelper" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="388" x="5150.5" y="103.5"/><ellipse cx="5299.75" cy="119.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M5302.5156,115.375 Q5302.6719,115.1563 5302.8594,115.0469 Q5303.0469,114.9375 5303.2656,114.9375 Q5303.6406,114.9375 5303.875,115.1953 Q5304.1094,115.4531 5304.1094,116.0625 L5304.1094,117.5156 Q5304.1094,118.125 5303.875,118.3906 Q5303.6406,118.6563 5303.2656,118.6563 Q5302.9219,118.6563 5302.7188,118.4531 Q5302.5156,118.2656 5302.4063,117.75 Q5302.3594,117.3906 5302.1719,117.2031 Q5301.8438,116.8281 5301.2344,116.6094 Q5300.625,116.3906 5300,116.3906 Q5299.2344,116.3906 5298.6016,116.7188 Q5297.9688,117.0469 5297.4766,117.7969 Q5296.9844,118.5469 5296.9844,119.5781 L5296.9844,120.6719 Q5296.9844,121.9063 5297.875,122.7266 Q5298.7656,123.5469 5300.3594,123.5469 Q5301.2969,123.5469 5301.9531,123.2969 Q5302.3438,123.1406 5302.7656,122.7031 Q5303.0313,122.4375 5303.1797,122.3594 Q5303.3281,122.2813 5303.5313,122.2813 Q5303.8594,122.2813 5304.1172,122.5391 Q5304.375,122.7969 5304.375,123.1406 Q5304.375,123.4844 5304.0313,123.8906 Q5303.5313,124.4688 5302.7344,124.7969 Q5301.6563,125.25 5300.3594,125.25 Q5298.8438,125.25 5297.6406,124.625 Q5296.6563,124.125 5295.9688,123.0547 Q5295.2813,121.9844 5295.2813,120.7031 L5295.2813,119.5469 Q5295.2813,118.2188 5295.8984,117.0703 Q5296.5156,115.9219 5297.6094,115.3047 Q5298.7031,114.6875 5299.9375,114.6875 Q5300.6719,114.6875 5301.3203,114.8516 Q5301.9688,115.0156 5302.5156,115.375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="5320.25" y="125.2285">RegexHelper</text><line style="stroke:#181818;stroke-width:0.5;" x1="5151.5" x2="5537.5" y1="135.5" y2="135.5"/><line style="stroke:#181818;stroke-width:1.0;" x1="5151.5" x2="5537.5" y1="143.5" y2="143.5"/><ellipse cx="5161.5" cy="157.8047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="362" x="5170.5" y="162.0332">TryToGetBrowserWithoutVersion(browser : string) : string</text></g><!--MD5=[3fd616f346a44cd59a91eb10b19e157c]
class User--><g id="elem_User"><rect codeLine="193" fill="#F1F1F1" height="136.0469" id="User" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="168" x="2239.5" y="789"/><ellipse cx="2304.75" cy="805" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M2307.5156,800.875 Q2307.6719,800.6563 2307.8594,800.5469 Q2308.0469,800.4375 2308.2656,800.4375 Q2308.6406,800.4375 2308.875,800.6953 Q2309.1094,800.9531 2309.1094,801.5625 L2309.1094,803.0156 Q2309.1094,803.625 2308.875,803.8906 Q2308.6406,804.1563 2308.2656,804.1563 Q2307.9219,804.1563 2307.7188,803.9531 Q2307.5156,803.7656 2307.4063,803.25 Q2307.3594,802.8906 2307.1719,802.7031 Q2306.8438,802.3281 2306.2344,802.1094 Q2305.625,801.8906 2305,801.8906 Q2304.2344,801.8906 2303.6016,802.2188 Q2302.9688,802.5469 2302.4766,803.2969 Q2301.9844,804.0469 2301.9844,805.0781 L2301.9844,806.1719 Q2301.9844,807.4063 2302.875,808.2266 Q2303.7656,809.0469 2305.3594,809.0469 Q2306.2969,809.0469 2306.9531,808.7969 Q2307.3438,808.6406 2307.7656,808.2031 Q2308.0313,807.9375 2308.1797,807.8594 Q2308.3281,807.7813 2308.5313,807.7813 Q2308.8594,807.7813 2309.1172,808.0391 Q2309.375,808.2969 2309.375,808.6406 Q2309.375,808.9844 2309.0313,809.3906 Q2308.5313,809.9688 2307.7344,810.2969 Q2306.6563,810.75 2305.3594,810.75 Q2303.8438,810.75 2302.6406,810.125 Q2301.6563,809.625 2300.9688,808.5547 Q2300.2813,807.4844 2300.2813,806.2031 L2300.2813,805.0469 Q2300.2813,803.7188 2300.8984,802.5703 Q2301.5156,801.4219 2302.6094,800.8047 Q2303.7031,800.1875 2304.9375,800.1875 Q2305.6719,800.1875 2306.3203,800.3516 Q2306.9688,800.5156 2307.5156,800.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="2325.25" y="810.7285">User</text><line style="stroke:#181818;stroke-width:0.5;" x1="2240.5" x2="2406.5" y1="821" y2="821"/><ellipse cx="2250.5" cy="835.3047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="2259.5" y="839.5332">ID : int</text><ellipse cx="2250.5" cy="852.9141" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97" x="2259.5" y="857.1426">IsVerified : bool</text><ellipse cx="2250.5" cy="870.5234" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="2259.5" y="874.752">IsLocked : bool</text><ellipse cx="2250.5" cy="888.1328" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="2259.5" y="892.3613">FailedTries : int</text><ellipse cx="2250.5" cy="905.7422" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="142" x="2259.5" y="909.9707">LockedDate datetime?</text><line style="stroke:#181818;stroke-width:0.5;" x1="2240.5" x2="2406.5" y1="917.0469" y2="917.0469"/></g><!--MD5=[d72258e41e132b68712ed2a953e26009]
class UserBase--><g id="elem_UserBase"><rect codeLine="213" fill="#F1F1F1" height="118.4375" id="UserBase" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="1895" y="985"/><ellipse cx="1941.75" cy="1001" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1944.5156,996.875 Q1944.6719,996.6563 1944.8594,996.5469 Q1945.0469,996.4375 1945.2656,996.4375 Q1945.6406,996.4375 1945.875,996.6953 Q1946.1094,996.9531 1946.1094,997.5625 L1946.1094,999.0156 Q1946.1094,999.625 1945.875,999.8906 Q1945.6406,1000.1563 1945.2656,1000.1563 Q1944.9219,1000.1563 1944.7188,999.9531 Q1944.5156,999.7656 1944.4063,999.25 Q1944.3594,998.8906 1944.1719,998.7031 Q1943.8438,998.3281 1943.2344,998.1094 Q1942.625,997.8906 1942,997.8906 Q1941.2344,997.8906 1940.6016,998.2188 Q1939.9688,998.5469 1939.4766,999.2969 Q1938.9844,1000.0469 1938.9844,1001.0781 L1938.9844,1002.1719 Q1938.9844,1003.4063 1939.875,1004.2266 Q1940.7656,1005.0469 1942.3594,1005.0469 Q1943.2969,1005.0469 1943.9531,1004.7969 Q1944.3438,1004.6406 1944.7656,1004.2031 Q1945.0313,1003.9375 1945.1797,1003.8594 Q1945.3281,1003.7813 1945.5313,1003.7813 Q1945.8594,1003.7813 1946.1172,1004.0391 Q1946.375,1004.2969 1946.375,1004.6406 Q1946.375,1004.9844 1946.0313,1005.3906 Q1945.5313,1005.9688 1944.7344,1006.2969 Q1943.6563,1006.75 1942.3594,1006.75 Q1940.8438,1006.75 1939.6406,1006.125 Q1938.6563,1005.625 1937.9688,1004.5547 Q1937.2813,1003.4844 1937.2813,1002.2031 L1937.2813,1001.0469 Q1937.2813,999.7188 1937.8984,998.5703 Q1938.5156,997.4219 1939.6094,996.8047 Q1940.7031,996.1875 1941.9375,996.1875 Q1942.6719,996.1875 1943.3203,996.3516 Q1943.9688,996.5156 1944.5156,996.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="1962.25" y="1006.7285">UserBase</text><line style="stroke:#181818;stroke-width:0.5;" x1="1896" x2="2057" y1="1017" y2="1017"/><ellipse cx="1906" cy="1031.3047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="1915" y="1035.5332">Email : string</text><ellipse cx="1906" cy="1048.9141" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="1915" y="1053.1426">FirstName : string</text><ellipse cx="1906" cy="1066.5234" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110" x="1915" y="1070.752">LastName : string</text><ellipse cx="1906" cy="1084.1328" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137" x="1915" y="1088.3613">PhoneNumber : string</text><line style="stroke:#181818;stroke-width:0.5;" x1="1896" x2="2057" y1="1095.4375" y2="1095.4375"/></g><!--MD5=[1dfc107116a4b0bc1198698a4e609bfa]
reverse link UserController to IUserManager--><g id="link_UserController_IUserManager"><path codeLine="21" d="M1158.99,246.6 C1216.06,282.29 1277.74,320.85 1328.33,352.49 " fill="none" id="UserController-backto-IUserManager" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="1147.64,239.51,1150.6049,246.0834,1157.813,245.8747,1154.8481,239.3014,1147.64,239.51" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[548e9c59867ce01a8de3c5e8efb076c9]
reverse link UserController to ITokenManager--><g id="link_UserController_ITokenManager"><path codeLine="22" d="M681.34,244.19 C612.25,269.86 539.48,298 472.5,326 C440.28,339.47 405.66,355.26 374.49,369.98 " fill="none" id="UserController-backto-ITokenManager" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="693.74,239.59,686.723,237.928,682.49,243.7659,689.507,245.4279,693.74,239.59" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[d4b0c0978a527e7d73578f3b8ff1d639]
link IUserManager to UserCreate--><g id="link_IUserManager_UserCreate"><path codeLine="90" d="M1406.16,488.52 C1381.51,556.27 1357.94,660.47 1410.5,729 C1459.06,792.32 1690.71,831.06 1810.85,847.23 " fill="none" id="IUserManager-to-UserCreate" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1816.13,847.93,1807.7483,842.7582,1811.1752,847.2589,1806.6746,850.6858,1816.13,847.93" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[b144519fb167e24c357139cc31a61e5d]
link IUserManager to UserLogin--><g id="link_IUserManager_UserLogin"><path codeLine="91" d="M1453.1,488.81 C1462.88,526.22 1474.79,571.8 1483.5,605.1 " fill="none" id="IUserManager-to-UserLogin" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1484.87,610.34,1486.4803,600.6237,1483.6137,605.5004,1478.737,602.6338,1484.87,610.34" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[bda616a4ec88bb93f38d43595a1d9abc]
link IUserManager to VerifyCredentials--><g id="link_IUserManager_VerifyCredentials"><path codeLine="92" d="M1503.54,488.81 C1541.98,526.84 1588.96,573.3 1622.75,606.74 " fill="none" id="IUserManager-to-VerifyCredentials" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1626.4,610.34,1622.8088,601.1692,1622.8431,606.826,1617.1864,606.8602,1626.4,610.34" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[5d0d21d87f609d36e9bd211d6cdf12f6]
link UserManager to IUserManager--><g id="link_UserManager_IUserManager"><path codeLine="93" d="M2604.24,263.3 C2598.3,264.22 2592.38,265.12 2586.5,266 C2249.61,316.17 2158.87,272.5 1822.5,326 C1785.07,331.95 1745.91,339.65 1707.49,348.06 " fill="none" id="UserManager-to-IUserManager" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="1708.83,354.93,1687.79,352.45,1705.78,341.27,1708.83,354.93" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[1d484ee4b213f86a79b7b13bd52fde3a]
link MessageManager to IMessageManager--><g id="link_MessageManager_IMessageManager"><path codeLine="94" d="M2311.21,187.27 C2388.36,237.98 2507.49,316.29 2585.73,367.72 " fill="none" id="MessageManager-to-IMessageManager" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="2589.88,362.07,2602.75,378.91,2582.19,373.77,2589.88,362.07" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[1231944e95ebfb91f3104517f7260a55]
reverse link UserManager to IUserProvider--><g id="link_UserManager_IUserProvider"><path codeLine="96" d="M3193.64,279.31 C3196.43,295.02 3199.21,310.72 3201.86,325.63 " fill="none" id="UserManager-backto-IUserProvider" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="3191.31,266.12,3188.4186,272.7261,3193.4044,277.9358,3196.2958,271.3298,3191.31,266.12" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[536fba823f8263b20c30d29df0fd99b8]
reverse link UserManager to IUserLocationManager--><g id="link_UserManager_IUserLocationManager"><path codeLine="97" d="M2609.11,269.3 C2538.01,287.56 2466.41,306.69 2398.5,326 C2351.85,339.26 2301.43,355.11 2256,369.95 " fill="none" id="UserManager-backto-IUserLocationManager" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="2621.91,266.02,2615.1049,263.6345,2610.2855,268.9986,2617.0906,271.3841,2621.91,266.02" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[acaf6dcafaeef567235e025343905109]
reverse link UserManager to ILeakedPasswordProvider--><g id="link_UserManager_ILeakedPasswordProvider"><path codeLine="98" d="M3435.21,272.05 C3520.49,315.07 3607.36,358.89 3663.98,387.45 " fill="none" id="UserManager-backto-ILeakedPasswordProvider" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="3423.46,266.12,3427.0162,272.3933,3434.1746,271.5234,3430.6185,265.2502,3423.46,266.12" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[f1b914c86bbf4264254e7be00f738a27]
reverse link UserManager to IMessageManager--><g id="link_UserManager_IMessageManager"><path codeLine="99" d="M2927.06,272.59 C2857.77,311.36 2787.42,350.72 2737,378.94 " fill="none" id="UserManager-backto-IMessageManager" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="2938.62,266.12,2931.4309,265.5572,2928.1463,271.9768,2935.3354,272.5396,2938.62,266.12" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[f4b9cc5a9edb981f7418b8fcf7de3067]
link TokenManager to ITokenManager--><g id="link_TokenManager_ITokenManager"><path codeLine="101" d="M273.5,178.2 C273.5,223.01 273.5,295.82 273.5,349.76 " fill="none" id="TokenManager-to-ITokenManager" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="280.5,349.78,273.5,369.78,266.5,349.78,280.5,349.78" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[8f9038f41d1a9fcfa0da510f3a7dcbcc]
reverse link ITokenManager to UserToken--><g id="link_ITokenManager_UserToken"><path codeLine="102" d="M273.5,484.13 C273.5,520.94 273.5,566.84 273.5,601.18 " fill="none" id="ITokenManager-backto-UserToken" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="273.5,471.02,269.5,477.02,273.5,483.02,277.5,477.02,273.5,471.02" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[a7358745a089081073f5a601608e5a73]
link UserLocationManager to IUserLocationManager--><g id="link_UserLocationManager_IUserLocationManager"><path codeLine="105" d="M1683.26,178.05 C1767.68,225.76 1908.56,305.38 2005.32,360.06 " fill="none" id="UserLocationManager-to-IUserLocationManager" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="2008.88,354.03,2022.85,369.97,2001.99,366.22,2008.88,354.03" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[0a4ead1edd2c2b1fdc9bf52f1c627135]
reverse link UserLocationManager to IUserLocationProvider--><g id="link_UserLocationManager_IUserLocationProvider"><path codeLine="106" d="M1517.61,183.7 C1460.27,210.54 1384.87,243.4 1315.5,266 C1199.44,303.81 1165.22,293.73 1047.5,326 C1000.25,338.96 949.23,354.92 903.49,369.97 " fill="none" id="UserLocationManager-backto-IUserLocationProvider" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="1529.56,178.08,1522.4272,177.0205,1518.7058,183.1972,1525.8386,184.2567,1529.56,178.08" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[ebed19925dbee498eddafde4c2e5889a]
reverse link IUserProvider to DbUser--><g id="link_IUserProvider_DbUser"><path codeLine="152" d="M2944.87,519.47 C2852.16,552.66 2754.11,587.77 2682.65,613.35 " fill="none" id="IUserProvider-backto-DbUser" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="2957.32,515.01,2950.3243,513.2605,2946.0188,519.0452,2953.0145,520.7947,2957.32,515.01" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[ebfa5078469ba21b5ab21ca793b470a4]
reverse link IUserLocationProvider to UserLocation--><g id="link_IUserLocationProvider_UserLocation"><path codeLine="153" d="M760.5,484.3 C760.5,512.3 760.5,545.53 760.5,574.93 " fill="none" id="IUserLocationProvider-backto-UserLocation" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="760.5,471.02,756.5,477.02,760.5,483.02,764.5,477.02,760.5,471.02" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[1d941831239f3bd1b1ef4931734ff75b]
link LeakedPasswordProvider to ILeakedPasswordProvider--><g id="link_LeakedPasswordProvider_ILeakedPasswordProvider"><path codeLine="155" d="M4262.25,169.62 C4219.87,197.09 4156.01,236.72 4097.5,266 C4034.03,297.76 4015.1,298.89 3949.5,326 C3907.39,343.4 3860.91,362.93 3821.41,379.62 " fill="none" id="LeakedPasswordProvider-to-ILeakedPasswordProvider" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="3824.06,386.1,3802.92,387.44,3818.61,373.2,3824.06,386.1" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[d5b7a4ae7f7e8e823301b74032a4bc45]
link LeakedPasswordProvider to SqlProvider--><g id="link_LeakedPasswordProvider_SqlProvider"><path codeLine="156" d="M4311.18,169.57 C4312.11,213.16 4313.79,292.25 4315.02,349.81 " fill="none" id="LeakedPasswordProvider-to-SqlProvider" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="4322.02,349.8,4315.45,369.94,4308.02,350.1,4322.02,349.8" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[2afc5d4273870e4232a4e992ffb1f14d]
link UserProvider to IUserProvider--><g id="link_UserProvider_IUserProvider"><path codeLine="158" d="M3883.32,178.01 C3848.66,206.46 3798.87,243.32 3749.5,266 C3653.57,310.06 3616.93,297.05 3508.32,325.48 " fill="none" id="UserProvider-to-IUserProvider" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="3509.86,332.32,3488.73,330.85,3506.16,318.81,3509.86,332.32" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[49c1666b2e1039e78c6958b57888cb0d]
link UserProvider to SqlProvider--><g id="link_UserProvider_SqlProvider"><path codeLine="159" d="M3984.24,178.18 C4018.44,203.53 4063.45,236.78 4103.5,266 C4145.29,296.49 4191.89,330.12 4230.83,358.1 " fill="none" id="UserProvider-to-SqlProvider" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="4235.13,352.57,4247.29,369.93,4226.96,363.94,4235.13,352.57" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[2e2cd1f126b2a0e0fb6dd8bdb0da396b]
link User to UserBase--><g id="link_User_UserBase"><path codeLine="180" d="M2239.06,903.02 C2189.8,929.28 2127.4,962.55 2075.79,990.06 " fill="none" id="User-to-UserBase" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="2078.97,996.3,2058.03,999.54,2072.38,983.95,2078.97,996.3" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[96a28894da16093fd8a9c441876c8015]
link UserCreate to UserBase--><g id="link_UserCreate_UserBase"><path codeLine="181" d="M1899.7,890.22 C1910.31,911.34 1924.66,939.87 1938.07,966.56 " fill="none" id="UserCreate-to-UserBase" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="1944.43,963.62,1947.16,984.63,1931.92,969.91,1944.43,963.62" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[64c091ef33e37a15c4a5aacf767b2a5f]
link DbUser to User--><g id="link_DbUser_User"><path codeLine="183" d="M2493.63,720.03 C2471.2,737.95 2446.74,757.5 2423.54,776.05 " fill="none" id="DbUser-to-User" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="2427.71,781.67,2407.72,788.69,2418.97,770.74,2427.71,781.67" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[6cfa3c9141341202d36b8c8620ba5693]
@startuml API class diagram

top to bottom direction

'Controllers'

class UserController{
    -_userManager{readonly} : IUserManager
    -_tokenManager : ITokenManager
    - -
    +UserController(userManager : IUserManager, tokenManager : ITokenManager)
    +CreateAsync(userCreate : UserCreate) : Task<ActionResult>
    +LoginAsync(userLogin : UserLogin) : Task<ActionResult<UserToken>>
    +GetUserFromTokenAsync() : Task<ActionResult<User>>
    +VerificationLoginAsync(verifyCredentials : VerifyCredentials) : Task<ActionResult<UserToken>>
    +VerifyUserRegisterAsync(verifyCredentials : VerifyCredentials) : Task<ActionResult>
    -GetUserLocation() : UserLocation
}

'Controllers mappings' 

UserController o- - IUserManager
UserController o- - ITokenManager

'Managers'

Interface IUserManager {
    +CreateUserAsync(userCreate : UserCreate) : Task<bool>
    +LoginAsync(userLogin : UserLogin, userLocation : UserLocation) : Task<User>
    +GetUserByIDAsync(id : int) : Task<User>
    +LoginWithVerificationCodeAsync(verifyCredentials : VerifyCredentials, userLocation : UserLocation) : Task<User>
    +VerifyUserRegistrationAsync(verifyCredentials : VerifyCredentials, userLocation: UserLocation) : Task<bool>
}

interface ITokenManager {
    +GenerateUserToken(user : User) : UserToken
    +ValidateToken(token : string) : bool
    +GetUserTokenFromToken(token : string) : UserToken
}


interface IUserLocationManager {
    +IsIPLockedAsync(ip : string) : Task<bool>
    +LogLocationAsync(userLocation : UserLocation) : Task<UserLocation>
    +UserWasLoggedInFromLocationAsync(userLocation : UserLocation) : Task<bool>
}

interface IMessageManager {
    +SendLoginAttemptMessageAsync(to : string, otp : string) : Task<bool>
    +SendLoginRegistrationMessageAsync(to : string, key : string) : Task<bool>
}

class TokenManager {
    - -
    -GetPrincipal(token : string) : ClaimsPrincipal
    -ClaimsIdentityToUserToken(identity : ClaimsPrincipal, token : string) : UserToken
}

class UserManager {
    -_userProvider : IUserProvider
    -_leakedPasswordProvider : ILeakedPasswordProvider;
    -_userLocationManager : IUserLocationManager
    -_messageManager : IMessageManager
    -_logger : ILogger<UserManager>
    -_configuration : IConfiguration
    - -
    +UserManager(configuration : IConfiguration, userProvider : IUserProvider, leakedPasswordProvider : ILeakedPasswordProvider, userLocationManager : IUserLocationManager,
     messageManager : IMessageManager, logger : ILogger<UserManager>)
    -IsVerificationCodeValid(verificationCode : string, user : DbUser) : bool
    -CheckPasswordLeakedForUserAsync(password : string) : Task<bool>
    -IsUserNotVerifiedAsync(userLocation : UserLocation, user : DbUser) : Task
    -IsUserLockedAsync(userLocation : UserLocation, user : DbUser) : Task
}

class UserLocationManager {
    -_userLocationProvider : IUserLocationProvider
    - -
    +UserLocationManager(userLocationProvider : IUserLocationProvider)
}

class MessageManager {
    -_messageService : IMessageService
    -_messageProvider : IMessageProvider
    - -
    +MessageManager(messageService : EmailMessageService, messageProvider : MailMessageProvider)
}


'Managers mappings'

IUserManager - -> UserCreate
IUserManager - -> UserLogin
IUserManager - -> VerifyCredentials
UserManager .-|> IUserManager
MessageManager .-|> IMessageManager

UserManager o- - IUserProvider
UserManager o- - IUserLocationManager
UserManager o- - ILeakedPasswordProvider
UserManager o- - IMessageManager

TokenManager .-|> ITokenManager
ITokenManager *- - UserToken


UserLocationManager .-|> IUserLocationManager
UserLocationManager o- - IUserLocationProvider
'Providers'

interface IUserProvider {
    +CreateUserAsync(userCreate : DbUser) : Task<DbUser>
    +GetUserByEmailAsync(email : string) : Task<DbUser>
    +GetUserByIdAsync(id : int) : Task<DbUser>
    +UpdateUserFailedTriesAsync(userId : int) : Task<DbUser>
    +UpdateUserLoginSuccessAsync(userId : int) : Task<DbUser>
    +UpdateUserLoginNewLocationAsync(userId : int) : Task<DbUser>
    +UpdateUserToVerifiedAsync(userID : int) : Task
    +UpdateUserLoginSuccessWithVerificationCodeAsync(userId : int) : Task<DbUser>
}

interface ILeakedPasswordProvider {
    +GetIsPasswordLeakedAsync(password : string) : Task<bool>
}

class SqlProvider {
    - -
    +SqlProvider(connection : string)
    {abstract}#RunSpAsync(storedProcedureName : string, storedProcedureElements : SpElements[]) : Task<DataTable>
    {abstract}#RunQueryAsync(query : string) : Task<DataTable>
}

class LeakedPasswordProvider {
    - -
    +LeakedPasswordProvider(configuration : IConfiguration)
}

interface IUserLocationProvider{
    +IsIPLockedAsync(ip : string) : Task<bool>
    +LogLocationAsync(userLocation: UserLocation) : Task<UserLocation>
    +UserWasLoggedInFromLocationAsync(userLocation : UserLocation) : Task<bool>
}

class UserProvider {
    - -
    +UserProvider(configuration : IConfiguration)
    -DRToUser(dr : DataRow) : DbUser
}



'Providers mappings'

IUserProvider *- - DbUser
IUserLocationProvider *- - UserLocation  

LeakedPasswordProvider .-|> ILeakedPasswordProvider
LeakedPasswordProvider - -|> SqlProvider

UserProvider .-|> IUserProvider
UserProvider - -|> SqlProvider

'Utility'

class Security{
    - -
    {static}-ComputeHash(password : string) : string
    {static}-HashPassword(password : salt, salt : string) : string
    {static}+GetSalt(saltLength : int) : string
    {static}+GetEncryptedAndSaltedPassword(password : string, salt : string, pepper : string) : string
    {static}+GetHotp(key : string, counter : long) : string
    {static}+GetHmacKey() : string
}

class RegexHelper{
    - -
    {static}+TryToGetBrowserWithoutVersion(browser : string) : string
}

'Users mappings'

User - -|> UserBase
UserCreate - -|> UserBase

DbUser - -|> User

'User models' 

class UserToken{
    +UserID : int
    +Email : string
    +Token : string
}

class User{
    +ID : int 
    +IsVerified : bool
    +IsLocked : bool
    +FailedTries : int
    +LockedDate datetime?
}

class DbUser{
    +HashedPassword : string
    +Salt : string
    +SecretKey : string
    +Count : long
    +LastRequestDate : datetime?
}

class UserCreate {
    +Password : string
}

class UserBase{
    +Email : string
    +FirstName : string
    +LastName : string
    +PhoneNumber : string
}


class UserLogin{
    +Email : string
    +Password : string 
}

class VerifyCredentials {
    +Email : string
    +Password : string
}

class UserLocation{
    +ID : int
    +UserID : int
    +IP : string
    +UserAgent : string
    +Successful : bool
    +CreateDate : datetime
}


@enduml

@startuml API class diagram

top to bottom direction


class UserController{
    -_userManager{readonly} : IUserManager
    -_tokenManager : ITokenManager
    - -
    +UserController(userManager : IUserManager, tokenManager : ITokenManager)
    +CreateAsync(userCreate : UserCreate) : Task<ActionResult>
    +LoginAsync(userLogin : UserLogin) : Task<ActionResult<UserToken>>
    +GetUserFromTokenAsync() : Task<ActionResult<User>>
    +VerificationLoginAsync(verifyCredentials : VerifyCredentials) : Task<ActionResult<UserToken>>
    +VerifyUserRegisterAsync(verifyCredentials : VerifyCredentials) : Task<ActionResult>
    -GetUserLocation() : UserLocation
}


UserController o- - IUserManager
UserController o- - ITokenManager


Interface IUserManager {
    +CreateUserAsync(userCreate : UserCreate) : Task<bool>
    +LoginAsync(userLogin : UserLogin, userLocation : UserLocation) : Task<User>
    +GetUserByIDAsync(id : int) : Task<User>
    +LoginWithVerificationCodeAsync(verifyCredentials : VerifyCredentials, userLocation : UserLocation) : Task<User>
    +VerifyUserRegistrationAsync(verifyCredentials : VerifyCredentials, userLocation: UserLocation) : Task<bool>
}

interface ITokenManager {
    +GenerateUserToken(user : User) : UserToken
    +ValidateToken(token : string) : bool
    +GetUserTokenFromToken(token : string) : UserToken
}


interface IUserLocationManager {
    +IsIPLockedAsync(ip : string) : Task<bool>
    +LogLocationAsync(userLocation : UserLocation) : Task<UserLocation>
    +UserWasLoggedInFromLocationAsync(userLocation : UserLocation) : Task<bool>
}

interface IMessageManager {
    +SendLoginAttemptMessageAsync(to : string, otp : string) : Task<bool>
    +SendLoginRegistrationMessageAsync(to : string, key : string) : Task<bool>
}

class TokenManager {
    - -
    -GetPrincipal(token : string) : ClaimsPrincipal
    -ClaimsIdentityToUserToken(identity : ClaimsPrincipal, token : string) : UserToken
}

class UserManager {
    -_userProvider : IUserProvider
    -_leakedPasswordProvider : ILeakedPasswordProvider;
    -_userLocationManager : IUserLocationManager
    -_messageManager : IMessageManager
    -_logger : ILogger<UserManager>
    -_configuration : IConfiguration
    - -
    +UserManager(configuration : IConfiguration, userProvider : IUserProvider, leakedPasswordProvider : ILeakedPasswordProvider, userLocationManager : IUserLocationManager,
     messageManager : IMessageManager, logger : ILogger<UserManager>)
    -IsVerificationCodeValid(verificationCode : string, user : DbUser) : bool
    -CheckPasswordLeakedForUserAsync(password : string) : Task<bool>
    -IsUserNotVerifiedAsync(userLocation : UserLocation, user : DbUser) : Task
    -IsUserLockedAsync(userLocation : UserLocation, user : DbUser) : Task
}

class UserLocationManager {
    -_userLocationProvider : IUserLocationProvider
    - -
    +UserLocationManager(userLocationProvider : IUserLocationProvider)
}

class MessageManager {
    -_messageService : IMessageService
    -_messageProvider : IMessageProvider
    - -
    +MessageManager(messageService : EmailMessageService, messageProvider : MailMessageProvider)
}



IUserManager - -> UserCreate
IUserManager - -> UserLogin
IUserManager - -> VerifyCredentials
UserManager .-|> IUserManager
MessageManager .-|> IMessageManager

UserManager o- - IUserProvider
UserManager o- - IUserLocationManager
UserManager o- - ILeakedPasswordProvider
UserManager o- - IMessageManager

TokenManager .-|> ITokenManager
ITokenManager *- - UserToken


UserLocationManager .-|> IUserLocationManager
UserLocationManager o- - IUserLocationProvider

interface IUserProvider {
    +CreateUserAsync(userCreate : DbUser) : Task<DbUser>
    +GetUserByEmailAsync(email : string) : Task<DbUser>
    +GetUserByIdAsync(id : int) : Task<DbUser>
    +UpdateUserFailedTriesAsync(userId : int) : Task<DbUser>
    +UpdateUserLoginSuccessAsync(userId : int) : Task<DbUser>
    +UpdateUserLoginNewLocationAsync(userId : int) : Task<DbUser>
    +UpdateUserToVerifiedAsync(userID : int) : Task
    +UpdateUserLoginSuccessWithVerificationCodeAsync(userId : int) : Task<DbUser>
}

interface ILeakedPasswordProvider {
    +GetIsPasswordLeakedAsync(password : string) : Task<bool>
}

class SqlProvider {
    - -
    +SqlProvider(connection : string)
    {abstract}#RunSpAsync(storedProcedureName : string, storedProcedureElements : SpElements[]) : Task<DataTable>
    {abstract}#RunQueryAsync(query : string) : Task<DataTable>
}

class LeakedPasswordProvider {
    - -
    +LeakedPasswordProvider(configuration : IConfiguration)
}

interface IUserLocationProvider{
    +IsIPLockedAsync(ip : string) : Task<bool>
    +LogLocationAsync(userLocation: UserLocation) : Task<UserLocation>
    +UserWasLoggedInFromLocationAsync(userLocation : UserLocation) : Task<bool>
}

class UserProvider {
    - -
    +UserProvider(configuration : IConfiguration)
    -DRToUser(dr : DataRow) : DbUser
}




IUserProvider *- - DbUser
IUserLocationProvider *- - UserLocation  

LeakedPasswordProvider .-|> ILeakedPasswordProvider
LeakedPasswordProvider - -|> SqlProvider

UserProvider .-|> IUserProvider
UserProvider - -|> SqlProvider


class Security{
    - -
    {static}-ComputeHash(password : string) : string
    {static}-HashPassword(password : salt, salt : string) : string
    {static}+GetSalt(saltLength : int) : string
    {static}+GetEncryptedAndSaltedPassword(password : string, salt : string, pepper : string) : string
    {static}+GetHotp(key : string, counter : long) : string
    {static}+GetHmacKey() : string
}

class RegexHelper{
    - -
    {static}+TryToGetBrowserWithoutVersion(browser : string) : string
}


User - -|> UserBase
UserCreate - -|> UserBase

DbUser - -|> User


class UserToken{
    +UserID : int
    +Email : string
    +Token : string
}

class User{
    +ID : int 
    +IsVerified : bool
    +IsLocked : bool
    +FailedTries : int
    +LockedDate datetime?
}

class DbUser{
    +HashedPassword : string
    +Salt : string
    +SecretKey : string
    +Count : long
    +LastRequestDate : datetime?
}

class UserCreate {
    +Password : string
}

class UserBase{
    +Email : string
    +FirstName : string
    +LastName : string
    +PhoneNumber : string
}


class UserLogin{
    +Email : string
    +Password : string 
}

class VerifyCredentials {
    +Email : string
    +Password : string
}

class UserLocation{
    +ID : int
    +UserID : int
    +IP : string
    +UserAgent : string
    +Successful : bool
    +CreateDate : datetime
}


@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) Client VM
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>
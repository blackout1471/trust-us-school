<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1802px" preserveAspectRatio="none" style="width:1345px;height:1802px;background:#FFFFFF;" version="1.1" viewBox="0 0 1345 1802" width="1345px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="48.7031" style="stroke:#FF0000;stroke-width:1.0;" width="273" x="20" y="216.6641"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="525" x="20" y="370.4219"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="525" x="20" y="524.1797"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="525" x="20" y="617.2344"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="525" x="20" y="710.2891"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="525" x="20" y="877.0469"/><rect fill="none" height="551.3281" style="stroke:#FF0000;stroke-width:1.0;" width="1329.5" x="10" y="1030.8047"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="525" x="20" y="1116.8594"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="525" x="20" y="1374.6719"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="47" x2="47" y1="82.6094" y2="1720.5391"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="227" x2="227" y1="82.6094" y2="1720.5391"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="485" x2="485" y1="82.6094" y2="1720.5391"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="786.5" x2="786.5" y1="82.6094" y2="1720.5391"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="899.5" x2="899.5" y1="82.6094" y2="1720.5391"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1040.5" x2="1040.5" y1="82.6094" y2="1720.5391"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1159.5" x2="1159.5" y1="82.6094" y2="1720.5391"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1265.5" x2="1265.5" y1="82.6094" y2="1720.5391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="30" y="79.5332">User</text><ellipse cx="47.5" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M47.5,21.5 L47.5,48.5 M34.5,29.5 L60.5,29.5 M47.5,48.5 L34.5,63.5 M47.5,48.5 L60.5,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="30" y="1734.0723">User</text><ellipse cx="47.5" cy="1745.6484" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M47.5,1753.6484 L47.5,1780.6484 M34.5,1761.6484 L60.5,1761.6484 M47.5,1780.6484 L34.5,1795.6484 M47.5,1780.6484 L60.5,1795.6484 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105" x="175" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="182" y="71.5332">UserController</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105" x="175" y="1719.5391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="182" y="1741.0723">UserController</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99" x="436" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="443" y="71.5332">UserManager</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99" x="436" y="1719.5391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="443" y="1741.0723">UserManager</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96" x="738.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="745.5" y="71.5332">UserProvider</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96" x="738.5" y="1719.5391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="745.5" y="1741.0723">UserProvider</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110" x="844.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="851.5" y="71.5332">TokenManager</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110" x="844.5" y="1719.5391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="851.5" y="1741.0723">TokenManager</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153" x="964.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="971.5" y="71.5332">UserLocationManager</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153" x="964.5" y="1719.5391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="971.5" y="1741.0723">UserLocationManager</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65" x="1127.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="1134.5" y="71.5332">Security</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65" x="1127.5" y="1719.5391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="1134.5" y="1741.0723">Security</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="127" x="1202.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="1209.5" y="71.5332">MessageManager</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="127" x="1202.5" y="1719.5391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="1209.5" y="1741.0723">MessageManager</text><polygon fill="#FF4500" points="215.5,110.9609,225.5,114.9609,215.5,118.9609,219.5,114.9609" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="47.5" x2="221.5" y1="114.9609" y2="114.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="54.5" y="110.1045">Login (email, password)</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="227.5" x2="269.5" y1="145.3125" y2="145.3125"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="269.5" x2="269.5" y1="145.3125" y2="158.3125"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="269.5" y1="158.3125" y2="158.3125"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="158.3125" y2="154.3125"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="158.3125" y2="162.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="234.5" y="140.4561">Validate email syntax(email)</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="227.5" x2="269.5" y1="188.6641" y2="188.6641"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="269.5" x2="269.5" y1="188.6641" y2="201.6641"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="269.5" y1="201.6641" y2="201.6641"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="201.6641" y2="197.6641"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="201.6641" y2="205.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212" x="234.5" y="183.8076">Validate password syntax(password)</text><path d="M20,216.6641 L81,216.6641 L81,225.0156 L71,235.0156 L20,235.0156 L20,216.6641 " fill="#EEEEEE" style="stroke:#FF0000;stroke-width:1.5;"/><rect fill="none" height="48.7031" style="stroke:#FF0000;stroke-width:1.0;" width="273" x="20" y="216.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="231.1592">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="192" x="96" y="230.083">[Email or password not complying]</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="48.5" x2="58.5" y1="257.3672" y2="253.3672"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="48.5" x2="58.5" y1="257.3672" y2="261.3672"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="47.5" x2="226.5" y1="257.3672" y2="257.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="64.5" y="252.5107">Return status badrequest</text><polygon fill="#FF4500" points="473.5,290.7188,483.5,294.7188,473.5,298.7188,477.5,294.7188" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="227.5" x2="479.5" y1="294.7188" y2="294.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="234.5" y="289.8623">Login (email, password)</text><polygon fill="#FF4500" points="1029,321.0703,1039,325.0703,1029,329.0703,1033,325.0703" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="485.5" x2="1035" y1="325.0703" y2="325.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="492.5" y="320.2139">Check if ip is blocked (ipadress)</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="486.5" x2="496.5" y1="355.4219" y2="351.4219"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="486.5" x2="496.5" y1="355.4219" y2="359.4219"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="485.5" x2="1040" y1="355.4219" y2="355.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="502.5" y="350.5654">Returns whether ip is block</text><path d="M20,370.4219 L81,370.4219 L81,378.7734 L71,388.7734 L20,388.7734 L20,370.4219 " fill="#EEEEEE" style="stroke:#FF0000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="525" x="20" y="370.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="384.917">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="65" x="96" y="383.8408">[Ip blocked]</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="411.125" y2="407.125"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="411.125" y2="415.125"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="227.5" x2="484.5" y1="411.125" y2="411.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="244.5" y="406.2686">Throw IpBlocked exception</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="48.5" x2="58.5" y1="441.4766" y2="437.4766"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="48.5" x2="58.5" y1="441.4766" y2="445.4766"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="47.5" x2="226.5" y1="441.4766" y2="441.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="64.5" y="436.6201">Return status forbidden</text><polygon fill="#FF4500" points="774.5,474.8281,784.5,478.8281,774.5,482.8281,778.5,478.8281" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="485.5" x2="780.5" y1="478.8281" y2="478.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="492.5" y="473.9717">Get user by email(email)</text><polygon fill="#FF4500" points="496.5,505.1797,486.5,509.1797,496.5,513.1797,492.5,509.1797" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="490.5" x2="785.5" y1="509.1797" y2="509.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="69" x="502.5" y="504.3232">Return User</text><path d="M20,524.1797 L81,524.1797 L81,532.5313 L71,542.5313 L20,542.5313 L20,524.1797 " fill="#EEEEEE" style="stroke:#FF0000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="525" x="20" y="524.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="538.6748">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="90" x="96" y="537.5986">[User not found]</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="564.8828" y2="560.8828"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="564.8828" y2="568.8828"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="227.5" x2="484.5" y1="564.8828" y2="564.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="244.5" y="560.0264">Login failed</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="48.5" x2="58.5" y1="595.2344" y2="591.2344"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="48.5" x2="58.5" y1="595.2344" y2="599.2344"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="47.5" x2="226.5" y1="595.2344" y2="595.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="64.5" y="590.3779">Login failed</text><path d="M20,617.2344 L81,617.2344 L81,625.5859 L71,635.5859 L20,635.5859 L20,617.2344 " fill="#EEEEEE" style="stroke:#FF0000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="525" x="20" y="617.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="631.7295">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="87" x="96" y="630.6533">[User is locked]</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="657.9375" y2="653.9375"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="657.9375" y2="661.9375"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="227.5" x2="484.5" y1="657.9375" y2="657.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="244.5" y="653.0811">Throw account locked exception</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="48.5" x2="58.5" y1="688.2891" y2="684.2891"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="48.5" x2="58.5" y1="688.2891" y2="692.2891"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="47.5" x2="226.5" y1="688.2891" y2="688.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="64.5" y="683.4326">Return status forbidden</text><path d="M20,710.2891 L81,710.2891 L81,718.6406 L71,728.6406 L20,728.6406 L20,710.2891 " fill="#EEEEEE" style="stroke:#FF0000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="525" x="20" y="710.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="724.7842">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="113" x="96" y="723.708">[User is not verified]</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="750.9922" y2="746.9922"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="750.9922" y2="754.9922"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="227.5" x2="484.5" y1="750.9922" y2="750.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230" x="244.5" y="746.1357">throw Account Is Not Verified Exception</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="48.5" x2="58.5" y1="781.3438" y2="777.3438"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="48.5" x2="58.5" y1="781.3438" y2="785.3438"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="47.5" x2="226.5" y1="781.3438" y2="781.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="64.5" y="776.4873">Return status forbidden</text><polygon fill="#FF4500" points="1148,814.6953,1158,818.6953,1148,822.6953,1152,818.6953" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="485.5" x2="1154" y1="818.6953" y2="818.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="492.5" y="813.8389">Hash password (password, salt)</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="485.5" x2="527.5" y1="849.0469" y2="849.0469"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="527.5" x2="527.5" y1="849.0469" y2="862.0469"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="486.5" x2="527.5" y1="862.0469" y2="862.0469"/><polygon fill="#FF4500" points="496.5,858.0469,486.5,862.0469,496.5,866.0469,492.5,862.0469" style="stroke:#FF4500;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287" x="492.5" y="844.1904">Check if salted password matches user password</text><path d="M20,877.0469 L81,877.0469 L81,885.3984 L71,895.3984 L20,895.3984 L20,877.0469 " fill="#EEEEEE" style="stroke:#FF0000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="525" x="20" y="877.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="891.542">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="153" x="96" y="890.4658">[Password does not match]</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="917.75" y2="913.75"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="917.75" y2="921.75"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="227.5" x2="484.5" y1="917.75" y2="917.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="244.5" y="912.8936">Login failed</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="48.5" x2="58.5" y1="948.1016" y2="944.1016"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="48.5" x2="58.5" y1="948.1016" y2="952.1016"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="47.5" x2="226.5" y1="948.1016" y2="948.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="64.5" y="943.2451">Login failed</text><polygon fill="#FF4500" points="1029,981.4531,1039,985.4531,1029,989.4531,1033,985.4531" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="485.5" x2="1035" y1="985.4531" y2="985.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="297" x="492.5" y="980.5967">Check if user has been logged in from ip (ip, userid)</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="486.5" x2="496.5" y1="1015.8047" y2="1011.8047"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="486.5" x2="496.5" y1="1015.8047" y2="1019.8047"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="485.5" x2="1040" y1="1015.8047" y2="1015.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="502.5" y="1010.9482">Returns whether user has been logged in from ip</text><path d="M10,1030.8047 L71,1030.8047 L71,1039.1563 L61,1049.1563 L10,1049.1563 L10,1030.8047 " fill="#EEEEEE" style="stroke:#FF0000;stroke-width:1.5;"/><rect fill="none" height="551.3281" style="stroke:#FF0000;stroke-width:1.0;" width="1329.5" x="10" y="1030.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="1045.2998">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="250" x="86" y="1044.2236">[Has not been logged in from location before]</text><polygon fill="#FF4500" points="1254,1067.5078,1264,1071.5078,1254,1075.5078,1258,1071.5078" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="485.5" x2="1260" y1="1071.5078" y2="1071.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264" x="492.5" y="1066.6514">Send mail with verification code to user(email)</text><polygon fill="#FF4500" points="496.5,1097.8594,486.5,1101.8594,496.5,1105.8594,492.5,1101.8594" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="490.5" x2="1265" y1="1101.8594" y2="1101.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259" x="502.5" y="1097.0029">Return whether the message was sent or not</text><path d="M20,1116.8594 L81,1116.8594 L81,1125.2109 L71,1135.2109 L20,1135.2109 L20,1116.8594 " fill="#EEEEEE" style="stroke:#FF0000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="525" x="20" y="1116.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="1131.3545">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="134" x="96" y="1130.2783">[Message was not sent]</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="1157.5625" y2="1153.5625"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="1157.5625" y2="1161.5625"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="227.5" x2="484.5" y1="1157.5625" y2="1157.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="244.5" y="1152.7061">Throw SendMessageIssueException</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="48.5" x2="58.5" y1="1187.9141" y2="1183.9141"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="48.5" x2="58.5" y1="1187.9141" y2="1191.9141"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="47.5" x2="226.5" y1="1187.9141" y2="1187.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="64.5" y="1183.0576">Return status internal error</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="1225.2656" y2="1221.2656"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="1225.2656" y2="1229.2656"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="227.5" x2="484.5" y1="1225.2656" y2="1225.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="244.5" y="1220.4092">Throw Required 2FA exception</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="48.5" x2="58.5" y1="1255.6172" y2="1251.6172"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="48.5" x2="58.5" y1="1255.6172" y2="1259.6172"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="47.5" x2="226.5" y1="1255.6172" y2="1255.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="64.5" y="1250.7607">Return status forbidden</text><polygon fill="#FF4500" points="215.5,1281.9688,225.5,1285.9688,215.5,1289.9688,219.5,1285.9688" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="47.5" x2="221.5" y1="1285.9688" y2="1285.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="54.5" y="1281.1123">Enters verification code</text><polygon fill="#FF4500" points="473.5,1312.3203,483.5,1316.3203,473.5,1320.3203,477.5,1316.3203" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="227.5" x2="479.5" y1="1316.3203" y2="1316.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234" x="234.5" y="1311.4639">VerificationLogin(email, verification code)</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="485.5" x2="527.5" y1="1346.6719" y2="1346.6719"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="527.5" x2="527.5" y1="1346.6719" y2="1359.6719"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="486.5" x2="527.5" y1="1359.6719" y2="1359.6719"/><polygon fill="#FF4500" points="496.5,1355.6719,486.5,1359.6719,496.5,1363.6719,492.5,1359.6719" style="stroke:#FF4500;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="492.5" y="1341.8154">Check if verification matches</text><path d="M20,1374.6719 L81,1374.6719 L81,1383.0234 L71,1393.0234 L20,1393.0234 L20,1374.6719 " fill="#EEEEEE" style="stroke:#FF0000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="525" x="20" y="1374.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="1389.167">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="160" x="96" y="1388.0908">[Verification does not match]</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="1415.375" y2="1411.375"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="1415.375" y2="1419.375"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="227.5" x2="484.5" y1="1415.375" y2="1415.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="244.5" y="1410.5186">throw UserIncorrectLoginException</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="48.5" x2="58.5" y1="1445.7266" y2="1441.7266"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="48.5" x2="58.5" y1="1445.7266" y2="1449.7266"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="47.5" x2="226.5" y1="1445.7266" y2="1445.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="64.5" y="1440.8701">Return status unauthorized</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="1483.0781" y2="1479.0781"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="1483.0781" y2="1487.0781"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="227.5" x2="484.5" y1="1483.0781" y2="1483.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="244.5" y="1478.2217">Returns User</text><polygon fill="#FF4500" points="887.5,1509.4297,897.5,1513.4297,887.5,1517.4297,891.5,1513.4297" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="227.5" x2="893.5" y1="1513.4297" y2="1513.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="234.5" y="1508.5732">Get token for user (User)</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="1543.7813" y2="1539.7813"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="1543.7813" y2="1547.7813"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="227.5" x2="898.5" y1="1543.7813" y2="1543.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="244.5" y="1538.9248">Returns Token</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="48.5" x2="58.5" y1="1574.1328" y2="1570.1328"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="48.5" x2="58.5" y1="1574.1328" y2="1578.1328"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="47.5" x2="226.5" y1="1574.1328" y2="1574.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="64.5" y="1569.2764">Return token</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="1611.4844" y2="1607.4844"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="1611.4844" y2="1615.4844"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="227.5" x2="484.5" y1="1611.4844" y2="1611.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="244.5" y="1606.6279">Returns User</text><polygon fill="#FF4500" points="887.5,1637.8359,897.5,1641.8359,887.5,1645.8359,891.5,1641.8359" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="227.5" x2="893.5" y1="1641.8359" y2="1641.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="234.5" y="1636.9795">Get token for user (User)</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="1672.1875" y2="1668.1875"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="238.5" y1="1672.1875" y2="1676.1875"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="227.5" x2="898.5" y1="1672.1875" y2="1672.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="244.5" y="1667.3311">Returns Token</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="48.5" x2="58.5" y1="1702.5391" y2="1698.5391"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="48.5" x2="58.5" y1="1702.5391" y2="1706.5391"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="47.5" x2="226.5" y1="1702.5391" y2="1702.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="64.5" y="1697.6826">Return token</text><!--MD5=[8b5737f1f54417fb314cc80b9e4cb548]
@startuml Login SD

skinparam sequence {
    GroupBorderColor red
    GroupBorderThickness 1

    ArrowColor orangered

    LifeLineBorderColor blue

    ParticipantBackgroundColor lightblue
}

actor User
participant UserController
participant UserManager
participant UserProvider
participant TokenManager
participant UserLocationManager
participant Security

User->UserController: Login (email, password)

UserController->>UserController: Validate email syntax(email)
UserController->>UserController: Validate password syntax(password)

alt Email or password not complying
UserController- ->>User: Return status badrequest
end

UserController->UserManager: Login (email, password)
UserManager->UserLocationManager: Check if ip is blocked (ipadress)
UserLocationManager- ->>UserManager: Returns whether ip is block

alt Ip blocked
UserManager- ->>UserController: Throw IpBlocked exception
UserController- ->>User: Return status forbidden
end

UserManager->UserProvider: Get user by email(email)
UserProvider->UserManager: Return User


alt User not found

UserManager- ->>UserController: Login failed
UserController- ->>User: Login failed

end

alt User is locked

UserManager- ->>UserController: Throw account locked exception
UserController- ->>User: Return status forbidden

end

alt User is not verified

UserManager- ->>UserController: throw Account Is Not Verified Exception
UserController- ->>User: Return status forbidden

end

UserManager->Security: Hash password (password, salt)
UserManager->UserManager: Check if salted password matches user password

alt Password does not match

UserManager- ->>UserController: Login failed
UserController- ->>User: Login failed

end


UserManager->UserLocationManager: Check if user has been logged in from ip (ip, userid)
UserLocationManager- ->>UserManager: Returns whether user has been logged in from ip

alt Has not been logged in from location before

UserManager->MessageManager: Send mail with verification code to user(email)
MessageManager->UserManager: Return whether the message was sent or not
alt Message was not sent

UserManager - ->> UserController: Throw SendMessageIssueException
UserController - ->> User: Return status internal error
end
UserManager- ->>UserController: Throw Required 2FA exception
UserController- ->>User: Return status forbidden
User->UserController: Enters verification code
UserController->UserManager: VerificationLogin(email, verification code)
UserManager->UserManager: Check if verification matches
alt Verification does not match

UserManager- ->>UserController: throw UserIncorrectLoginException
UserController- ->>User: Return status unauthorized

end
UserManager- ->>UserController: Returns User
UserController->TokenManager: Get token for user (User)
TokenManager- ->>UserController: Returns Token
UserController- ->>User: Return token
end

UserManager- ->>UserController: Returns User
UserController->TokenManager: Get token for user (User)
TokenManager- ->>UserController: Returns Token

UserController- ->>User: Return token

@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) Client VM
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>
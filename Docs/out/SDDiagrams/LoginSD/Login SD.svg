<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1683px" preserveAspectRatio="none" style="width:1356px;height:1683px;background:#FFFFFF;" version="1.1" viewBox="0 0 1356 1683" width="1356px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="526" x="20" y="221.0156"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="526" x="20" y="374.7734"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="526" x="20" y="467.8281"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="526" x="20" y="560.8828"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="526" x="20" y="727.6406"/><rect fill="none" height="581.6797" style="stroke:#FF0000;stroke-width:1.0;" width="1340.5" x="10" y="881.3984"/><rect fill="none" height="109.4063" style="stroke:#FF0000;stroke-width:1.0;" width="1320.5" x="20" y="967.4531"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="526" x="20" y="1255.6172"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="47" x2="47" y1="82.6094" y2="1601.4844"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="228" x2="228" y1="82.6094" y2="1601.4844"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="486" x2="486" y1="82.6094" y2="1601.4844"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="787.5" x2="787.5" y1="82.6094" y2="1601.4844"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="900.5" x2="900.5" y1="82.6094" y2="1601.4844"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1041.5" x2="1041.5" y1="82.6094" y2="1601.4844"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1160.5" x2="1160.5" y1="82.6094" y2="1601.4844"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1266.5" x2="1266.5" y1="82.6094" y2="1601.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="30" y="79.5332">User</text><ellipse cx="47.5" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M47.5,21.5 L47.5,48.5 M34.5,29.5 L60.5,29.5 M47.5,48.5 L34.5,63.5 M47.5,48.5 L60.5,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="30" y="1615.0176">User</text><ellipse cx="47.5" cy="1626.5938" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M47.5,1634.5938 L47.5,1661.5938 M34.5,1642.5938 L60.5,1642.5938 M47.5,1661.5938 L34.5,1676.5938 M47.5,1661.5938 L60.5,1676.5938 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105" x="176" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="183" y="71.5332">UserController</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105" x="176" y="1600.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="183" y="1622.0176">UserController</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99" x="437" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="444" y="71.5332">UserManager</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99" x="437" y="1600.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="444" y="1622.0176">UserManager</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96" x="739.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="746.5" y="71.5332">UserProvider</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96" x="739.5" y="1600.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="746.5" y="1622.0176">UserProvider</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110" x="845.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="852.5" y="71.5332">TokenManager</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110" x="845.5" y="1600.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="852.5" y="1622.0176">TokenManager</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153" x="965.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="972.5" y="71.5332">UserLocationManager</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153" x="965.5" y="1600.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="972.5" y="1622.0176">UserLocationManager</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65" x="1128.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="1135.5" y="71.5332">Security</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65" x="1128.5" y="1600.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="1135.5" y="1622.0176">Security</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="127" x="1203.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="1210.5" y="71.5332">MessageManager</text><rect fill="#ADD8E6" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="127" x="1203.5" y="1600.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="1210.5" y="1622.0176">MessageManager</text><polygon fill="#FF4500" points="216.5,110.9609,226.5,114.9609,216.5,118.9609,220.5,114.9609" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="47.5" x2="222.5" y1="114.9609" y2="114.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="54.5" y="110.1045">Login (email, password)</text><polygon fill="#FF4500" points="474.5,141.3125,484.5,145.3125,474.5,149.3125,478.5,145.3125" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="480.5" y1="145.3125" y2="145.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="235.5" y="140.4561">Login (email, password)</text><polygon fill="#FF4500" points="1030,171.6641,1040,175.6641,1030,179.6641,1034,175.6641" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="486.5" x2="1036" y1="175.6641" y2="175.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="493.5" y="170.8076">Check if ip is blocked (ipadress)</text><polygon fill="#FF4500" points="497.5,202.0156,487.5,206.0156,497.5,210.0156,493.5,206.0156" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="491.5" x2="1041" y1="206.0156" y2="206.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="503.5" y="201.1592">Returns whether ip is block</text><path d="M20,221.0156 L81,221.0156 L81,229.3672 L71,239.3672 L20,239.3672 L20,221.0156 " fill="#EEEEEE" style="stroke:#FF0000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="526" x="20" y="221.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="235.5107">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="65" x="96" y="234.4346">[Ip blocked]</text><polygon fill="#FF4500" points="239.5,257.7188,229.5,261.7188,239.5,265.7188,235.5,261.7188" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="233.5" x2="485.5" y1="261.7188" y2="261.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="245.5" y="256.8623">Throw IpBlocked exception</text><polygon fill="#FF4500" points="58.5,288.0703,48.5,292.0703,58.5,296.0703,54.5,292.0703" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="52.5" x2="227.5" y1="292.0703" y2="292.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="64.5" y="287.2139">Return status forbidden</text><polygon fill="#FF4500" points="775.5,325.4219,785.5,329.4219,775.5,333.4219,779.5,329.4219" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="486.5" x2="781.5" y1="329.4219" y2="329.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="493.5" y="324.5654">Get user by email(email)</text><polygon fill="#FF4500" points="497.5,355.7734,487.5,359.7734,497.5,363.7734,493.5,359.7734" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="491.5" x2="786.5" y1="359.7734" y2="359.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="69" x="503.5" y="354.917">Return User</text><path d="M20,374.7734 L81,374.7734 L81,383.125 L71,393.125 L20,393.125 L20,374.7734 " fill="#EEEEEE" style="stroke:#FF0000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="526" x="20" y="374.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="389.2686">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="90" x="96" y="388.1924">[User not found]</text><polygon fill="#FF4500" points="239.5,411.4766,229.5,415.4766,239.5,419.4766,235.5,415.4766" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="233.5" x2="485.5" y1="415.4766" y2="415.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="245.5" y="410.6201">Login failed</text><polygon fill="#FF4500" points="58.5,441.8281,48.5,445.8281,58.5,449.8281,54.5,445.8281" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="52.5" x2="227.5" y1="445.8281" y2="445.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="64.5" y="440.9717">Login failed</text><path d="M20,467.8281 L81,467.8281 L81,476.1797 L71,486.1797 L20,486.1797 L20,467.8281 " fill="#EEEEEE" style="stroke:#FF0000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="526" x="20" y="467.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="482.3232">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="87" x="96" y="481.2471">[User is locked]</text><polygon fill="#FF4500" points="239.5,504.5313,229.5,508.5313,239.5,512.5313,235.5,508.5313" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="233.5" x2="485.5" y1="508.5313" y2="508.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="245.5" y="503.6748">Throw account locked exception</text><polygon fill="#FF4500" points="58.5,534.8828,48.5,538.8828,58.5,542.8828,54.5,538.8828" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="52.5" x2="227.5" y1="538.8828" y2="538.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="64.5" y="534.0264">Return status forbidden</text><path d="M20,560.8828 L81,560.8828 L81,569.2344 L71,579.2344 L20,579.2344 L20,560.8828 " fill="#EEEEEE" style="stroke:#FF0000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="526" x="20" y="560.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="575.3779">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="113" x="96" y="574.3018">[User is not verified]</text><polygon fill="#FF4500" points="239.5,597.5859,229.5,601.5859,239.5,605.5859,235.5,601.5859" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="233.5" x2="485.5" y1="601.5859" y2="601.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230" x="245.5" y="596.7295">throw Account Is Not Verified Exception</text><polygon fill="#FF4500" points="58.5,627.9375,48.5,631.9375,58.5,635.9375,54.5,631.9375" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="52.5" x2="227.5" y1="631.9375" y2="631.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="64.5" y="627.0811">Return status forbidden</text><polygon fill="#FF4500" points="1149,665.2891,1159,669.2891,1149,673.2891,1153,669.2891" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="486.5" x2="1155" y1="669.2891" y2="669.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="493.5" y="664.4326">Hash password (password, salt)</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="486.5" x2="528.5" y1="699.6406" y2="699.6406"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="528.5" x2="528.5" y1="699.6406" y2="712.6406"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="487.5" x2="528.5" y1="712.6406" y2="712.6406"/><polygon fill="#FF4500" points="497.5,708.6406,487.5,712.6406,497.5,716.6406,493.5,712.6406" style="stroke:#FF4500;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287" x="493.5" y="694.7842">Check if salted password matches user password</text><path d="M20,727.6406 L81,727.6406 L81,735.9922 L71,745.9922 L20,745.9922 L20,727.6406 " fill="#EEEEEE" style="stroke:#FF0000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="526" x="20" y="727.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="742.1357">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="153" x="96" y="741.0596">[Password does not match]</text><polygon fill="#FF4500" points="239.5,764.3438,229.5,768.3438,239.5,772.3438,235.5,768.3438" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="233.5" x2="485.5" y1="768.3438" y2="768.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="245.5" y="763.4873">Login failed</text><polygon fill="#FF4500" points="58.5,794.6953,48.5,798.6953,58.5,802.6953,54.5,798.6953" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="52.5" x2="227.5" y1="798.6953" y2="798.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="64.5" y="793.8389">Login failed</text><polygon fill="#FF4500" points="1030,832.0469,1040,836.0469,1030,840.0469,1034,836.0469" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="486.5" x2="1036" y1="836.0469" y2="836.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="297" x="493.5" y="831.1904">Check if user has been logged in from ip (ip, userid)</text><polygon fill="#FF4500" points="497.5,862.3984,487.5,866.3984,497.5,870.3984,493.5,866.3984" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="491.5" x2="1041" y1="866.3984" y2="866.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="503.5" y="861.542">Returns whether user has been logged in from ip</text><path d="M10,881.3984 L71,881.3984 L71,889.75 L61,899.75 L10,899.75 L10,881.3984 " fill="#EEEEEE" style="stroke:#FF0000;stroke-width:1.5;"/><rect fill="none" height="581.6797" style="stroke:#FF0000;stroke-width:1.0;" width="1340.5" x="10" y="881.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="895.8936">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="250" x="86" y="894.8174">[Has not been logged in from location before]</text><polygon fill="#FF4500" points="1255,918.1016,1265,922.1016,1255,926.1016,1259,922.1016" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="486.5" x2="1261" y1="922.1016" y2="922.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264" x="493.5" y="917.2451">Send mail with verification code to user(email)</text><polygon fill="#FF4500" points="497.5,948.4531,487.5,952.4531,497.5,956.4531,493.5,952.4531" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="491.5" x2="1266" y1="952.4531" y2="952.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187" x="503.5" y="947.5967">Return true if message was sent</text><path d="M20,967.4531 L81,967.4531 L81,975.8047 L71,985.8047 L20,985.8047 L20,967.4531 " fill="#EEEEEE" style="stroke:#FF0000;stroke-width:1.5;"/><rect fill="none" height="109.4063" style="stroke:#FF0000;stroke-width:1.0;" width="1320.5" x="20" y="967.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="981.9482">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="134" x="96" y="980.8721">[Message was not sent]</text><polygon fill="#FF4500" points="497.5,1004.1563,487.5,1008.1563,497.5,1012.1563,493.5,1008.1563" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="491.5" x2="1266" y1="1008.1563" y2="1008.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="69" x="503.5" y="1003.2998">Return false</text><polygon fill="#FF4500" points="239.5,1034.5078,229.5,1038.5078,239.5,1042.5078,235.5,1038.5078" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="233.5" x2="485.5" y1="1038.5078" y2="1038.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="245.5" y="1033.6514">Throw SendMessageIssueException</text><polygon fill="#FF4500" points="58.5,1064.8594,48.5,1068.8594,58.5,1072.8594,54.5,1068.8594" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="52.5" x2="227.5" y1="1068.8594" y2="1068.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="64.5" y="1064.0029">return contact support error</text><polygon fill="#FF4500" points="239.5,1102.2109,229.5,1106.2109,239.5,1110.2109,235.5,1106.2109" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="233.5" x2="485.5" y1="1106.2109" y2="1106.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="245.5" y="1101.3545">Throw Required 2FA exception</text><polygon fill="#FF4500" points="58.5,1132.5625,48.5,1136.5625,58.5,1140.5625,54.5,1136.5625" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="52.5" x2="227.5" y1="1136.5625" y2="1136.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="64.5" y="1131.7061">Return status forbidden</text><polygon fill="#FF4500" points="216.5,1162.9141,226.5,1166.9141,216.5,1170.9141,220.5,1166.9141" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="47.5" x2="222.5" y1="1166.9141" y2="1166.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="54.5" y="1162.0576">Enters verification code</text><polygon fill="#FF4500" points="474.5,1193.2656,484.5,1197.2656,474.5,1201.2656,478.5,1197.2656" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="480.5" y1="1197.2656" y2="1197.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234" x="235.5" y="1192.4092">VerificationLogin(email, verification code)</text><line style="stroke:#FF4500;stroke-width:1.0;" x1="486.5" x2="528.5" y1="1227.6172" y2="1227.6172"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="528.5" x2="528.5" y1="1227.6172" y2="1240.6172"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="487.5" x2="528.5" y1="1240.6172" y2="1240.6172"/><polygon fill="#FF4500" points="497.5,1236.6172,487.5,1240.6172,497.5,1244.6172,493.5,1240.6172" style="stroke:#FF4500;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="493.5" y="1222.7607">Check if verification matches</text><path d="M20,1255.6172 L81,1255.6172 L81,1263.9688 L71,1273.9688 L20,1273.9688 L20,1255.6172 " fill="#EEEEEE" style="stroke:#FF0000;stroke-width:1.5;"/><rect fill="none" height="79.0547" style="stroke:#FF0000;stroke-width:1.0;" width="526" x="20" y="1255.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="1270.1123">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="160" x="96" y="1269.0361">[Verification does not match]</text><polygon fill="#FF4500" points="239.5,1292.3203,229.5,1296.3203,239.5,1300.3203,235.5,1296.3203" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="233.5" x2="485.5" y1="1296.3203" y2="1296.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="245.5" y="1291.4639">Login failed</text><polygon fill="#FF4500" points="58.5,1322.6719,48.5,1326.6719,58.5,1330.6719,54.5,1326.6719" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="52.5" x2="227.5" y1="1326.6719" y2="1326.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="64.5" y="1321.8154">Login failed</text><polygon fill="#FF4500" points="239.5,1360.0234,229.5,1364.0234,239.5,1368.0234,235.5,1364.0234" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="233.5" x2="485.5" y1="1364.0234" y2="1364.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="245.5" y="1359.167">Returns User</text><polygon fill="#FF4500" points="888.5,1390.375,898.5,1394.375,888.5,1398.375,892.5,1394.375" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="894.5" y1="1394.375" y2="1394.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="235.5" y="1389.5186">Get token for user (User)</text><polygon fill="#FF4500" points="239.5,1420.7266,229.5,1424.7266,239.5,1428.7266,235.5,1424.7266" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="233.5" x2="899.5" y1="1424.7266" y2="1424.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="245.5" y="1419.8701">Returns Token</text><polygon fill="#FF4500" points="58.5,1451.0781,48.5,1455.0781,58.5,1459.0781,54.5,1455.0781" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="52.5" x2="227.5" y1="1455.0781" y2="1455.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="64.5" y="1450.2217">Return token</text><polygon fill="#FF4500" points="239.5,1488.4297,229.5,1492.4297,239.5,1496.4297,235.5,1492.4297" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="233.5" x2="485.5" y1="1492.4297" y2="1492.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="245.5" y="1487.5732">Returns User</text><polygon fill="#FF4500" points="888.5,1518.7813,898.5,1522.7813,888.5,1526.7813,892.5,1522.7813" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;" x1="228.5" x2="894.5" y1="1522.7813" y2="1522.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="235.5" y="1517.9248">Get token for user (User)</text><polygon fill="#FF4500" points="239.5,1549.1328,229.5,1553.1328,239.5,1557.1328,235.5,1553.1328" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="233.5" x2="899.5" y1="1553.1328" y2="1553.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="245.5" y="1548.2764">Returns Token</text><polygon fill="#FF4500" points="58.5,1579.4844,48.5,1583.4844,58.5,1587.4844,54.5,1583.4844" style="stroke:#FF4500;stroke-width:1.0;"/><line style="stroke:#FF4500;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="52.5" x2="227.5" y1="1583.4844" y2="1583.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="64.5" y="1578.6279">Return token</text><!--MD5=[1a57679645bd1b36ec2c012828da9492]
@startuml Login SD

skinparam sequence {
    GroupBorderColor red
    GroupBorderThickness 1

    ArrowColor orangered

    LifeLineBorderColor blue

    ParticipantBackgroundColor lightblue
}

actor User
participant UserController
participant UserManager
participant UserProvider
participant TokenManager
participant UserLocationManager
participant Security

User->UserController: Login (email, password)
UserController->UserManager: Login (email, password)
UserManager->UserLocationManager: Check if ip is blocked (ipadress)
UserLocationManager- ->UserManager: Returns whether ip is block

alt Ip blocked
UserManager- ->UserController: Throw IpBlocked exception
UserController- ->User: Return status forbidden
end

UserManager->UserProvider: Get user by email(email)
UserProvider->UserManager: Return User


alt User not found

UserManager- ->UserController: Login failed
UserController- ->User: Login failed

end

alt User is locked

UserManager- ->UserController: Throw account locked exception
UserController- ->User: Return status forbidden

end

alt User is not verified

UserManager- ->UserController: throw Account Is Not Verified Exception
UserController- ->User: Return status forbidden

end

UserManager->Security: Hash password (password, salt)
UserManager->UserManager: Check if salted password matches user password

alt Password does not match

UserManager- ->UserController: Login failed
UserController- ->User: Login failed

end


UserManager->UserLocationManager: Check if user has been logged in from ip (ip, userid)
UserLocationManager- ->UserManager: Returns whether user has been logged in from ip

alt Has not been logged in from location before

UserManager->MessageManager: Send mail with verification code to user(email)
MessageManager->UserManager: Return true if message was sent
alt Message was not sent
MessageManager- ->UserManager: Return false
UserManager - -> UserController: Throw SendMessageIssueException
UserController - -> User: return contact support error
end
UserManager- ->UserController: Throw Required 2FA exception
UserController- ->User: Return status forbidden
User->UserController: Enters verification code
UserController->UserManager: VerificationLogin(email, verification code)
UserManager->UserManager: Check if verification matches
alt Verification does not match

UserManager- ->UserController: Login failed
UserController- ->User: Login failed

end
UserManager- ->UserController: Returns User
UserController->TokenManager: Get token for user (User)
TokenManager- ->UserController: Returns Token
UserController- ->User: Return token
end

UserManager- ->UserController: Returns User
UserController->TokenManager: Get token for user (User)
TokenManager- ->UserController: Returns Token

UserController- ->User: Return token

@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: Cp1252
Language: da
Country: DK
--></g></svg>